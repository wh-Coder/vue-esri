// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
require({cache:{"dojo/debounce":function(){define([],function(){return function(l,p){var g;return function(){g&&clearTimeout(g);var a=this,h=arguments;g=setTimeout(function(){l.apply(a,h)},p)}}})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(l,p,g){l.DeferredList=function(a,h,w,r,e){var d=[];p.call(this);var l=this;0!==a.length||h||this.resolve([0,[]]);var C=0;g.forEach(a,function(e,g){function p(c,e){d[g]=[c,e];C++;C===a.length&&l.resolve(d)}
e.then(function(c){h?l.resolve([g,c]):p(!0,c)},function(c){w?l.reject(c):p(!1,c);if(r)return null;throw c;})})};l.DeferredList.prototype=new p;l.DeferredList.prototype.gatherResults=function(a){a=new l.DeferredList(a,!1,!0,!1);a.addCallback(function(a){var h=[];g.forEach(a,function(a){h.push(a[1])});return h});return a};return l.DeferredList})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(l,p,g,a,h,w,r,e,d,K,C,y,D){function u(){}function c(c){return function(a,e,d,h){return a&&"string"==typeof e&&a[e]==u?a.on(e.substring(2).toLowerCase(),r.hitch(d,h)):c.apply(g,arguments)}}l.around(g,"connect",c);w.connect&&l.around(w,"connect",c);l=a("dijit._Widget",[C,y,D],{onClick:u,onDblClick:u,onKeyDown:u,onKeyPress:u,onKeyUp:u,onMouseDown:u,onMouseMove:u,onMouseOut:u,onMouseOver:u,onMouseLeave:u,onMouseEnter:u,onMouseUp:u,constructor:function(c){this._toConnect={};for(var a in c)this[a]===
u&&(this._toConnect[a.replace(/^on/,"").toLowerCase()]=c[a],delete c[a])},postCreate:function(){this.inherited(arguments);for(var c in this._toConnect)this.on(c,this._toConnect[c]);delete this._toConnect},on:function(c,a){return this[this._onMap(c)]===u?g.connect(this.domNode,c.toLowerCase(),this,a):this.inherited(arguments)},_setFocusedAttr:function(c){this._focused=c;this._set("focused",c)},setAttribute:function(c,a){w.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(c,a)},attr:function(c,a){return 2<=arguments.length||"object"===typeof c?this.set.apply(this,arguments):this.get(c)},getDescendants:function(){w.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?e("[widgetId]",this.containerNode).map(K.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});h("dijit-legacy-requires")&&d(0,function(){require(["dijit/_base"])});
return l})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(l,p,g,a,h,w,r,e,d,K,C,y,D,u,c,x,I,t,v,G,B,Q,H){function N(c){return function(A){e[A?
"set":"remove"](this.domNode,c,A);this._set(c,A)}}D.add("dijit-legacy-requires",!u.isAsync);D.add("dojo-bidi",!1);D("dijit-legacy-requires")&&I(0,function(){l(["dijit/_base/manager"])});var J={};a=w("dijit._WidgetBase",[t,B],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:N("lang"),dir:"",_setDirAttr:N("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(c){this._set("ownerDocument",
c)},attributeMap:{},_blankGif:a.blankGif||l.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var c=this.constructor;if(!c._setterAttrs){var a=c.prototype,e=c._setterAttrs=[],c=c._onMap={},d;for(d in a.attributeMap)e.push(d);for(d in a)/^on/.test(d)&&(c[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,d.length-9),a.attributeMap&&d in a.attributeMap||e.push(d))}},postscript:function(c,a){this.create(c,a)},create:function(a,d){this._introspect();
this.srcNodeRef=r.byId(d);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,c.mixin(this,a));this.postMixInProperties();this.id||(this.id=H.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=G.body(this.ownerDocument);H.add(this);
this.buildRendering();var A;if(this.domNode){this._applyAttributes();var e=this.srcNodeRef;e&&e.parentNode&&this.domNode!==e&&(e.parentNode.replaceChild(this.domNode,e),A=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();A&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var c={},a;for(a in this.params||{})c[a]=this._get(a);p.forEach(this.constructor._setterAttrs,function(a){if(!(a in c)){var d=this._get(a);d&&this.set(a,d)}},this);for(a in c)this.set(a,c[a])},
postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var c=this.baseClass.split(" ");this.isLeftToRight()||(c=c.concat(p.map(c,function(c){return c+"Rtl"})));d.add(this.domNode,c)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,p.forEach(this.getChildren(),function(a){a._started||a._destroyed||!c.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(c){this._beingDestroyed=
!0;this.destroyDescendants(c);this.destroy(c)},destroy:function(a){function d(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();p.forEach(this._connects,c.hitch(this,"disconnect"));p.forEach(this._supportingWidgets,d);this.domNode&&p.forEach(H.findWidgets(this.domNode,this.containerNode),d);this.destroyRendering(a);H.remove(this.id);this._destroyed=!0},destroyRendering:function(c){this.bgIframe&&(this.bgIframe.destroy(c),delete this.bgIframe);
this.domNode&&(c?e.remove(this.domNode,"widgetId"):K.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(c||K.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(c){p.forEach(this.getChildren(),function(a){a.destroyRecursive&&a.destroyRecursive(c)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var d=this.domNode;c.isObject(a)?y.set(d,a):d.style.cssText=d.style.cssText?d.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,t,v){v=3<=
arguments.length?v:this.attributeMap[a];p.forEach(c.isArray(v)?v:[v],function(v){var h=this[v.node||v||"domNode"];switch(v.type||"attribute"){case "attribute":c.isFunction(t)&&(t=c.hitch(this,t));v=v.attribute?v.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;h.tagName?e.set(h,v,t):h.set(v,t);break;case "innerText":h.innerHTML="";h.appendChild(this.ownerDocument.createTextNode(t));break;case "innerHTML":h.innerHTML=t;break;case "class":d.replace(h,t,this[a]);break;case "toggleClass":d.toggle(h,
v.className||a,t)}},this)},get:function(c){var a=this._getAttrNames(c);return this[a.g]?this[a.g]():this._get(c)},set:function(a,d){if("object"===typeof a){for(var e in a)this.set(e,a[e]);return this}e=this._getAttrNames(a);var v=this[e.s];if(c.isFunction(v))var t=v.apply(this,Array.prototype.slice.call(arguments,1));else{var v=this.focusNode&&!c.isFunction(this.focusNode)?"focusNode":"domNode",h=this[v]&&this[v].tagName,r;if((r=h)&&!(r=J[h])){r=this[v];var w={},g;for(g in r)w[g.toLowerCase()]=!0;
r=J[h]=w}g=r;e=a in this.attributeMap?this.attributeMap[a]:e.s in this?this[e.s]:g&&e.l in g&&"function"!=typeof d||/^aria-|^data-|^role$/.test(a)?v:null;null!=e&&this._attrToDom(a,d,e);this._set(a,d)}return t||this},_attrPairNames:{},_getAttrNames:function(c){var a=this._attrPairNames;if(a[c])return a[c];var d=c.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase()});return a[c]={n:c+"Node",s:"_set"+d+"Attr",g:"_get"+d+"Attr",l:d.toLowerCase()}},_set:function(c,a){var d=
this[c];this[c]=a;!this._created||d===a||d!==d&&a!==a||(this._watchCallbacks&&this._watchCallbacks(c,d,a),this.emit("attrmodified-"+c,{detail:{prevValue:d,newValue:a}}))},_get:function(c){return this[c]},emit:function(c,a,d){a=a||{};void 0===a.bubbles&&(a.bubbles=!0);void 0===a.cancelable&&(a.cancelable=!0);a.detail||(a.detail={});a.detail.widget=this;var e,v=this["on"+c];v&&(e=v.apply(this,d?d:[a]));this._started&&!this._beingDestroyed&&x.emit(this.domNode,c.toLowerCase(),a);return e},on:function(c,
a){var d=this._onMap(c);return d?g.after(this,d,a,!0):this.own(x(this.domNode,c,a))[0]},_onMap:function(c){var a=this.constructor,d=a._onMap;if(!d){var d=a._onMap={},e;for(e in a.prototype)/^on/.test(e)&&(d[e.replace(/^on/,"").toLowerCase()]=e)}return d["string"==typeof c&&c.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?H.findWidgets(this.containerNode):[]},getParent:function(){return H.getEnclosingWidget(this.domNode.parentNode)},
connect:function(c,a,d){return this.own(h.connect(c,a,this,d))[0]},disconnect:function(c){c.remove()},subscribe:function(a,d){return this.own(v.subscribe(a,c.hitch(this,d)))[0]},unsubscribe:function(c){c.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():C.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=y.get(this.domNode,"display")},placeAt:function(c,a){var d=!c.tagName&&H.byId(c);!d||!d.addChild||a&&"number"!==typeof a?(d=d&&"domNode"in
d?d.containerNode&&!/after|before|replace/.test(a||"")?d.containerNode:d.domNode:r.byId(c,this.ownerDocument),K.place(this.domNode,d,a),!this._started&&(this.getParent()||{})._started&&this.startup()):d.addChild(this,a);return this},defer:function(a,d){var e=setTimeout(c.hitch(this,function(){e&&(e=null,this._destroyed||c.hitch(this,a)())}),d||0);return{remove:function(){e&&(clearTimeout(e),e=null);return null}}}});D("dojo-bidi")&&a.extend(Q);return a})},"dijit/Destroyable":function(){define(["dojo/_base/array",
"dojo/aspect","dojo/_base/declare"],function(l,p,g){return g("dijit.Destroyable",null,{destroy:function(a){this._destroyed=!0},own:function(){var a=["destroyRecursive","destroy","remove"];l.forEach(arguments,function(h){function g(){e.remove();l.forEach(d,function(a){a.remove()})}var r,e=p.before(this,"destroy",function(a){h[r](a)}),d=[];h.then?(r="cancel",h.then(g,g)):l.forEach(a,function(a){"function"===typeof h[a]&&(r||(r=a),d.push(p.after(h,a,g,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),
function(l,p,g,a,h,w){l=a("dijit._OnDijitClickMixin",null,{connect:function(a,e,d){return this.inherited(arguments,[a,"ondijitclick"==e?w:e,d])}});l.a11yclick=w;return l})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(l,p,g,a){a.extend(p,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return g("dijit._FocusMixin",null,{_focusManager:l})})},"dijit/hccss":function(){define(["dojo/dom-class",
"dojo/hccss","dojo/domReady","dojo/_base/window"],function(l,p,g,a){g(function(){p("highcontrast")&&l.add(a.body(),"dijit_a11y")});return p})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(l,p,g,a,h,w,r){h.add("highcontrast",function(){var e=r.doc.createElement("div");try{e.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(p.blankGif||
l.toUrl("./resources/blank.gif"))+'");';r.body().appendChild(e);var d=a.getComputedStyle(e),g=d.backgroundImage;return d.borderTopColor==d.borderRightColor||g&&("none"==g||"url(invalid-url:)"==g)}catch(C){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+C.toString()),!1}finally{8>=h("ie")?e.outerHTML="":r.body().removeChild(e)}});w(function(){h("highcontrast")&&g.add(r.body(),"dj_a11y")});return h})},"dojox/html/entities":function(){define(["dojo/_base/lang"],
function(l){var p=l.getObject("dojox.html.entities",!0),g=function(a,g){var h,e;if(g._encCache&&g._encCache.regexp&&g._encCache.mapper&&g.length==g._encCache.length)h=g._encCache.mapper,e=g._encCache.regexp;else{h={};e=["["];var d;for(d=0;d<g.length;d++)h[g[d][0]]="\x26"+g[d][1]+";",e.push(g[d][0]);e.push("]");e=new RegExp(e.join(""),"g");g._encCache={mapper:h,regexp:e,length:g.length}}return a=a.replace(e,function(a){return h[a]})},a=function(a,g){var h,e;if(g._decCache&&g._decCache.regexp&&g._decCache.mapper&&
g.length==g._decCache.length)h=g._decCache.mapper,e=g._decCache.regexp;else{h={};e=["("];var d;for(d=0;d<g.length;d++){var l="\x26"+g[d][1]+";";d&&e.push("|");h[l]=g[d][0];e.push(l)}e.push(")");e=new RegExp(e.join(""),"g");g._decCache={mapper:h,regexp:e,length:g.length}}return a=a.replace(e,function(a){return h[a]})};p.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];p.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],
["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0",
"Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da",
"Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4",
"ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f",
"Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3",
"sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0",
"lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245",
"cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],
["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];p.encode=function(a,l){a&&(l?
a=g(a,l):(a=g(a,p.html),a=g(a,p.latin)));return a};p.decode=function(g,l){g&&(l?g=a(g,l):(g=a(g,p.html),g=a(g,p.latin)));return g};return p})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(l,p,g,a){var h=function(a,e){return a-e},w={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(a){var e=String(a),d=e.match(w._reNumber);a={integer:0,fractional:0};d&&d[1]?(a.integer=d[1].split("").length,a.fractional=d[3]?d[3].split("").length:
0):-1<e.toLowerCase().indexOf("e")&&(d=e.split("e"),e=d[0],d=d[1],e&&d&&(e=Number(e),d=Number(d),(a=0<d)||(d=Math.abs(d)),e=w.getDigits(e),a?(e.integer+=d,e.fractional=d>e.fractional?0:e.fractional-d):(e.fractional+=d,e.integer=d>e.integer?1:e.integer-d),a=e));return a},getFixedNumbers:function(a,e){var d,g;d=Number(a.toFixed(e));d<a?g=d+1/Math.pow(10,e):(g=d,d-=1/Math.pow(10,e));d=Number(d.toFixed(e));g=Number(g.toFixed(e));return[d,g]},getPctChange:function(a,e,d,g){var h={prev:null,next:null},
l;null!=d&&(l=a-d,h.prev=Math.floor(Math.abs(100*(e-d-l)/l)));null!=g&&(l=g-a,h.next=Math.floor(Math.abs(100*(g-e-l)/l)));return h},round:function(a,e){var d=a.slice(0),g,l,r,p,u,c,x,I,t,v=e&&null!=e.tolerance?e.tolerance:2,G=e&&e.indexes,B=e&&null!=e.strictBounds?e.strictBounds:!1;if(G)G.sort(h);else for(G=[],c=0;c<d.length;c++)G.push(c);for(c=0;c<G.length;c++)if(t=G[c],g=d[t],l=0===t?null:d[t-1],r=t===d.length-1?null:d[t+1],p=w.getDigits(g),p=p.fractional){x=0;for(I=!1;x<=p&&!I;)u=w.getFixedNumbers(g,
x),u=B&&0===c?u[1]:u[0],I=w.hasMinimalChange(g,u,l,r,v),x++;I&&(d[t]=u)}return d},hasMinimalChange:function(a,e,d,g,h){a=w.getPctChange(a,e,d,g);e=null==a.prev||a.prev<=h;d=null==a.next||a.next<=h;return e&&d||a.prev+a.next<=2*h},_reAllZeros:new RegExp("\\"+g.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(a,e){e=e||{places:20,round:-1};var d=p.format(a,e);d&&(d=d.replace(w._reSomeZeros,"$1").replace(w._reAllZeros,""));return d}};l("extend-esri")&&(a.numberUtils=w);return w})},
"esri/renderers/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/has dojo/date/locale ../kernel ../numberUtils ../Color dojo/i18n!../nls/jsapi dojo/i18n!dojo/cldr/nls/gregorian".split(" "),function(l,p,g,a,h,w,r,e,d){function K(a){return a&&p.map(a,function(a){return new r(a)})}function C(a,c,d){var e="";0===c?e=D.lt+" ":c===d&&(e=D.gt+" ");return e+a}var y={},D={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%"},u={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},
c={millisecond:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},second:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"medium"}},minute:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},hour:{dateOptions:{formatLength:"long"},timeOptions:{formatLength:"short"}},day:{selector:"date",dateOptions:{formatLength:"long"}},month:{selector:"date",dateOptions:{formatLength:"long"}},year:{selector:"date",dateOptions:{selector:"year"}}},x={formatLength:"short",
fullYear:!0},I={formatLength:"short"};l.mixin(y,{timelineDateFormatOptions:{selector:"date",dateOptions:{formatLength:"short",fullYear:!0}},formatDate:function(c,e){var g,t=[];null==c||c instanceof Date||(c=new Date(c));e=e||{};e=l.mixin({},e);var v=e.selector?e.selector.toLowerCase():null;g=!v||-1<v.indexOf("time");v=!v||-1<v.indexOf("date");g&&(e.timeOptions=e.timeOptions||I,e.timeOptions&&(e.timeOptions=l.mixin({},e.timeOptions),e.timeOptions.selector=e.timeOptions.selector||"time",t.push(e.timeOptions)));
v&&(e.dateOptions=e.dateOptions||x,e.dateOptions&&(e.dateOptions=l.mixin({},e.dateOptions),e.dateOptions.selector=e.dateOptions.selector||"date",t.push(e.dateOptions)));t&&t.length?(t=p.map(t,function(d){return a.format(c,d)}),g=1==t.length?t[0]:d["dateTimeFormat-medium"].replace(/\'/g,"").replace(/\{(\d+)\}/g,function(a,c){return t[c]})):g=a.format(c);return g},createColorStops:function(a){var c=a.values,d=a.colors,e=a.labelIndexes,g=a.isDate,t=a.dateFormatOptions;a=[];return a=p.map(c,function(a,
v){var h=null;if(!e||-1<p.indexOf(e,v)){var l;(l=g?y.formatDate(a,t):w.format(a))&&(h=C(l,v,c.length-1))}return{value:a,color:d[v],label:h}})},updateColorStops:function(a){var c=a.stops,d=a.changes,e=a.isDate,g=a.dateFormatOptions,t=[],h,l=p.map(c,function(a){return a.value});p.forEach(d,function(a){t.push(a.index);l[a.index]=a.value});h=w.round(l,{indexes:t});p.forEach(c,function(a,d){a.value=l[d];if(null!=a.label){var t,v=null;(t=e?y.formatDate(h[d],g):w.format(h[d]))&&(v=C(t,d,c.length-1));a.label=
v}})},createClassBreakLabel:function(a){var c=a.minValue,d=a.maxValue,g=a.isFirstBreak?"":D.gt+" ";a="percent-of-total"===a.normalizationType?D.pct:"";c=null==c?"":w.format(c);d=null==d?"":w.format(d);return g+c+a+" "+e.smartMapping.minToMax+" "+d+a},setLabelsForClassBreaks:function(a){var c=a.classBreaks,d=a.classificationMethod,e=a.normalizationType,g=[];c&&c.length&&("standard-deviation"===d?console.log("setLabelsForClassBreaks: cannot set labels for class breaks generated using 'standard-deviation' method."):
a.round?(g.push(c[0].minValue),p.forEach(c,function(a){g.push(a.maxValue)}),g=w.round(g),p.forEach(c,function(a,c){a.label=y.createClassBreakLabel({minValue:0===c?g[0]:g[c],maxValue:g[c+1],isFirstBreak:0===c,normalizationType:e})})):p.forEach(c,function(a,c){a.label=y.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===c,normalizationType:e})}))},updateClassBreak:function(a){var c=a.classBreaks,d=a.normalizationType,e=a.change,g=e.index,e=e.value,h=-1,l=-1,t=c.length;"standard-deviation"===
a.classificationMethod?console.log("updateClassBreak: cannot update labels for class breaks generated using 'standard-deviation' method."):(0===g?h=g:g===t?l=g-1:(l=g-1,h=g),-1<h&&h<t&&(a=c[h],a.minValue=e,a.label=y.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===h,normalizationType:d})),-1<l&&l<t&&(a=c[l],a.maxValue=e,a.label=y.createClassBreakLabel({minValue:a.minValue,maxValue:a.maxValue,isFirstBreak:0===l,normalizationType:d})))},calculateDateFormatInterval:function(a){var c,
d,e=a.length,g,h,l,t,r,w,x=Infinity,y;a=p.map(a,function(a){return new Date(a)});for(c=0;c<e-1;c++){g=a[c];l=[];r=Infinity;w="";for(d=c+1;d<e;d++)h=a[d],h=g.getFullYear()!==h.getFullYear()&&"year"||g.getMonth()!==h.getMonth()&&"month"||g.getDate()!==h.getDate()&&"day"||g.getHours()!==h.getHours()&&"hour"||g.getMinutes()!==h.getMinutes()&&"minute"||g.getSeconds()!==h.getSeconds()&&"second"||"millisecond",t=u[h],t<r&&(r=t,w=h),l.push(h);r<x&&(x=r,y=w)}return y},createUniqueValueLabel:function(a){var d=
a.value,e=a.fieldInfo,g=a.domain;a=a.dateFormatInterval;var h=String(d);(g=g&&g.codedValues?g.getName(d):null)?h=g:"number"===typeof d&&(h=e&&"esriFieldTypeDate"===e.type?y.formatDate(d,a&&c[a]):w.format(d));return h},cloneColorInfo:function(a){var c;a&&(c=l.mixin({},a),c.colors=K(c.colors),c.stops=c.stops&&p.map(c.stops,function(a){a=l.mixin({},a);a.color&&(a.color=new r(a.color));return a}),c.legendOptions&&(c.legendOptions=l.mixin({},c.legendOptions)));return c},cloneOpacityInfo:function(a){var c;
if(a){c=l.mixin({},a);if(a=c.opacityValues)c.opacityValues=a.slice(0);if(a=c.stops)c.stops=p.map(a,function(a){return l.mixin({},a)});if(a=c.legendOptions)c.legendOptions=l.mixin({},a)}return c},cloneSizeInfo:function(a){var c;a&&(c=l.mixin({},a),c.stops&&(c.stops=p.map(c.stops,function(a){return l.mixin({},a)})),(a=c.minSize)&&"object"===typeof a&&(c.minSize=y.cloneSizeInfo(a)),(a=c.maxSize)&&"object"===typeof a&&(c.maxSize=y.cloneSizeInfo(a)),a=c.legendOptions)&&(c.legendOptions=l.mixin({},a),a=
a.customValues)&&(c.legendOptions.customValues=a.slice(0));return c}});g("extend-esri")&&l.setObject("renderer.utils",y,h);return y})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(l,p,g,a,h,w){return l([w,h],{_onMap:function(a){var e=this.constructor._onMap,d;e&&e.FINAL||(delete this.constructor._onMap,e=this.registerConnectEvents(),e.FINAL=!0);a=a.toLowerCase();e[a]?d=this[e[a].method]:(a=this._onCamelCase(a),
this[a]&&(d=a));return d},on:function(g,e){var d=this._onMap(g),h=g.replace(/\-/g,""),l="on"+h in this.domNode;return d||!l?this.inherited(arguments):this.own(a(this.domNode,h,e))[0]},emit:function(a,e,d){var g,h,l,r=a.toLowerCase(),u=this.constructor._onMap||this.registerConnectEvents();h=this[this._onMap(r)];e=e||{};e.target||(e.target=this);h&&u&&u[r]&&(this._onObj2Arr(function(){g=Array.prototype.slice.call(arguments)},u[r].argKeys)(e),l=p.mixin({},arguments),l[2]=g,l[0]=u[r].name.replace(/^on/,
""));return this.inherited(l||arguments)}})})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/Deferred dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/utils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ../renderers/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),function(l,
p,g,a,h,w,r,e,d,K,C,y,D,u,c,x,I,t,v,G,B,Q,H,N,J,A,O,Y,Z,aa,ba,ca,da,R,ea,U,V,P,W,X,S){var M=p([X,t],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,_preserveCacheOnDestroy:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new r([64,64,64]),defaultText:"Aa",sizeRampLightColor:new r([255,255,255]),sizeRampDarkColor:new r([128,128,128]),layerConnects:[],gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",
gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(b,a){g.mixin(this,S.widgets.legend);this._i18n=S.widgets.legend;b=b||{};b.map?a?(this.map=b.map,this.layerInfos=b.layerInfos,this._respectCurrentMapScale=!1===b.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===b.respectVisibility?!1:!0,this._preserveCacheOnDestroy=b.preserveCacheOnDestroy?!0:!1,this.arrangement=b.arrangement===M.ALIGN_RIGHT?M.ALIGN_RIGHT:M.ALIGN_LEFT,this.arrangement===M.ALIGN_RIGHT&&
(this.alignRight=!0),this.autoUpdate=!1===b.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={},this.refresh=e(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var b=["ar","he"],a,c;for(a=0;a<b.length;a+=1)c=b[a],l.locale&&-1!==l.locale.indexOf(c)&&(-1!==l.locale.indexOf("-")?-1!==l.locale.indexOf(c+
"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>d("ie")&&(this._repaintItems=g.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();
this._removeCachedLegendResponses();this._removeHoverHandlers();this.inherited(arguments)},_removeCachedLegendResponses:function(){this._preserveCacheOnDestroy||a.forEach(this.layers,function(b){delete b.legendResponse})},refresh:function(b){if(this.domNode){b?(this.layerInfos=b,this.layers=[],a.forEach(this.layerInfos,function(b){this._isSupportedLayerType(b.layer)&&(b.title&&(b.layer._titleForLegend=b.title),b.layer._hideDefaultSymbol=!1===b.defaultSymbol?!0:!1,b.hideLayers?(this.hideLayersInLegend[b.layer.id]=
b.hideLayers,this._addSubLayersToHide(b)):this.hideLayersInLegend[b.layer.id]=[],b.hoverLabel&&(b.layer._hoverLabel=b.hoverLabel),b.hoverLabels&&(b.layer._hoverLabels=b.hoverLabels),this.layers.push(b.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(b=this.domNode.children.length-1;0<=b;b--)c.destroy(this.domNode.children[b]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&
(this.layers=[],a.forEach(this.layerInfos,function(b){this._isSupportedLayerType(b.layer)&&(b.title&&(b.layer._titleForLegend=b.title),b.layer._hideDefaultSymbol=!1===b.defaultSymbol?!0:!1,b.hideLayers?(this.hideLayersInLegend[b.layer.id]=b.hideLayers,this._addSubLayersToHide(b)):this.hideLayersInLegend[b.layer.id]=[],b.hoverLabel&&(b.layer._hoverLabel=b.hoverLabel),b.hoverLabels&&(b.layer._hoverLabels=b.hoverLabels),this.layers.push(b.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=
!0;this.layers=[];var b=[],f=[];a.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var m;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(m=c.getLayers(),a.forEach(m,function(a){b.push(a.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(m=c.getFeatureLayers(),a.forEach(m,function(b){f.push(b.id)},this))},this);a.forEach(this.map.graphicsLayerIds,function(c){var m=
this.map.getLayer(c);-1==a.indexOf(b,c)&&-1==a.indexOf(f,c)&&this._isSupportedLayerType(m)&&this._isLayerDrawingEnabled(m)&&(m.arcgisProps&&m.arcgisProps.title&&(m._titleForLegend=m.arcgisProps.title),this.layers.push(m))},this)}this._createLegend()},_isLayerDrawingEnabled:function(b){return b&&(b._params&&b._params.drawMode||b.isFeatureReductionActive&&b.isFeatureReductionActive())},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=h.connect(this.map,
"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=h.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=h.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=h.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),a.forEach(this.layers,function(b){var a={};a.oarcConnect=h.connect(b,"onFeatureReductionRendererChange",this,"_refreshLayers");a.oaicConnect=h.connect(b,"onFeatureReductionChange",this,"_refreshLayers");
a.ovcConnect=h.connect(b,"onVisibilityChange",this,"_refreshLayers");a.oocConnect=h.connect(b,"onOpacityChange",this,"_refreshLayers");a.oscConnect=h.connect(b,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass&&b.supportsDynamicLayers&&(a.odcConnect=h.connect(b,"_onDynamicLayersChange",g.hitch(this,"_updateDynamicLayers",b)));"esri.layers.ArcGISImageServiceLayer"===b.declaredClass&&(a.oirConnect=h.connect(b,"onRenderingChange",g.partial(this._updateImageServiceLayers,
this,b)),a.oivrConnect=h.connect(b,"onRendererChange",g.partial(this._updateImageServiceLayers,this,b)));"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass&&(a.oivrConnect=h.connect(b,"onRendererChange",g.hitch(this,"_refreshLayers")));this.layerConnects[b.id]=a},this))},_deactivate:function(){this._ozeConnect&&h.disconnect(this._ozeConnect);this._olaConnect&&h.disconnect(this._olaConnect);this._olroConnect&&h.disconnect(this._olroConnect);this._olrConnect&&h.disconnect(this._olrConnect);
a.forEach(this.layers,function(b){b=this.layerConnects[b.id]||{};b.oarcConnect&&h.disconnect(b.oarcConnect);b.oaicConnect&&h.disconnect(b.oaicConnect);b.ovcConnect&&h.disconnect(b.ovcConnect);b.oocConnect&&h.disconnect(b.oocConnect);b.oscConnect&&h.disconnect(b.oscConnect);b.odcConnect&&h.disconnect(b.odcConnect);b.oirConnect&&h.disconnect(b.oirConnect);b.oivrConnect&&h.disconnect(b.oivrConnect)},this);this.layerConnects=[]},_updateDynamicLayers:function(b){delete b.legendResponse;this._refreshLayers()},
_updateImageServiceLayers:function(b,a){delete a.legendResponse;b._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];a.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);this._isSupportedLayerType(b)&&this.layers.push(b)},this);a.forEach(this.map.graphicsLayerIds,function(b){b=this.map.getLayer(b);this._isSupportedLayerType(b)&&this._isLayerDrawingEnabled(b)&&this.layers.push(b)},this);this.refresh()},_createLegend:function(){var b=
!1,f=!1;x.set(this.domNode,"position","relative");c.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var m=[];a.forEach(this.layers,function(k){if("esri.layers.KMLLayer"==k.declaredClass||"esri.layers.GeoRSSLayer"==k.declaredClass){var n;k.loaded?("esri.layers.KMLLayer"==k.declaredClass?n=k.getLayers():"esri.layers.GeoRSSLayer"==k.declaredClass&&(n=k.getFeatureLayers(),this.hideLayersInLegend[k.id]&&(n=a.filter(n,function(b){return-1==
a.indexOf(this.hideLayersInLegend[k.id],b.id)},this))),a.forEach(n,function(b){"esri.layers.FeatureLayer"==b.declaredClass&&k._titleForLegend&&(b._titleForLegend=k._titleForLegend+" - ","esriGeometryPoint"==b.geometryType?b._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==b.geometryType?b._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==b.geometryType&&(b._titleForLegend+=this.NLS_areas),m.push(b))},this)):h.connect(k,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===
k.declaredClass)if(!k.loaded)h.connect(k,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}));else{if((!this._respectVisibility||this._respectVisibility&&k.visible)&&0<k.layerInfos.length&&a.some(k.layerInfos,function(b){return b.legendURL})){var d=!1;a.forEach(k.layerInfos,function(f){if(f.legendURL&&-1<a.indexOf(k.visibleLayers,f.name)){d||(c.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(k._titleForLegend||k.name||k.id)+"\x3c/span\x3e"},this.domNode),d=!0);
var m;f=f.legendURL;if(k.customParameters||k.customLayerParameters){var n=g.clone(k.customParameters||{});g.mixin(n,k.customLayerParameters||{});for(m in n)f+=(-1===f.indexOf("?")?"?":"\x26")+m+"\x3d"+n[m]}c.create("div",{innerHTML:"\x3cimg src\x3d'"+f+"'/\x3e"},this.domNode);b=!0}},this)}}else"esri.layers.WFSLayer"!==k.declaredClass||k.renderer?m.push(k):(n=c.create("div",{id:this.id+"_"+k.id,"class":"esriLegendService"}),c.create("span",{innerHTML:this._getServiceTitle(k),"class":"esriLegendServiceLabel"},
c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},n))))),c.place(n,this.id,"first"),n=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},n),n=c.create("tbody",{},n),"esriGeometryComplex"===k.geometryType?(this._buildRow_Renderer(k,k._pointSymbol,null,this.NLS_points,null,n),this._buildRow_Renderer(k,k._lineSymbol,null,this.NLS_lines,null,n),this._buildRow_Renderer(k,k._polygonSymbol,null,this.NLS_areas,null,n)):
"esriGeometryPoint"===k.geometryType?this._buildRow_Renderer(k,k._pointSymbol,null,"",null,n):"esriGeometryPolyline"===k.geometryType?this._buildRow_Renderer(k,k._lineSymbol,null,"",null,n):"esriGeometryPolygon"===k.geometryType&&this._buildRow_Renderer(k,k._polygonSymbol,null,"",null,n),f=!0)},this);var n=[];a.forEach(m,function(b){if(!b.loaded)var a=h.connect(b,"onLoad",this,function(b){h.disconnect(a);a=null;this.refresh()});else if((!this._respectVisibility||this._respectVisibility&&b.visible)&&
(b.layerInfos||b.renderer||"esri.layers.ArcGISImageServiceLayer"==b.declaredClass)){var f=c.create("div",{id:this.id+"_"+b.id,style:{display:"none"},"class":"esriLegendService"});c.create("span",{innerHTML:this._getServiceTitle(b),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},f)))));c.place(f,this.id,"first");b.legendResponse||b.renderer&&"esri.renderer.StretchRenderer"!==b.renderer.declaredClass?this._createLegendForLayer(b):
this.isHostedTileService(b)?this._getLayerInfos(b).then(g.hitch(this,function(b){this._createLegendForLayer(b)}),g.hitch(this,function(b){n.push(this._legendRequest(b))})):n.push(this._legendRequest(b))}},this);0!==n.length||b||f?(new y(n)).addCallback(g.hitch(this,function(a){b||f?u.byId(this.id+"_msg").innerHTML="":u.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()})):(u.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate())},_createLegendForLayer:function(b){if(b.legendResponse||
b.renderer||this.isHostedTileService(b)){var f=!1;if(b.legendResponse||this.isHostedTileService(b)){var c=b.dynamicLayerInfos||b.layerInfos;c&&c.length?a.forEach(c,function(c,m){if(!this.hideLayersInLegend[b.id]||-1===a.indexOf(this.hideLayersInLegend[b.id],c.id)){var k=this._buildLegendItems(b,c,m);f=f||k}},this):"esri.layers.ArcGISImageServiceLayer"==b.declaredClass&&(f=this._buildLegendItems(b,{id:0,name:null,title:b.name,subLayerIds:null,parentLayerId:-1},0))}else b.renderer&&(c=b.url?b.url.substring(b.url.lastIndexOf("/")+
1,b.url.length):"fc_"+b.id,f=this._buildLegendItems(b,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));f&&(x.set(u.byId(this.id+"_"+b.id),"display","block"),x.set(u.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(b){if(b.loaded)return 10.01<=b.version?this._legendRequestServer(b):this._legendRequestTools(b);h.connect(b,"onLoad",g.hitch(this,"_legendRequest"))},_legendRequestServer:function(b){var f=b.url,c=f.indexOf("?"),f=-1<c?f.substring(0,c)+"/legend"+f.substring(c):f+"/legend";
(c=b._getToken())&&(f+="?token\x3d"+c);var n=g.hitch(this,"_processLegendResponse"),k={f:"json"};b._params.dynamicLayers&&(k.dynamicLayers=D.stringify(this._createDynamicLayers(b)),"[{}]"===k.dynamicLayers&&(k.dynamicLayers="[]"));b._params.bandIds&&(k.bandIds=b._params.bandIds);b._params.renderingRule?k.renderingRule=b._params.renderingRule:b.rasterFunctionInfos&&0<b.rasterFunctionInfos.length&&a.forEach(b.rasterFunctionInfos,function(b){b&&b.name&&"none"===b.name.toLowerCase()&&(k.renderingRule=
D.stringify({rasterFunction:b.name}))});return N({url:f,content:k,callbackParamName:"callback",load:function(a,f){n(b,a,f)},error:H.defaults.io.errorHandler})},_legendRequestTools:function(b){var a=b.url.toLowerCase().indexOf("/rest/"),a=b.url.substring(0,a)+b.url.substring(a+5,b.url.length),a=this._legendUrl+"?soapUrl\x3d"+window.escape(a);if(!d("ie")||8<d("ie"))a+="\x26returnbytes\x3dtrue";var c=g.hitch(this,"_processLegendResponse");return N({url:a,content:{f:"json"},callbackParamName:"callback",
load:function(a,f){c(b,a,f)},error:H.defaults.io.errorHandler})},_processLegendResponse:function(b,a){a&&a.layers?(b.legendResponse=a,u.byId(this.id+"_"+b.id)&&c.empty(u.byId(this.id+"_"+b.id)),c.create("span",{innerHTML:this._getServiceTitle(b),"class":"esriLegendServiceLabel"},c.create("td",{align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},u.byId(this.id+"_"+b.id)))))),this._createLegendForLayer(b)):console.log("Legend could not get generated for "+b.url+": "+
w.toJson(a))},_buildLegendItems:function(b,f,m){var n=!1,k=u.byId(this.id+"_"+b.id),d=f.parentLayerId;if(f.subLayerIds)b=c.create("div",{id:this.id+"_"+b.id+"_"+f.id+"_group",style:{display:"none"},"class":-1==d?0<m?"esriLegendGroupLayer":"":this._legendAlign},-1==d?k:u.byId(this.id+"_"+b.id+"_"+d+"_group")),c.create("td",{innerHTML:B.encode(f.name),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},b))));else{if(this._respectVisibility&&
b.visibleLayers)if(m=b.dynamicLayerInfos||b.layerInfos)if(b._params&&b._params.layers){if(-1===a.indexOf(b.visibleLayers,f.id))return n}else{if(m=this._getReallyVisibleLayers(m,b.visibleLayers),-1===a.indexOf(m,f.id))return n}else if(-1===a.indexOf(b.visibleLayers,f.id))return n;k=c.create("div",{id:this.id+"_"+b.id+"_"+f.id,style:{display:"none"},"class":-1<d?this._legendAlign:""},-1==d?k:u.byId(this.id+"_"+b.id+"_"+d+"_group"));c.create("td",{innerHTML:B.encode(f.name)||"",align:this._align},c.create("tr",
{},c.create("tbody",{},c.create("table",{width:"95%","class":"esriLegendLayerLabel"},k))));m=b.dynamicLayerInfos||b.layerInfos;d=!1;m&&m.length&&(d=a.some(m,function(b){return!!b.drawingInfo}));if(b.legendResponse)n=n||this._buildLegendItems_Tools(b,f,k);else if(b.renderer||d)n=n||this._buildLegendItems_Renderer(b,f,k)}return n},_getReallyVisibleLayers:function(b,f){if(!b||!f||!f.length)return[];var c=[],n=[],k;for(k=0;k<b.length;k++)if(b[k].subLayerIds){if(-1===a.indexOf(f,b[k].id)||-1<a.indexOf(n,
b[k].id))n=n.concat(b[k].subLayerIds)}else-1<a.indexOf(f,b[k].id)&&-1===a.indexOf(n,b[k].id)&&c.push(b[k].id);return c},_buildLegendItems_Tools:function(b,f,m){var n=f.parentLayerId,k=this.map.getScale(),d=!1,e=function(b,a){var f,c;for(f=0;f<b.length;f++)if(a.dynamicLayerInfos)for(c=0;c<a.dynamicLayerInfos[c].length;c++){if(a.dynamicLayerInfos[c].mapLayerId==b[f].layerId)return b[f]}else if(a.id==b[f].layerId)return b[f];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(b,
f,k)){var g=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass||"esri.layers.ArcGISMapServiceLayer"===b.declaredClass)){var h=this._getEffectiveScale(b,f);if(h.minScale&&h.minScale<k||h.maxScale&&h.maxScale>k)g=!1}if(g){var k=e(b.legendResponse.layers,f),l=k.legendType,q=k.layerType,p=k.legend;if(p){"esri.layers.ArcGISImageServiceLayer"!==b.declaredClass&&this._sanitizeLegendResponse(b,k,f);m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%",
"class":"esriLegendLayer"},m);var T=c.create("tbody",{},m);(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(m,b,f);var r=[];a.forEach(p,function(c){if(!(10.1<=b.version&&!c.values&&1<p.length)||!b._hideDefaultSymbol&&"\x3call other values\x3e"!==c.label&&(c.label||"esri.layers.ArcGISImageServiceLayer"===b.declaredClass&&10.3<=b.version||"Raster Layer"===q)){var m=c.label;if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)d=!0,m&&-1!==a.indexOf(r,m)||(r.push(m),this._buildRow_Tools(c,
T,b,f.id,l))}},this)}}}d&&(x.set(u.byId(this.id+"_"+b.id+"_"+f.id),"display","block"),-1<n&&(x.set(u.byId(this.id+"_"+b.id+"_"+n+"_group"),"display","block"),this._findParentGroup(b.id,b,n)));return d},_getLayerInfos:function(b){var f=new C,c=b.dynamicLayerInfos||b.layerInfos;if(c&&c.length)if(a.some(c,function(b){return!!b.drawingInfo}))f.resolve(b);else{var n=b.url,k=n.indexOf("?"),n=-1==k?n+"/layers":n.substring(0,k)+"/layers"+n.substring(k,n.length);N({url:n,content:{f:"json"},callbackParamName:"callback",
load:function(m,k){m.layers?(a.forEach(c,function(b){var c=a.filter(m.layers,function(a){return b.source?a.id===b.source.mapLayerId:a.id===b.id});c&&c[0]&&c[0].drawingInfo&&(b.drawingInfo=c[0].drawingInfo,b.fields=c[0].fields)}),f.resolve(b)):f.reject(b)},error:function(a){f.reject(b)}})}return f},_sanitizeLegendResponse:function(b,c,m){var f=c.legend;if(10.1<=b.version&&1<f.length&&!c._sanitized){b=g.getObject("layerDefinition.drawingInfo.renderer",!1,m);var k,d;b||(b=g.getObject("drawingInfo.renderer",
!1,m));a.some(f,function(b){if(b.values)return!0})&&a.some(f,function(b,a){b.values||(d=a,k=b);return!!k});b?"uniqueValue"===b.type?k&&(f.splice(d,1),f.push(k)):"classBreaks"===b.type&&(k&&f.splice(d,1),f.reverse(),k&&f.push(k)):k&&(f.splice(d,1),f.push(k));c._sanitized=!0}},_buildRow_Tools:function(b,a,m,n,k){var f=c.create("tr",{},a),e;this.alignRight?(a=c.create("td",{align:this._isRightToLeft?"left":"right"},f),e=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},f)):(e=c.create("td",
{width:35,align:"center"},f),a=c.create("td",{},f));f=b.url;(!d("ie")||9<=d("ie")||9>d("ie")&&"esri.layers.ArcGISImageServiceLayer"===m.declaredClass)&&b.imageData&&0<b.imageData.length?f="data:image/png;base64,"+b.imageData:0!==b.url.indexOf("http")&&(f=m.url+"/"+n+"/images/"+b.url,(n=m._getToken())&&(f+="?token\x3d"+n));n=c.create("img",{src:f,border:0,style:"opacity:"+m.opacity},e);b=c.create("td",{innerHTML:B.encode(b.label),align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",
{width:"95%",dir:"ltr"},a))));k&&"Stretched"===k&&10.3<=m.version&&"esri.layers.ArcGISImageServiceLayer"===m.declaredClass&&(b.style.verticalAlign="top",b.style.lineHeight="1",n.style.marginBottom="-1px",n.style.display="block",a.style.verticalAlign="top");9>d("ie")&&(n.style.filter="alpha(opacity\x3d"+100*m.opacity+")")},_getVariable:function(b,a,c){var f;b&&(f=(b=b.getVisualVariablesForType(a,c))&&b[0]);return f},_getVariables:function(b,c,m){b=[this._getVariable(b,"colorInfo",!1),this._getVariable(b,
"opacityInfo",!1),this._getVariable(b,"sizeInfo",!1)];return c?a.filter(b,function(b){return!(!b||b.field!==c||b.normalizationField!=m)}):b},_getFieldAlias:function(b,a,c){var f=a.infoTemplate||(a.infoTemplates&&c&&a.infoTemplates[c.id]?a.infoTemplates[c.id].infoTemplate:null),f=f&&f.getFieldInfo&&f.getFieldInfo(b);b=g.isFunction(b)?null:this.getField(a,b,c);a=f||b;c="";a&&(c=f&&f.label||b&&b.alias||a.name||a.fieldName);return c},_getDomainName:function(b,a,c,d){var f;b&&!g.isFunction(b)&&(f=(c=(b=
this.getField(c,b,d))&&c.getDomain?c.getDomain(b.name):null)&&c.codedValues?c.getName(a):null);return f},_getRampTitle:function(b,a,c){var f,k=b.field,m=b.normalizationField,d=!1,e=!1,h=!1,k=g.isFunction(k)?null:k,m=g.isFunction(m)?null:m;if(b.legendOptions&&b.legendOptions.title)f=b.legendOptions.title;else if(b.valueExpressionTitle)f=b.valueExpressionTitle;else{if(a.renderer&&a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables){var l=a.renderer.authoringInfo.visualVariables;for(b=
0;b<l.length;b++){var q=l[b];if("colorInfo"===q.type&&"ratio"===q.style){d=!0;break}else if("colorInfo"===q.type&&"percent"===q.style){e=!0;break}else if("colorInfo"===q.type&&"percentTotal"===q.style){h=!0;break}}}(d=h&&"showRatioPercentTotal"||e&&"showRatioPercent"||d&&"showRatio"||m&&"showNormField"||k&&"showField"||null)&&(f=J.substitute({field:k&&this._getFieldAlias(k,a,c),normField:m&&this._getFieldAlias(m,a,c)},this._i18n[d]))}return f},_getRendererTitle:function(b,a,c){var f;if(b){var k,m,
d;"esri.renderer.ClassBreaksRenderer"===b.declaredClass&&(k=b.attributeField,m=b.normalizationField,d="percent-of-total"===b.normalizationType);k=g.isFunction(k)?null:k;m=g.isFunction(m)?null:m;b.legendOptions&&b.legendOptions.title?f=b.legendOptions.title:b.valueExpressionTitle?f=b.valueExpressionTitle:(b=m&&"showNormField"||(d?"showNormPct":null)||k&&"showField"||null)&&(f=J.substitute({field:k&&this._getFieldAlias(k,a,c),normField:m&&this._getFieldAlias(m,a,c)},this._i18n[b]))}return f},_buildLegendItems_Renderer:function(b,
f,m){var d=f.parentLayerId,k=this.map,e=k.getScale(),h,l=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(b,f,e)){var z,E,q,p,r,t,v,w;q="esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass?b.renderer.renderer:f&&f.drawingInfo?W.fromJson(g.clone(f.drawingInfo.renderer)):b.isFeatureReductionActive&&b.isFeatureReductionActive()?b.getFeatureReductionRenderer():b.renderer;if("esri.renderer.ScaleDependentRenderer"===q.declaredClass&&(q=(k="zoom"===q.rangeType?q.getRendererInfoByZoom(k.getZoom()):
q.getRendererInfoByScale(e))&&k.renderer,!q))return!1;var F=this._getVariables(q),y=a.filter(F,function(b){return!!b}).length,e=F[0],k=F[1],F=F[2],A,D,C,G,H;e&&(p=this._getMedianColor(q,e),e.field&&(t=g.isFunction(e.field)?null:this.getField(b,e.field,f)),A=!(e.legendOptions&&!1===e.legendOptions.showLegend));k&&(k.field&&(w=g.isFunction(k.field)?null:this.getField(b,k.field,f)),D=!(k.legendOptions&&!1===k.legendOptions.showLegend));F&&(F.field&&(v=g.isFunction(F.field)?null:this.getField(b,F.field,
f)),C=!(F.legendOptions&&!1===F.legendOptions.showLegend));if("esri.renderer.HeatmapRenderer"===q.declaredClass)h=l=!0,this._showHeatRamp(b,f,q,m);else if("esri.renderer.DotDensityRenderer"===q.declaredClass)h=l=!0,this._showDotDensityLegend(b,f,q,m);else if("esri.renderer.TemporalRenderer"===q.declaredClass)h=l=!0,E=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),z=c.create("tbody",{},E),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(E,b,f),q.latestObservationRenderer&&
"esri.renderer.SimpleRenderer"===q.latestObservationRenderer.declaredClass&&this._buildRow_Renderer(b,q.latestObservationRenderer.symbol,p,B.encode(q.latestObservationRenderer.label)||this.NLS_currentObservations,null,z),q.observationRenderer&&"esri.renderer.SimpleRenderer"===q.observationRenderer.declaredClass&&this._buildRow_Renderer(b,q.observationRenderer.symbol,p,B.encode(q.observationRenderer.label)||this.NLS_previousObservations,null,z);else if("esri.renderer.UniqueValueRenderer"===q.declaredClass){if(q.infos&&
0<q.infos.length){h=l=!0;if(q.legendOptions&&q.legendOptions.title||q.valueExpressionTitle)E=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),z=c.create("tbody",{},E),y=q.legendOptions&&q.legendOptions.title?q.legendOptions.title:q.valueExpressionTitle,this._buildRow_Renderer(b,null,p,B.encode(y),null,z);E=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m);z=c.create("tbody",{},E);(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(E,
b,f);q.attributeField&&F&&this._addSubHeader(z,this._getFieldAlias(q.attributeField,b,f));var I=[];a.forEach(q.infos,function(c){var m=null;b._editable&&b.types&&(m=this._getTemplateFromTypes(b.types,c.value));var k=c.label;null==k&&(k=this._getDomainName(q.attributeField,c.value,b,f)||c.value);-1===a.indexOf(I,k)&&(I.push(k),this._buildRow_Renderer(b,c.symbol,p,B.encode(k),m,z))},this)}H=this._displayDefaultSymbol(b,q,m)}else if("esri.renderer.ClassBreaksRenderer"===q.declaredClass){if(q.infos&&
0<q.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass)h=l=!0,G=this._isUnclassedRenderer(q),e||1!==q.infos.length||(r=(r=q.infos[0])&&r.symbol),G||(E=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),z=c.create("tbody",{},E),y=this._getRendererTitle(q,b,f),this._buildRow_Renderer(b,null,p,B.encode(y),null,z)),E=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),z=c.create("tbody",{},E),(b._hoverLabel||
b._hoverLabels)&&this._createHoverAction(E,b,f),G&&F&&C||(y=q.infos.slice(0).reverse(),a.forEach(y,function(a){var c=a.label;null!=c||G||(c=a.minValue+" - "+a.maxValue);this._buildRow_Renderer(b,a.symbol,p,B.encode(c),null,z)},this)),"esri.layers.ArcGISImageServiceVectorLayer"!==b.declaredClass||b.renderer.style!==R.STYLE_SCALAR&&b.renderer.style!==R.STYLE_SINGLE_ARROW||(this._buildRow_Renderer(b,q.defaultSymbol,null,"",null,z),b._hideDefaultSymbol=!0);G||(H=this._displayDefaultSymbol(b,q,m))}else"esri.renderer.SimpleRenderer"===
q.declaredClass&&(h=l=!0,E=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),z=c.create("tbody",{},E),(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(E,b,f),r=null,b._editable&&b.templates&&0<b.templates.length&&(r=b.templates[0]),E=1<y?null:t&&A||w&&D||v&&C,this._buildRow_Renderer(b,q.symbol,p,B.encode(E?this._getRampTitle(1<y?null:e||k||F,b,f):q.label),r,z),r=e?null:q.symbol,E&&(t=w=v=null));h&&(e&&A&&(e.field||e.valueExpression)&&this._showGradientRamp(b,
f,q,null,m,e,t,null,F&&C?!0:!1),F&&C&&(F.field||F.valueExpression)&&(h=e&&A||"esri.renderer.UniqueValueRenderer"===q.declaredClass?!1:!0,this._showSizeLegend(b,f,q,F,p,m,v,null,h)),k&&D&&(k.field||k.valueExpression)&&this._showGradientRamp(b,f,q,r&&!r.url&&r.color?r.color:this.transparencyRampColor,m,k,w,null,!1));H||G&&!A&&!C&&!D||(H=this._displayDefaultSymbol(b,q,m));l=l||H}l&&(x.set(u.byId(this.id+"_"+b.id+"_"+f.id),"display","block"),-1<d&&(x.set(u.byId(this.id+"_"+b.id+"_"+d+"_group"),"display",
"block"),this._findParentGroup(b.id,d)));return l},_isUnclassedRenderer:function(b,a){var c;if("esri.renderer.ClassBreaksRenderer"===b.declaredClass&&b.infos&&1===b.infos.length){c=b.attributeField;var f=b.normalizationField;c=a?c===a:!!this._getVariables(b,c,f).length}return c},_displayDefaultSymbol:function(b,a,m){var f;!b._hideDefaultSymbol&&a.defaultSymbol&&(f=!0,m=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),m=c.create("tbody",{},m),this._buildRow_Renderer(b,
a.defaultSymbol,null,B.encode(a.defaultLabel)||"others",null,m));return f},_showGradientRamp:function(b,a,m,d,k,e,h,l,z){z=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(z?"":" esriLegendSubFragment")},k);k=c.create("tbody",{},z);(b._hoverLabel||b._hoverLabels||l)&&this._createHoverAction(z,b,a,l);(h||e.valueExpression||e.legendOptions&&e.legendOptions.title)&&this._addSubHeader(k,this._getRampTitle(e,b,a));h=e.field;var f;h&&(f=g.isFunction(h)?null:this.getField(b,
h,a));(a=this._getRampStops(m,e,d,f&&"esriFieldTypeDate"===f.type))&&a.length&&this._drawGradientRamp(k,a,!0,b,this._getRampBorderColor(m),!!d)},_getMedianColor:function(b,a){var c,f;a.colors?(c=a.minDataValue,f=a.maxDataValue):a.stops&&(c=a.stops[0].value,f=a.stops[a.stops.length-1].value);return b.getColor(c+(f-c)/2,{colorInfo:a})},_getRampStops:function(b,c,m,d){var f,e,n,g,h=!1;c.colors||c.opacityValues?(e=c.maxDataValue-c.minDataValue,f=a.map([0,.25,.5,.75,1],function(b){n=c.minDataValue+b*e;
return Number(n.toFixed(6))}),this._checkPrecision(0,4,f)):c.stops&&(f=a.map(c.stops,function(b){return b.value}),(h=a.some(c.stops,function(b){return!!b.label}))&&(g=a.map(c.stops,function(b){return b.label})));var l=f[0],q,p;e=f[f.length-1]-l;return a.map(f,function(a,k){m?(q=new r(m.toRgba()),p=b.getOpacity(a,{opacityInfo:c}),null!=p&&(q.a=p)):q=b.getColor(a,{colorInfo:c});var n="";if(h)n=g[k];else{var n=d?O.formatDate(a,O.timelineDateFormatOptions):A.format(a),z="";0===k?z=this._specialChars.lt+
" ":k===f.length-1&&(z=this._specialChars.gt+" ");n=z+n}return{value:a,color:q,offset:1-(a-l)/e,label:n}},this).reverse()},_checkPrecision:function(b,a,c){var f=b+(a-b)/2,k=c[b],m=c[f],d=c[a],e=Math.floor(k),g=Math.floor(m),h=Math.floor(d);e===k&&h===d&&g!==m&&e!==g&&h!==g&&(c[f]=g);b+1!==f&&this._checkPrecision(b,f,c);f+1!==a&&this._checkPrecision(f,a,c)},_getRampBorderColor:function(b){var a;if("esri.renderer.SimpleRenderer"===b.declaredClass)a=b.symbol;else if("esri.renderer.UniqueValueRenderer"===
b.declaredClass||"esri.renderer.ClassBreaksRenderer"===b.declaredClass)a=b.infos[0].symbol;return(b=a&&-1===a.type.indexOf("linesymbol")?a.getStroke():null)&&b.color},_drawGradientRamp:function(b,f,m,e,k,g){var n=c.create("tr",{},b),h,l,p,q,L,t=f.length-1,u;q=0;this.alignRight?(b=c.create("td",{align:this._isRightToLeft?"left":"right"},n),h=c.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},n)):(h=c.create("td",{width:this.gradientWidth,align:"center"},n),b=c.create("td",
{},n));n=k&&0<k.a&&!(240<=k.r&&240<=k.g&&240<=k.b);l=c.create("div",{"class":n?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},h);h=c.create("div",{"class":"esriLegendColorRamp"+(g?" esriLegendTransparencyRamp":"")},l);g=x.get(h,"width");n&&(k=9>d("ie")?k.toHex():"rgba("+k.toRgba().join(",")+")",x.set(h,"border",this.colorRampBorder+" "+k));m?(k=this.gradientHeight*t,x.set(h,"height",k+"px")):k=x.get(h,"height");x.set(l,"height",k+"px");n=v.createSurface(h,
g,k);9>d("ie")&&(q=n.getEventSource(),x.set(q,"position","relative"),x.set(q.parentNode,"position","relative"),q=1);try{m&&a.forEach(f,function(b,a){b.offset=a/t}),L=n.createRect({x:-q,y:-q,width:g+q,height:k+q}),L.setFill({type:"linear",x1:0,y1:0,x2:0,y2:k,colors:f}).setStroke(null),n.createRect({width:g,height:k}).setFill(new r([255,255,255,1-e.opacity])).setStroke(null),this._surfaceItems.push(n)}catch(fa){n.clear(),n.destroy()}a.forEach(f,function(b,a){if(b.label){u="top:"+100*b.offset+"%;";var k=
"";0===a&&(k+=" esriLegendColorRampTickFirst");a===f.length-1&&(k+=" esriLegendColorRampTickLast");c.create("div",{"class":"esriLegendColorRampTick"+k,innerHTML:"\x26nbsp;",style:u},l)}});p=c.create("div",{"class":"esriLegendColorRampLabels",style:{height:k+this.gradientHeight+"px"}},b);m?a.forEach(f,function(b){c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:B.encode(b.label)||"\x26nbsp;"},p)}):(c.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},p),c.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(k+this.gradientHeight-2*this.gradientHeight)+"px;"},p))},_showHeatRamp:function(b,a,m,d,k){var f,e=m.field;f=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=c.create("tbody",{},f);(b._hoverLabel||b._hoverLabels||k)&&this._createHoverAction(f,b,a,k);(e=e&&this.getField(b,e,a))&&this._addSubHeader(d,this._getFieldAlias(e.name,b,a));a=this._getHeatmapStops(m);a.length&&this._drawGradientRamp(d,
a,!1,b)},_getHeatmapStops:function(b){var c=b.colorStops;b=b.colors;var d,e,k,g;c&&c[0]?(d=c.length-1,(b=c[0]&&null!=c[0].ratio)?(b=c[d])&&1!==b.ratio&&(c=c.slice(0),c.push({ratio:1,color:b.color}),d++):(e=c[0].value,k=c[d].value-e,c=a.map(c,function(b){return{color:b.color,ratio:(b.value-e)/k}}))):b&&b[0]&&(d=b.length-1,g=1/(b.length-1),c=a.map(b,function(b,a){return{color:b,ratio:a*g}}));c=a.map(c,function(b,a){var c="";0===a?c="Low":a===d&&(c="High");return{color:b.color,label:c,offset:1-b.ratio}});
return c.reverse()},_showDotDensityLegend:function(b,f,d,e){var k=d.legendOptions,m,n,h,l,p,q,r,t=this.dotDensitySwatchSize,u=Math.round(t/2);k&&(n=k.backgroundColor,h=k.outline,l=k.valueUnit,p=k.dotCoverage);p=(p||this.dotCoverage)/100;r=Math.round(t*t/Math.pow(d.dotSize,2)*p);e=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);q=c.create("tbody",{},e);(b._hoverLabel||b._hoverLabels)&&this._createHoverAction(e,b,f);this._addSubHeader(q,J.substitute({value:d.dotValue,
unit:l||""},this.NLS_dotValue));a.forEach(d.fields,function(a){a=g.mixin({},a);a.numPoints=r;m=new U(d._generateImageSrc(t,t,[a],{x:0,y:0},{x:t,y:t},n),h||d.outline,t,t);a=this.getField(b,a.name,f)||a;this._buildRow_Renderer(b,m,null,B.encode(this._getFieldAlias(a.name,b,f)),null,q,{type:"path",path:"M "+-u+","+-u+" L "+u+","+-u+" L "+u+","+u+" L "+-u+","+u+" L "+-u+","+-u+" E"})},this)},_showSizeLegend:function(b,a,d,e,k,h,l,p,z){var f=e.legendOptions,f=f&&f.customValues;k=this._getSizeSymbol(d,
k);if((!e.valueUnit||"unknown"===e.valueUnit)&&k&&(f||null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue||e.stops&&!(1>=e.stops.length))){z=c.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(z?"":" esriLegendSubFragment")},h);h=c.create("tbody",{},z);(b._hoverLabel||b._hoverLabels||p)&&this._createHoverAction(z,b,a,p);(l||e.valueExpression||e.legendOptions&&e.legendOptions.title)&&this._addSubHeader(h,this._getRampTitle(e,b,a));l=e.field;
var m;p=g.isFunction(l);l&&(m=p?null:b.isFeatureReductionActive&&b.isFeatureReductionActive()?b.getFeatureReductionField(l):this.getField(b,l,a));a=m&&"esriFieldTypeDate"===m.type;var f=f||this._getDataValues(d,k,e,a),n,r=f.length-1;for(m=r;0<=m;m--)z=f[m],k=P.fromJson(k.toJson()),this._applySize(k,d,e,z),z=a?O.formatDate(z,O.timelineDateFormatOptions):A.format(z),n="",m===r?n=this._specialChars.gt+" ":0===m&&(n=l&&!p&&"cluster_count"===l.toLowerCase()&&1===f[m]?"":this._specialChars.lt+" "),n="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+
B.encode(n+z)+"\x3c/span\x3e",this._buildRow_Renderer(b,k,null,n,null,h)}},_getSizeSymbol:function(b,a){var c,f;if("esri.renderer.SimpleRenderer"===b.declaredClass)c=b.symbol;else if("esri.renderer.VectorFieldRenderer"===b.declaredClass)c=b.defaultSymbol;else if("esri.renderer.UniqueValueRenderer"===b.declaredClass||"esri.renderer.ClassBreaksRenderer"===b.declaredClass)c=b.infos[0].symbol,f=1<b.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=P.fromJson(c.toJson()),a||f)-1!==c.type.indexOf("linesymbol")?
c.setColor(new r(this.sizeRampDarkColor)):(c.setColor(new r(this.sizeRampLightColor)),c.setOutline&&(f=new V,f.setColor(new r(this.sizeRampDarkColor)),f.setWidth(1.5),c.setOutline(f)));return c},_getDataValues:function(b,c,d,e,k,g){k=null==k?5:k;g=null==g?20:g;var f=b.getSizeRangeAtScale(d,this.map.getScale());k=this._interpolateSizeRange(f,k);var m=this._getDataRange(d),h=a.map(k,function(b){return this._getDataValueFromSize(b,m,f)},this);if(!e){var n,h=A.round(h);for(e=1;e<h.length-1;e++)if(n=this._roundDataValue(b,
c,d,h[e],h[e-1],g))h[e]=n[0],k[e]=n[1]}return h},_getDataRange:function(b){var a=b.stops;return a?{min:a[0].value,max:a[a.length-1].value}:{min:b.minDataValue,max:b.maxDataValue}},_interpolateSizeRange:function(b,a){var c=b.minSize,f=(b.maxSize-c)/(a-1),d,e=[];for(d=0;d<a;d++)e.push(c+f*d);return e},_getDataValueFromSize:function(b,a,c){var f=c.minSize;c=c.maxSize;var d=a.min;a=a.max;return b<=f?d:b>=c?a:(b-f)/(c-f)*(a-d)+d},_roundDataValue:function(b,a,c,d,e,g){var f=this._getSize(a,b,c,d);e=this._getSize(a,
b,c,e);var k,m=A.getDigits(d),h=m.integer,m=m.fractional,n,l,p,r,t,u,v,w,L,x,y;0<d&&1>d&&(k=Math.pow(10,m),d*=k,h=A.getDigits(d).integer);for(--h;0<=h&&(n=Math.pow(10,h),m=Math.floor(d/n)*n,n*=Math.ceil(d/n),null!=k&&(m/=k,n/=k),l=(m+n)/2,l=A.round([m,l,n],{indexes:[1]})[1],p=this._getSize(a,b,c,m),r=this._getSize(a,b,c,n),t=this._getSize(a,b,c,l),u=A.getPctChange(f,p,e,null),v=A.getPctChange(f,r,e,null),w=A.getPctChange(f,t,e,null),L=u.prev<=g,x=v.prev<=g,L&&x&&(u.prev<=v.prev?(L=!0,x=!1):(x=!0,
L=!1)),L?y=[m,p]:x?y=[n,r]:w.prev<=g&&(y=[l,t]),!y);h--);return y},_applySize:function(b,a,c,d){var f=b.type;a=this._getSize(b,a,c,d);switch(f){case "simplemarkersymbol":b.setSize(a);break;case "picturemarkersymbol":f=b.width;c=b.height;b.setHeight(a);b.setWidth(f/c*a);break;case "simplelinesymbol":case "cartographiclinesymbol":b.setWidth(a);break;case "textsymbol":b.font&&b.font.setSize(a)}},_getSize:function(b,a,c,d){return a.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==b.type.indexOf("markersymbol")?
b.style:null})},_buildRow_Renderer:function(b,a,d,e,k,g,h){var f=c.create("tr",{},g),m;this.alignRight?(g=c.create("td",{align:this._isRightToLeft?"left":"right"},f),a&&(m=c.create("td",{align:this._isRightToLeft?"left":"right",width:35},f))):(a&&(m=c.create("td",{width:35,align:"center"},f)),g=c.create("td",{},f));var n=f=30,l;if(a){if("simplemarkersymbol"==a.type)f=Math.min(Math.max(f,a.size+12),125),n=Math.min(Math.max(n,a.size+12),125);else if("picturemarkersymbol"==a.type)f=Math.min(Math.max(f,
a.width),125),n=Math.min(a.height||n,125);else if("textsymbol"==a.type){var p,r;a.text||(p=a.text,r=!0,a.setText(this.defaultText));f=Math.min(Math.max(f,a.getWidth()+12),125);n=Math.min(Math.max(n,a.getHeight()+12),125);r&&a.setText(p)}l=c.create("div",{style:"width:"+f+"px;height:"+n+"px;"},m)}J.isDefined(e)&&"number"===typeof e&&(e=""+e);c.create("td",{innerHTML:e||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},g))));a&&(b=this._drawSymbol(l,a,d,f,n,k,
b,h),this._surfaceItems.push(b))},_addSubHeader:function(b,a){var f=c.create("tr",{},b),f=c.create("td",{align:this._align,colspan:2},f);c.create("td",{innerHTML:B.encode(a)||"",align:this._align},c.create("tr",{},c.create("tbody",{},c.create("table",{width:"95%"},f))))},_drawSymbol:function(b,a,c,e,k,h,l,p){a=P.fromJson(a.toJson());var f=l.opacity;c&&a.setColor(new r(c.toRgba()));if("simplelinesymbol"===a.type||"cartographiclinesymbol"===a.type||"textsymbol"===a.type){if(!a.color)return;c=a.color.toRgba();
c[3]*=f;a.color.setColor(c)}else"simplemarkersymbol"===a.type||"simplefillsymbol"===a.type?(a.color&&(c=a.color.toRgba(),c[3]*=f,a.color.setColor(c)),a.outline&&a.outline.color&&(c=a.outline.color.toRgba(),c[3]*=f,a.outline.color.setColor(c))):"picturemarkersymbol"===a.type&&(b.style.opacity=f,b.style.filter="alpha(opacity\x3d("+100*f+"))");b=v.createSurface(b,e,k);9>d("ie")&&(c=b.getEventSource(),x.set(c,"position","relative"),x.set(c.parentNode,"position","relative"));h=this._getDrawingToolShape(a,
h)||P.getShapeDescriptors(a);var m,f=(c=h.defaultShape)&&"text"===c.type;try{f&&!c.text&&(c.text=this.defaultText),m=b.createShape(p||c).setFill(h.fill).setStroke(h.stroke),f&&m.setFont(h.font)}catch(T){b.clear();b.destroy();return}var n=m.getBoundingBox();p=n.width;h=n.height;var f=-(n.x+p/2),t=-(n.y+h/2);c=b.getDimensions();f={dx:f+c.width/2,dy:t+c.height/2};if("simplemarkersymbol"===a.type&&"path"===a.style)e=l._getScaleMatrix(n,a.size),m.applyTransform(G.scaleAt(e.xx,e.yy,{x:c.width/2,y:c.height/
2}));else if(p>e||h>k)l=p/e>h/k,e=((l?e:k)-5)/(l?p:h),g.mixin(f,{xx:e,yy:e});m.applyTransform(f);return b},_getDrawingToolShape:function(b,a){var c;switch(a?a.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 Z"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 Z"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"};
break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:b.getFill(),stroke:b.getStroke()}},_repaintItems:function(){a.forEach(this._surfaceItems,function(b){this._repaint(b)},this)},_repaint:function(b){if(b){b.getStroke&&b.setStroke&&b.setStroke(b.getStroke());try{b.getFill&&b.setFill&&b.setFill(b.getFill())}catch(f){}b.children&&g.isArray(b.children)&&
a.forEach(b.children,this._repaint,this)}},_createHoverAction:function(b,a,e,d){if(d=a._hoverLabel||a._hoverLabels&&a._hoverLabels[e.id]||d)d=B.encode(d),a.mouseMoveHandler=a.mouseMoveHandler||{},a.mouseMoveHandler[e.id]=h.connect(b,"onmousemove",g.hitch(this,function(b,a){this.mouseX=a.clientX;this.mouseY=a.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,x.set(u.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(g.hitch(this,function(b,a,d){if(b==this.mouseX&&a==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=
!0,u.byId(this.id+"_hoverLabel")){var f=u.byId(this.id+"_hoverLabel");f.innerHTML="\x3cspan\x3e"+d+"\x3c/span\x3e";x.set(f,"top",a+"px");x.set(f,"left",b+15+"px");x.set(f,"display","")}else c.create("div",{innerHTML:"\x3cspan\x3e"+d+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:a+"px",left:b+15+"px"}},document.body)},a.clientX,a.clientY,b),500)},d)),a.mouseOutHandler=a.mouseOutHandler||{},a.mouseOutHandler[e.id]=h.connect(b,"onmouseout",g.hitch(this,function(b){this.mouseY=
this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,x.set(u.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var b;a.forEach(this.layers,function(a){if(a.mouseMoveHandler)for(b in a.mouseMoveHandler)h.disconnect(a.mouseMoveHandler[b]);if(a.mouseOutHandler)for(b in a.mouseOutHandler)h.disconnect(a.mouseOutHandler[b])})},_createDynamicLayers:function(b){var c=[],d;a.forEach(b.dynamicLayerInfos||b.layerInfos,function(a){d={id:a.id};d.source=a.source&&a.source.toJson();
var e;b.layerDefinitions&&b.layerDefinitions[a.id]&&(e=b.layerDefinitions[a.id]);e&&(d.definitionExpression=e);var f;b.layerDrawingOptions&&b.layerDrawingOptions[a.id]&&(f=b.layerDrawingOptions[a.id]);f&&(d.drawingInfo=f.toJson());d.minScale=a.minScale||0;d.maxScale=a.maxScale||0;c.push(d)});return c},_getTemplateFromTypes:function(b,a){var c;for(c=0;c<b.length;c++)if(b[c].id==a&&b[c].templates&&0<b[c].templates.length)return b[c].templates[0];return null},_findParentGroup:function(b,a,c){var d,e=
a.dynamicLayerInfos||a.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(x.set(u.byId(this.id+"_"+b+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(b,a,e[d].parentLayerId));break}},_addSubLayersToHide:function(b){function c(d,e){var f=b.layer.dynamicLayerInfos||b.layer.layerInfos,g,h;for(g=0;g<f.length;g++)if(f[g].id===d&&f[g].subLayerIds)for(h=0;h<f[g].subLayerIds.length;h++){var m=f[g].subLayerIds[h];-1===a.indexOf(e,m)&&(e.push(m),c(m,e))}}b.layer.layerInfos&&
a.forEach(this.hideLayersInLegend[b.layer.id],function(a){c(a,this.hideLayersInLegend[b.layer.id])},this)},_isLayerInScale:function(b,a,c){var d,e=!0;if(b.legendResponse&&b.legendResponse.layers)for(d=0;d<b.legendResponse.layers.length;d++){var f=b.legendResponse.layers[d];if(a.id==f.layerId){var g,h;!b.minScale&&0!==b.minScale||!b.maxScale&&0!==b.maxScale?(0==f.minScale&&b.tileInfo&&(g=b.tileInfo.lods[0].scale),0==f.maxScale&&b.tileInfo&&(h=b.tileInfo.lods[b.tileInfo.lods.length-1].scale)):(g=Math.min(b.minScale,
f.minScale)||b.minScale||f.minScale,h=Math.max(b.maxScale,f.maxScale));if(0<g&&g<c||h>c)e=!1;break}}else if(b.minScale||b.maxScale)if(b.minScale&&b.minScale<c||b.maxScale&&b.maxScale>c)e=!1;return e},_getServiceTitle:function(b){var a=b._titleForLegend;a||(a=b.url,b.url?-1<b.url.indexOf("/MapServer")?(a=b.url.substring(0,b.url.indexOf("/MapServer")),a=a.substring(a.lastIndexOf("/")+1,a.length)):-1<b.url.indexOf("/ImageServer")?(a=b.url.substring(0,b.url.indexOf("/ImageServer")),a=a.substring(a.lastIndexOf("/")+
1,a.length)):-1<b.url.indexOf("/FeatureServer")&&(a=b.url.substring(0,b.url.indexOf("/FeatureServer")),a=a.substring(a.lastIndexOf("/")+1,a.length)):a="",b.name&&(a=0<a.length?a+(" - "+b.name):b.name));"esri.layers.ArcGISImageServiceVectorLayer"===b.declaredClass&&b.vectorFieldPixelFilter&&(b=b.vectorFieldPixelFilter.outputUnit?this["NLS_"+b.vectorFieldPixelFilter.outputUnit]:this["NLS_"+b.vectorFieldPixelFilter.inputUnit],J.isDefined(b)&&(a+=" ("+b+")"));return B.encode(a)},_getEffectiveScale:function(a,
c){var b=c.minScale,d=c.maxScale;if(J.isDefined(c.parentLayerId)){var e=a.layerInfos,f=c.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0==b&&0<e[g].minScale?b=e[g].minScale:0<b&&0==e[g].minScale||0<b&&0<e[g].minScale&&(b=Math.min(b,e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;else break}return{minScale:b,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===
a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.WFSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1},isHostedTileService:function(a){var b=
/(https?:)?\/\/services.*\.arcgis\.com/i;return"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass&&b.test(a.url)?!0:!1},getField:function(b,c,d){if(b.getField)return b.getField(c);if(d&&d.fields){var e;a.forEach(d.fields,function(a){a.name===c&&(e=a)});return e}return null}});g.mixin(M,{ALIGN_LEFT:0,ALIGN_RIGHT:1});d("extend-esri")&&g.setObject("dijit.Legend",M,Q);return M});