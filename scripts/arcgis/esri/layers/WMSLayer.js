// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(q,h,m,x,d,b,z,n){q=q([b,z],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,k){h.mixin(this,k);this.initialize(b,k)},getTitle:function(b){var h;this.info&&(h=this.titleHasRelatedFields?"":this._getPopupValues(b,!0).title);return h||""},
getContent:function(b){return this.info?(new n({template:this,graphic:b,chartTheme:this.chartTheme},x.create("div"))).domNode:""}});m("extend-esri")&&h.setObject("dijit.PopupTemplate",q,d);return q})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./renderers/arcadeUtils ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),
function(q,h,m,x,d,b,z,n,p,k,y,D,f,A,C,B,E,a,v,w){q=q(null,{declaredClass:"esri.PopupInfo",_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(c,u){if(c){h.mixin(this,u);this.info=c;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var g=this._fieldLabels={},t=this._fieldsMap={};this.info.fieldInfos&&m.forEach(this.info.fieldInfos,function(l){var e=l.fieldName.toLowerCase(),
r=this._isExpressionField(e)?this.getExpressionInfo(e):null;g[e]=r?r.title:l.label;t[e]=l},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return x.fromJson(x.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(c){var u;m.some(this.info&&this.info.fieldInfos,function(g){g.fieldName===c&&(u=g);return!!u});return u},getExpressionInfo:function(c){if(this._isExpressionField(c)){c=c.replace(this._reExprField,
"");c=c.toLowerCase();var u;m.some(this.info.expressionInfos,function(g){g.name.toLowerCase()===c&&(u=g);return!!u});return u}},getComponents:function(c){var u=this.info,g=new z,t,l;u.fieldInfos&&(l=m.filter(u.fieldInfos,function(e){return-1!==e.fieldName.indexOf(this._relatedFieldPrefix)},this));l&&0<l.length&&(t=this._getRelatedRecords({graphic:c,fieldsInfo:l}));t?t.always(h.hitch(this,function(){g.resolve(this._getPopupValues(c))})):g.resolve(this._getPopupValues(c));return g.promise},getAttachments:function(c){var u=
c.getSourceLayer();c=c.attributes;if(this.info.showAttachments&&u&&u.hasAttachments&&u.objectIdField&&(c=c&&c[u.objectIdField]))return u.queryAttachmentInfos(c)},_isExpressionField:function(c){return this._reExprField.test(c)},_compileExpressions:function(c){var u={};m.forEach(c,function(c){var t=c.returnType&&c.returnType.toLowerCase();u[c.name]=v.createAttributeCache({valueExpression:c.expression},"number"!==t)});return u},_fetchAttributes:function(c){var u=h.clone(c.attributes)||{},g=this._exprPrefix,
t=this._exprCache;m.forEach(this.info.expressionInfos,function(l){var e=g+l.name;l=(l=t[l.name])?c._getDataValue(l.attributeInfo,l,a):null;"string"===typeof l&&(l=k.encode(l));u[e]=l});return u},_getPopupValues:function(c,u){var g=this.info,t=c.getSourceLayer(),l=this._fetchAttributes(c),e=h.clone(l),r=g.fieldInfos,a="",b="",v,w,f,A,d,k=t&&t._getDateOpts&&t._getDateOpts().properties,k=k&&k.slice(0),p={dateFormat:{properties:k,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
if(this._relatedInfo)for(A in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(A)){var n=this._relatedInfo[A],D=this._relatedLayersInfo[A];n&&(m.forEach(n.relatedFeatures,function(r){for(d in r.attributes)if(r.attributes.hasOwnProperty(d)&&"esriRelCardinalityOneToOne"===D.relation.cardinality){var c=this._toRelatedFieldName([D.relation.id,d]);l[c]=e[c]=r.attributes[d]}},this),m.forEach(n.relatedStatsFeatures,function(r){for(d in r.attributes)if(r.attributes.hasOwnProperty(d)){var c=this._toRelatedFieldName([D.relation.id,
d]);l[c]=e[c]=r.attributes[d]}},this))}r&&m.forEach(r,function(r){w=r.fieldName;var l=this._getLayerFieldInfo(t,w);l&&(w=r.fieldName=l.name);e[w]=this._formatValue(e[w],w,p);k&&r.format&&r.format.dateFormat&&(r=m.indexOf(k,w),-1<r&&k.splice(r,1))},this);if(t){A=t.types;var z=(n=t.typeIdField)&&l[n];for(w in l)if(l.hasOwnProperty(w)&&-1===w.indexOf(this._relatedFieldPrefix)&&(f=l[w],y.isDefined(f))){var x=this._getDomainName(t,c,A,z,w,f);y.isDefined(x)?e[w]=x:w===n&&(x=this._getTypeName(t,c,f),y.isDefined(x)&&
(e[w]=x))}}g.title&&(a=this._processFieldsInLinks(this._fixTokens(g.title,t),l),a=h.trim(y.substitute(e,a,p)||""));if(u)return{title:a};g.description&&(b=this._processFieldsInLinks(this._fixTokens(g.description,t),l),b=h.trim(y.substitute(e,b,p)||""));r&&(v=[],m.forEach(r,function(r){(w=r.fieldName)&&r.visible&&v.push([this._fieldLabels[w.toLowerCase()]||w,y.substitute(e,"${"+w+"}",p)||""])},this));var q,B;g.mediaInfos&&(q=[],m.forEach(g.mediaInfos,function(r){B=0;f=r.value;switch(r.type){case "image":var c=
f.sourceURL,c=c&&h.trim(y.substitute(l,this._fixTokens(c,t)));B=!!c;break;case "piechart":case "linechart":case "columnchart":case "barchart":var u,c=f.normalizeField;f.fields=m.map(f.fields,function(e){return(u=this._getLayerFieldInfo(t,e))?u.name:e},this);c&&(u=this._getLayerFieldInfo(t,c),f.normalizeField=u?u.name:c);B=m.some(f.fields,function(e){return y.isDefined(l[e])||-1!==e.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(B){r=h.clone(r);f=r.value;var c=
r.title?this._processFieldsInLinks(this._fixTokens(r.title,t),l):"",g=r.caption?this._processFieldsInLinks(this._fixTokens(r.caption,t),l):"";r.title=c?h.trim(y.substitute(e,c,p)||""):"";r.caption=g?h.trim(y.substitute(e,g,p)||""):"";if("image"===r.type)f.sourceURL=y.substitute(l,this._fixTokens(f.sourceURL,t)),f.linkURL&&(f.linkURL=h.trim(y.substitute(l,this._fixTokens(f.linkURL,t))||""));else{var a,G;m.forEach(f.fields,function(e,r){if(-1!==e.indexOf(this._relatedFieldPrefix))G=this._getRelatedChartInfos(e,
f,l,p),G instanceof Array?f.fields=G:f.fields[r]=G;else{var c=l[e],c=void 0===c?null:c;a=l[f.normalizeField]||0;c&&a&&(c/=a);f.fields[r]={y:c,tooltip:(this._fieldLabels[e.toLowerCase()]||e)+":\x3cbr/\x3e"+this._formatValue(c,e,p,!!a)}}},this)}q.push(r)}},this));return{title:a,description:b,hasDescription:!!g.description,fields:v&&v.length?v:null,mediaInfos:q&&q.length?q:null,formatted:e,editSummary:t&&t.getEditSummary?t.getEditSummary(c):""}},_getRelatedChartInfos:function(c,u,g,t){var l,e,r,a,b,
v;l=[];v=this._fromRelatedFieldName(c);b=v[0];e=this._relatedInfo[b];b=this._relatedLayersInfo[b];e&&m.forEach(e.relatedFeatures,function(e){e=e.attributes;var G,b;for(b in e)if(e.hasOwnProperty(b)&&b===v[1]){G={};a=e[b];u.normalizeField&&(r=-1!==u.normalizeField.indexOf(this._relatedFieldPrefix)?e[this._fromRelatedFieldName(u.normalizeField)[1]]:g[u.normalizeField]);a&&r&&(a/=r);if(u.tooltipField)if(-1!==u.tooltipField.indexOf(this._relatedFieldPrefix)){var w=this._fromRelatedFieldName(u.tooltipField)[1],
N=y.isDefined(e[w])?e[w]:w;G.tooltip=N+":\x3cbr/\x3e"+this._formatValue(a,w,t,!!r)}else G.tooltip=(this._fieldLabels[c.toLowerCase()]||c)+":\x3cbr/\x3e"+this._formatValue(a,u.tooltipField,t,!!r);else G.tooltip=a;G.y=a;l.push(G)}},this);return"esriRelCardinalityOneToMany"===b.relation.cardinality||"esriRelCardinalityManyToMany"===b.relation.cardinality?l:l[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",
dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_reEmptyHref:/^href\s*=\s*"\s*"$/i,_reEmptyHrefApos:/^href\s*=\s*'\s*'$/i,_fixTokens:function(c,u){var g=this;return c.replace(/(\{([^\{\r\n]+)\})/g,function(c,l,e){c=g._getLayerFieldInfo(u,e);return"$"+(c?"{"+c.name+"}":l)})},_encodeAttributes:function(c){c=h.clone(c)||{};var u,g;for(u in c)(g=c[u])&&"string"===typeof g&&(g=encodeURIComponent(g).replace(/\'/g,"\x26apos;"),c[u]=
g);return c},_processFieldsInLinks:function(c,u){var g=this._encodeAttributes(u),g=h.hitch(this,this._addValuesToHref,u,g);c&&(c=c.replace(this._reHref,g).replace(this._reHrefApos,g));return c},_addValuesToHref:function(c,u,g,t){t=t&&h.trim(t);g=y.substitute(t&&0===t.indexOf("${")?c:u,g);this._reEmptyHref.test(g)?g='href\x3d"about:blank"':this._reEmptyHrefApos.test(g)&&(g="href\x3d'about:blank'");return g},_getLayerFieldInfo:function(c,u){return c&&c.getField?c.getField(u):null},_formatValue:function(c,
u,g,t){var l=this._fieldsMap[u.toLowerCase()],e=l&&l.format;u=-1!==m.indexOf(g.dateFormat.properties,u);var r="number"===typeof c&&!u&&(!e||!e.dateFormat);if(!y.isDefined(c)||!l||!y.isDefined(e))return r?this._forceLTR(c):c;var a="",l=[],b=e.hasOwnProperty("places")||e.hasOwnProperty("digitSeparator"),v=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;if(b&&!u)a="NumberFormat",l.push("places: "+(y.isDefined(e.places)&&(!t||0<e.places)?Number(e.places):"Infinity")),l.length&&(a+="("+l.join(",")+
")");else if(e.dateFormat)a="DateFormat"+this._insertOffset(this._dateFormats[e.dateFormat]||this._dateFormats.shortDateShortTime);else return r?this._forceLTR(c):c;var f=this._applyFormatting(c,a,g);b&&-1<c.constructor.toString().indexOf("Array")&&(f="",m.forEach(c,h.hitch(this,function(e,r){r&&(f+=" ");f+=this._applyFormatting(e,a,g)})));b&&!v&&w.group&&(f=f.replace(new RegExp("\\"+w.group,"g"),""));u&&(f='\x3cspan class\x3d"esriDateValue"\x3e'+f+"\x3c/span\x3e");return r?this._forceLTR(f):f},_applyFormatting:function(c,
a,g){return y.substitute({myKey:c},"${myKey:"+a+"}",g)||""},_forceLTR:function(c){var a=n("ie");return a&&10>=a?c:"\x3cspan class\x3d'esriNumericValue'\x3e"+c+"\x3c/span\x3e"},_insertOffset:function(c){c&&(c=y.isDefined(this.utcOffset)?c.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):c);return c},_getDomainName:function(c,a,g,t,l,e){return(c=c.getDomain&&c.getDomain(l,{feature:a}))&&c.codedValues?c.getName(e):null},_getTypeName:function(c,a,g){return(c=c.getType&&c.getType(a))&&c.name},_getRelatedRecords:function(c){var a=
c.graphic,g=new z,t;this._relatedLayersInfo?this._queryRelatedLayers(a).then(h.hitch(this,function(c){this._setRelatedRecords(a,c);g.resolve(c)}),h.hitch(this,this._handlerErrorResponse,g)):this._getRelatedLayersInfo(c).then(h.hitch(this,function(c){for(t in c)c.hasOwnProperty(t)&&c[t]&&(this._relatedLayersInfo[t].relatedLayerInfo=c[t]);this._queryRelatedLayers(a).then(h.hitch(this,function(e){this._setRelatedRecords(a,e);g.resolve(e)}),h.hitch(this,this._handlerErrorResponse,g))}),h.hitch(this,this._handlerErrorResponse,
g));return g.promise},_getRelatedLayersInfo:function(c){var a=c.fieldsInfo,g,t,l={};g=c.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});m.forEach(a,function(e){var r,c,l,a;r=this._fromRelatedFieldName(e.fieldName);c=r[0];r=r[1];c&&(this._relatedLayersInfo[c]||(m.some(g.relationships,function(e){if(e.id==c)return a=e,!0}),a&&(this._relatedLayersInfo[c]={relation:a,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(r),
e.statisticType&&(l=new E,l.statisticType=e.statisticType,l.onStatisticField=r,l.outStatisticFieldName=r,this._relatedLayersInfo[c].outStatistics.push(l))))},this);for(t in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(t)&&this._relatedLayersInfo[t]&&(c=this._relatedLayersInfo[t].relation,c=g.url.replace(/[0-9]+$/,c.relatedTableId),this._relatedLayersInfo[t].relatedLayerUrl=c,l[t]=f({url:c,content:{f:"json"},callbackParamName:"callback"}));return p(l)},_queryRelatedLayers:function(c){var a=
{},g;for(g in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(g)&&(a[g]=this._queryRelatedLayer({graphic:c,relatedInfo:this._relatedLayersInfo[g]}));return p(a)},_queryRelatedLayer:function(c){var a,g,t,l,e,r,b,v,w,f,d,k,n;a=c.graphic;g=a.getSourceLayer();t=g.url.match(/[0-9]+$/g)[0];d=c.relatedInfo;f=d.relatedLayerInfo;k=d.relatedLayerUrl;c=d.relation;m.some(f.relationships,function(e){if(e.relatedTableId===parseInt(t,10))return l=e,!0},this);l&&(e=new A,m.some(f.fields,function(e){if(e.name===
l.keyField)return v=-1!==m.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],e.type)?"number":"string",!0}),l.relationshipTableId&&l.keyFieldInRelationshipTable?(n=new z,this._queryRelatedRecords(a,l).then(h.hitch(this,function(c){var l;l=c[a.attributes[g.objectIdField]];c=m.map(l.features,function(e){return e.attributes[f.objectIdField]},this);d.outStatistics&&0<d.outStatistics.length&&f.supportsStatistics&&(w=new A,w.objectIds=c,w.outFields=
e.outFields,w.outStatistics=d.outStatistics);w&&(r=new C(k),r.execute(w).then(h.hitch(this,function(e){var c=[];c.push(l);c.push(e);n.resolve(c)})))}))):(b="string"===v?l.keyField+"\x3d'"+a.attributes[c.keyField]+"'":l.keyField+"\x3d"+a.attributes[c.keyField],e.where=b,e.outFields=d.relatedFields,d.outStatistics&&0<d.outStatistics.length&&f.supportsStatistics&&(w=new A,w.where=e.where,w.outFields=e.outFields,w.outStatistics=d.outStatistics),r=new C(k),b=[],b.push(r.execute(e)),w&&b.push(r.execute(w))));
return b?p(b):n?n.promise:void 0},_setRelatedRecords:function(c,a){this._relatedInfo=[];for(var g in a)if(a.hasOwnProperty(g)&&a[g]){var t=a[g];this._relatedInfo[g]={};this._relatedInfo[g].relatedFeatures=t[0].features;y.isDefined(t[1])&&(this._relatedInfo[g].relatedStatsFeatures=t[1].features)}},_handlerErrorResponse:function(c,a){c.reject(a)},_fromRelatedFieldName:function(c){var a=[];-1!==c.indexOf(this._relatedFieldPrefix)&&(c=c.split("/"),a=c.slice(1));return a},_toRelatedFieldName:function(c){var a=
"";c&&0<c.length&&(a=this._relatedFieldPrefix+c[0]+"/"+c[1]);return a},_queryRelatedRecords:function(c,a){var g=c.getSourceLayer(),t=new B;t.outFields=["*"];t.relationshipId=a.id;t.objectIds=[c.attributes[g.objectIdField]];return g.queryRelatedFeatures(t)}});b("extend-esri")&&(D.PopupInfo=D.PopupInfoTemplate=q);return q})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(q){var h=q.getObject("dojox.html.entities",!0),m=function(d,b){var h,n;if(b._encCache&&b._encCache.regexp&&
b._encCache.mapper&&b.length==b._encCache.length)h=b._encCache.mapper,n=b._encCache.regexp;else{h={};n=["["];var p;for(p=0;p<b.length;p++)h[b[p][0]]="\x26"+b[p][1]+";",n.push(b[p][0]);n.push("]");n=new RegExp(n.join(""),"g");b._encCache={mapper:h,regexp:n,length:b.length}}return d=d.replace(n,function(b){return h[b]})},x=function(d,b){var h,n;if(b._decCache&&b._decCache.regexp&&b._decCache.mapper&&b.length==b._decCache.length)h=b._decCache.mapper,n=b._decCache.regexp;else{h={};n=["("];var p;for(p=
0;p<b.length;p++){var k="\x26"+b[p][1]+";";p&&n.push("|");h[k]=b[p][0];n.push(k)}n.push(")");n=new RegExp(n.join(""),"g");b._decCache={mapper:h,regexp:n,length:b.length}}return d=d.replace(n,function(b){return h[b]})};h.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];h.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa",
"ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5",
"Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df",
"szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9",
"ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],
["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],
["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],
["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282",
"sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002",
"ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];h.encode=function(d,b){d&&(b?d=m(d,b):(d=m(d,h.html),d=m(d,h.latin)));return d};h.decode=function(d,b){d&&(b?d=x(d,b):(d=x(d,h.html),
d=x(d,h.latin)));return d};return h})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(q,h,m,x,d,b,z,n,p,k,y,D,f){q=q(D,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},
constructor:function(b,f){this._handler=h.hitch(this,this._handler);this._relationshipQueryHandler=h.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=h.hitch(this,this._executeForIdsHandler);this._countHandler=h.hitch(this,this._countHandler);this._extentHandler=h.hitch(this,this._extentHandler);this.source=f&&f.source;this.gdbVersion=f&&f.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(b,f,k,p,a){p=a.assembly;b=this._encode(h.mixin({},this._url.query,{f:"json"},b.toJson(p&&p[0])));var v=this._handler,w=this._errorHandler;this.source&&(p={source:this.source.toJson()},
b.layer=d.toJson(p));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return n({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(c,b){v(c,b,f,k,a.dfd)},error:function(c){w(c,k,a.dfd)}},this.requestOptions)},executeRelationshipQuery:function(b,f,d){b=this._encode(h.mixin({},this._url.query,{f:"json"},b.toJson()));var k=this._relationshipQueryHandler,a=this._errorHandler;this.gdbVersion&&(b.gdbVersion=this.gdbVersion);var v=new x(p._dfdCanceller);v._pendingDfd=n({url:this._url.path+
"/queryRelatedRecords",content:b,callbackParamName:"callback",load:function(a,c){k(a,c,f,d,v)},error:function(b){a(b,d,v)}},this.requestOptions);return v},executeForIds:function(b,f,k,p){var a=p.assembly;b=this._encode(h.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},b.toJson(a&&a[0])));var v=this._executeForIdsHandler,w=this._errorHandler;this.source&&(a={source:this.source.toJson()},b.layer=d.toJson(a));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return n({url:this._url.path+"/query",
content:b,callbackParamName:"callback",load:function(c,a){v(c,a,f,k,p.dfd)},error:function(c){w(c,k,p.dfd)}},this.requestOptions)},executeForCount:function(b,f,k,p){var a=p.assembly;b=this._encode(h.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(a&&a[0])));var v=this._countHandler,w=this._errorHandler;this.source&&(a={source:this.source.toJson()},b.layer=d.toJson(a));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return n({url:this._url.path+"/query",content:b,callbackParamName:"callback",
load:function(c,a){v(c,a,f,k,p.dfd)},error:function(c){w(c,k,p.dfd)}},this.requestOptions)},executeForExtent:function(b,f,p,k){var a=k.assembly;b=this._encode(h.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(a&&a[0])));var v=this._extentHandler,w=this._errorHandler;this.source&&(a={source:this.source.toJson()},b.layer=d.toJson(a));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return n({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(c,
a){v(c,a,f,p,k.dfd)},error:function(c){w(c,p,k.dfd)}},this.requestOptions)},_handler:function(b,d,k,p,a){try{var v=new f(b);this._successHandler([v],"onComplete",k,a)}catch(w){this._errorHandler(w,p,a)}},_relationshipQueryHandler:function(b,d,k,p,a){try{var v=b.geometryType,w=b.spatialReference,c={};m.forEach(b.relatedRecordGroups,function(a){var g={};g.geometryType=v;g.spatialReference=w;g.features=a.relatedRecords;g=new f(g);if(null!=a.objectId)c[a.objectId]=g;else for(var t in a)a.hasOwnProperty(t)&&
"relatedRecords"!==t&&(c[a[t]]=g)});this._successHandler([c],"onExecuteRelationshipQueryComplete",k,a)}catch(u){this._errorHandler(u,p,a)}},_executeForIdsHandler:function(b,f,k,d,a){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",k,a)}catch(v){this._errorHandler(v,d,a)}},_countHandler:function(b,f,k,d,a){try{var v,w=b.features,c=b.objectIds;if(c)v=c.length;else{if(w)throw Error("Unable to perform query. Please check your parameters.");v=b.count}this._successHandler([v],"onExecuteForCountComplete",
k,a)}catch(u){this._errorHandler(u,d,a)}},_extentHandler:function(b,f,d,p,a){try{b.extent&&(b.extent=new k(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",d,a)}catch(v){this._errorHandler(v,p,a)}}});y._createWrappers(q);b("extend-esri")&&h.setObject("tasks.QueryTask",q,z);return q})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(q,h,m,x,d,b,z,n){q=q(n,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(b,d){b&&h.isString(b)&&(this._url=z.urlToObject(this.url=b));d&&d.requestOptions&&(this.requestOptions=d.requestOptions);this.normalization=!0;this._errorHandler=h.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,d=/^http:/i;this.url&&(this.url=this.url.replace(d,"https:"));b&&b.path&&(b.path=b.path.replace(d,"https:"))},_encode:function(b,d,n){var k,f,p={},y,x;for(y in b)if("declaredClass"!==
y&&(k=b[y],f=typeof k,null!==k&&void 0!==k&&"function"!==f))if(h.isArray(k))for(p[y]=[],x=k.length,f=0;f<x;f++)p[y][f]=this._encode(k[f]);else"object"===f?k.toJson&&(f=k.toJson(n&&n[y]),"esri.tasks.FeatureSet"===k.declaredClass&&f.spatialReference&&(f.sr=f.spatialReference,delete f.spatialReference),p[y]=d?f:m.toJson(f)):p[y]=k;return p},_successHandler:function(d,k,h,n){k&&this[k].apply(this,d);h&&h.apply(null,d);n&&b._resDfd(n,d)},_errorHandler:function(b,d,h){this.onError(b);d&&d(b);h&&h.errback(b)},
setNormalization:function(b){this.normalization=b},onError:function(){}});x("extend-esri")&&(d.Task=q);return q})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(q,h,m,x,d,b,z,n,p,k,y){q=q(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(b){if(b){h.mixin(this,b);var f=this.features,d=b.spatialReference,
p=k.getGeometryType(b.geometryType),d=this.spatialReference=new n(d);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);m.forEach(f,function(b,k){var a=b.geometry&&b.geometry.spatialReference;f[k]=new z(p&&b.geometry?new p(b.geometry):null,b.symbol&&y.fromJson(b.symbol),b.attributes);f[k].geometry&&!a&&f[k].geometry.setSpatialReference(d)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(d){var f=
{};this.displayFieldName&&(f.displayFieldName=this.displayFieldName);this.fields&&(f.fields=this.fields);this.spatialReference?f.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(f.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(f.geometryType=k.getJsonType(this.features[0].geometry)),f.features=p._encodeGraphics(this.features,d));f.geometryType=f.geometryType||this.geometryType;f.exceededTransferLimit=
this.exceededTransferLimit;f.transform=this.transform;return b.fixJson(f)},_hydrate:function(){var b=this.transform,f=this.geometryType;if(b&&f)for(var d=this.features,k=b.translate[0],h=b.translate[1],p=b.scale[0],a=b.scale[1],v=function(a,c,b){if("esriGeometryPoint"===a)return function(a){a.x=c(a.x);a.y=b(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var t,l,e,r,g,u,f,d;t=0;for(l=a.length;t<l;t++)for(g=a[t],e=0,r=g.length;e<r;e++)u=g[e],0<e?
(f+=u[0],d+=u[1]):(f=u[0],d=u[1]),u[0]=c(f),u[1]=b(d)};if("esriGeometryEnvelope"===a)return function(a){a.xmin=c(a.xmin);a.ymin=b(a.ymin);a.xmax=c(a.xmax);a.ymax=b(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var t,l,e,r,g;t=0;for(l=a.length;t<l;t++)e=a[t],0<t?(r+=e[0],g+=e[1]):(r=e[0],g=e[1]),e[0]=c(r),e[1]=b(g)}}(f,function(a){return a*p+k},function(b){return h-b*a}),b=0,f=d.length;b<f;b++)d[b].geometry&&v(d[b].geometry);this.transform=null},quantize:function(b){if(!this.geometryType)return this.transform=
null,this;var f=b.translate[0],d=b.translate[1],k=b.scale[0],h=b.scale[1],p=this.features,a=function(a,c,b){var l,e,r,t,g,u,f=[];l=0;for(e=a.length;l<e;l++)if(r=a[l],0<l){if(u=c(r[0]),r=b(r[1]),u!==t||r!==g)f.push([u-t,r-g]),t=u,g=r}else t=c(r[0]),g=b(r[1]),f.push([t,g]);return 0<f.length?f:null},v=function(c,b,t){if("esriGeometryPoint"===c)return function(a){a.x=b(a.x);a.y=t(a.y);return a};if("esriGeometryPolyline"===c||"esriGeometryPolygon"===c)return function(c){var e,r,l,g,f;l=c.rings||c.paths;
f=[];e=0;for(r=l.length;e<r;e++)g=l[e],(g=a(g,b,t))&&f.push(g);return 0<f.length?(c.rings?c.rings=f:c.paths=f,c):null};if("esriGeometryMultipoint"===c)return function(c){var e;e=a(c.points,b,t);return 0<e.length?(c.points=e,c):null};if("esriGeometryEnvelope"===c)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-f)/k)},function(a){return Math.round((d-a)/h)}),w,c;w=0;for(c=p.length;w<c;w++)p[w].geometry&&(v(p[w].geometry)||p[w].setGeometry(null));this.transform=b;return this}});
x("extend-esri")&&h.setObject("tasks.FeatureSet",q,d);return q})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(q,h,m,x,d){q=q(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var b={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,
maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},d=this.objectIds,h=this.outFields,p=this.outSpatialReference;d&&(b.objectIds=d.join(","));h&&(b.outFields=h.join(","));p&&(b.outSR=p.wkid||m.toJson(p.toJson()));b._ts=this._ts;return b}});x("extend-esri")&&h.setObject("tasks.RelationshipQuery",q,d);return q})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(q,h,m,x){q=q(null,{declaredClass:"esri.tasks.StatisticDefinition",
toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});m("extend-esri")&&h.setObject("tasks.StatisticDefinition",q,x);return q})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../lang ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(q,h,m,x,d,b,z,n,p,k,y,D,f,A,C,B,E,a,v,w,c){var u=0,g=c.widgets.popup;h=h([w,C,B],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=x.mixin({},g)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(x.hitch(this,this._handleComponentsSuccess),x.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,c=a.length,e=this.domNode,r=this._prevMedia,g=this._nextMedia;if(1<c){var f=0,u=0;d.forEach(a,function(e){"image"===e.type?f++:-1!==e.type.indexOf("chart")&&u++});f&&(k.set(this._imageCount,"innerHTML",f),b.query(".summary .image",e).removeClass("hidden"));u&&(k.set(this._chartCount,"innerHTML",u),b.query(".summary .chart",e).removeClass("hidden"))}else b.query(".summary",
e).addClass("hidden"),y.add(r,"hidden"),y.add(g,"hidden");a=this._mediaPtr;0===a?y.add(r,"hidden"):y.remove(r,"hidden");a===c-1?y.add(g,"hidden"):y.remove(g,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],c=a.title,e=a.caption,r=b.query(".mediaSection .hzLine",this.domNode)[0];k.set(this._mediaTitle,"innerHTML",c);y[c?"remove":"add"](this._mediaTitle,"hidden");k.set(this._mediaCaption,"innerHTML",e);y[e?"remove":"add"](this._mediaCaption,"hidden");y[c&&
e?"remove":"add"](r,"hidden");this._rid=null;if("image"===a.type)this._showImage(a);else{var g=this,c=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],e=a.value.theme||this.chartTheme;x.isString(e)&&(e=e.replace(/\./gi,"/"),-1===e.indexOf("/")&&(e="dojox/charting/themes/"+e));e||(e="./Rainbow");c.push(e);try{var f=this._rid=u++;q(c,function(e,c,b){f===g._rid&&(g._rid=null,g._showChart(a.type,a.value,e,c,b))})}catch(O){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&x.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){y.add(this._mediaFrame,"image");var c=f.get(this._gallery,"height"),e=a.value,r;e.linkURL&&(r=D.create("a",{href:e.linkURL,target:this._preventNewTab(e.linkURL)?"":"_blank"},this._mediaFrame));e=a.refreshInterval?this._addURLParameter(e.sourceURL,"timestamp",Date.now()):e.sourceURL;D.create("img",{className:"esriPopupMediaImage",src:e},r||this._mediaFrame);var g=b.query(".esriPopupMediaImage",this._mediaFrame)[0];
this._imageLoadHandle=m.connect(g,"onload",this,function(){this._clearImageHandles();this._imageLoaded(g,c);this._initImageRefresh(a)})},_addURLParameter:function(a,c,e){var b=-1===a.indexOf("?")?"?":"\x26";return a+b+c+"\x3d"+e},_initImageRefresh:function(a){if(a.refreshInterval){var c=6E4*a.refreshInterval;this._imageRefreshHandle=setTimeout(x.hitch(this,function(){this._destroyFrame();this._showImage(a)}),c)}},_clearImageHandles:function(){m.disconnect(this._imageLoadHandle);this._imageLoadHandle=
null;clearTimeout(this._imageRefreshHandle);this._imageRefreshHandle=null},_showChart:function(a,c,e,b,g){y.remove(this._mediaFrame,"image");e=this._chart=new e(D.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});g&&e.setTheme(g);switch(a){case "piechart":e.addPlot("default",{type:"Pie",labels:!1});e.addSeries("Series A",c.fields);break;case "linechart":e.addPlot("default",{type:"Markers"});e.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});
e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.forEach(c.fields,function(a,e){a.x=e+1});e.addSeries("Series A",c.fields);break;case "columnchart":e.addPlot("default",{type:"Columns",gap:3});e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});e.addSeries("Series A",c.fields);break;case "barchart":e.addPlot("default",{type:"Bars",gap:3}),e.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),e.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),
e.addSeries("Series A",c.fields)}this._action=new b(e);e.render()},_destroyFrame:function(){this._rid=null;this._clearImageHandles();this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);k.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,c){var e=a.height;e<c&&f.set(a,"marginTop",Math.round((c-e)/2)+"px")},_attListHandler:function(a,c){if(a===this._dfd){this._dfd=null;var e="";c instanceof Error||!c||!c.length||d.forEach(c,function(a){e+=
"\x3cli\x3e";e+="\x3ca href\x3d'"+v.addProxy(a.url)+"' target\x3d'_blank'\x3e"+(a.name||"[No name]")+"\x3c/a\x3e";e+="\x3c/li\x3e"});k.set(this._attachmentsList,"innerHTML",e||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_supportedURIInfos:[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,label:g.NLS_moreInfo},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"${hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"${hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,appName:"App Studio Player",
label:g.NLS_openLinkInApp},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,appName:"Collector",label:g.NLS_openLinkInApp},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,appName:"Explorer",label:g.NLS_openLinkInApp},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,appName:"Navigator",label:g.NLS_openLinkInApp},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,appName:"Survey123",label:g.NLS_openLinkInApp},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,appName:"Trek2There",label:g.NLS_openLinkInApp},
{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,appName:"Workforce",label:g.NLS_openLinkInApp},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,appName:"iForm",label:g.NLS_openLinkInApp},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,appName:"FlowFinity",label:g.NLS_openLinkInApp},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,appName:"Laserfische",label:g.NLS_openLinkInApp},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,appName:"Microsoft Power BI",label:g.NLS_openLinkInApp}],_findURIInfo:function(a){var c;d.some(this._supportedURIInfos,
function(e){e.pattern.test(a)&&(c=e);return!!c});return c},_createLinkIfURI:function(c){var b=this._findURIInfo(c);if(b){var e=c.match(b.pattern);return c.replace(b.pattern,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+a.substitute({appName:b.appName,hierPart:e&&e[2]},b.label)+"\x3c/a\x3e")}return c},_handleComponentsSuccess:function(a){if(a){var c=this.showTitle?a.title:"",e=a.description,r=a.fields,g=a.mediaInfos,f=this.domNode,t=this._nls,u=this,v=this.template,w=this.graphic;this._prevMedia.title=
t.NLS_prevMedia;this._nextMedia.title=t.NLS_nextMedia;k.set(this._title,"innerHTML",c);c||y.add(this._title,"hidden");!a.hasDescription&&r&&(e="",d.forEach(r,function(a){e+="\x3ctr valign\x3d'top'\x3e";e+="\x3ctd class\x3d'attrName'\x3e"+A.encode(a[0])+"\x3c/td\x3e";e+="\x3ctd class\x3d'attrValue'\x3e"+this._createLinkIfURI(a[1])+"\x3c/td\x3e";e+="\x3c/tr\x3e"},this),e&&(e="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+e+"\x3c/table\x3e"));k.set(this._description,"innerHTML",
e);e||y.add(this._description,"hidden");b.query("a",this._description).forEach(function(a){u._preventNewTab(a.href)?"_blank"===a.target&&k.remove(a,"target"):k.set(a,"target","_blank")});c&&e?b.query(".mainSection .hzLine",f).removeClass("hidden"):c||e?b.query(".mainSection .hzLine",f).addClass("hidden"):b.query(".mainSection",f).addClass("hidden");if(c=this._dfd=v.getAttachments(w))c.addBoth(x.hitch(this,this._attListHandler,c)),k.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+t.NLS_searching+
"...\x3c/li\x3e"),b.query(".attachmentsSection",f).removeClass("hidden");g&&g.length&&(b.query(".mediaSection",f).removeClass("hidden"),p.setSelectable(this._mediaFrame,!1),this._mediaInfos=g,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(k.set(this._editSummary,"innerHTML",a.editSummary),g&&g.length&&y.remove(this._mediaBreak,"hidden"),y.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});
z("extend-esri")&&x.setObject("dijit._PopupRenderer",h,E);return h})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(q,h,m,x,d,b,z,n,p,k,y,D,f){function A(){}function C(b){return function(f,a,d,w){return f&&"string"==typeof a&&f[a]==A?f.on(a.substring(2).toLowerCase(),z.hitch(d,w)):
b.apply(m,arguments)}}q.around(m,"connect",C);b.connect&&q.around(b,"connect",C);q=x("dijit._Widget",[y,D,f],{onClick:A,onDblClick:A,onKeyDown:A,onKeyPress:A,onKeyUp:A,onMouseDown:A,onMouseMove:A,onMouseOut:A,onMouseOver:A,onMouseLeave:A,onMouseEnter:A,onMouseUp:A,constructor:function(b){this._toConnect={};for(var f in b)this[f]===A&&(this._toConnect[f.replace(/^on/,"").toLowerCase()]=b[f],delete b[f])},postCreate:function(){this.inherited(arguments);for(var b in this._toConnect)this.on(b,this._toConnect[b]);
delete this._toConnect},on:function(b,f){return this[this._onMap(b)]===A?m.connect(this.domNode,b.toLowerCase(),this,f):this.inherited(arguments)},_setFocusedAttr:function(b){this._focused=b;this._set("focused",b)},setAttribute:function(f,d){b.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(f,d)},attr:function(b,f){return 2<=arguments.length||"object"===typeof b?this.set.apply(this,arguments):this.get(b)},getDescendants:function(){b.deprecated(this.declaredClass+
"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?n("[widgetId]",this.containerNode).map(k.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});d("dijit-legacy-requires")&&p(0,function(){require(["dijit/_base"])});return q})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(q,h,m,x,d,b,z,n,p,k,y,D,f,A,C,B,E,a,v,w,c,u,g){function t(a){return function(c){n[c?"set":"remove"](this.domNode,a,c);this._set(a,c)}}f.add("dijit-legacy-requires",!A.isAsync);f.add("dojo-bidi",!1);f("dijit-legacy-requires")&&E(0,function(){q(["dijit/_base/manager"])});var l={};x=b("dijit._WidgetBase",[a,c],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:t("lang"),dir:"",_setDirAttr:t("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:x.blankGif||q.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var c=a.prototype,b=a._setterAttrs=[],a=a._onMap={},g;for(g in c.attributeMap)b.push(g);for(g in c)/^on/.test(g)&&(a[g.substring(2).toLowerCase()]=g),/^_set[A-Z](.*)Attr$/.test(g)&&(g=g.charAt(4).toLowerCase()+
g.substr(5,g.length-9),c.attributeMap&&g in c.attributeMap||b.push(g))}},postscript:function(a,c){this.create(a,c)},create:function(a,c){this._introspect();this.srcNodeRef=z.byId(c);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,C.mixin(this,a));this.postMixInProperties();this.id||(this.id=g.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=
this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=w.body(this.ownerDocument);g.add(this);this.buildRendering();var e;if(this.domNode){this._applyAttributes();var b=this.srcNodeRef;b&&b.parentNode&&this.domNode!==b&&(b.parentNode.replaceChild(this.domNode,b),e=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();e&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},c;for(c in this.params||{})a[c]=this._get(c);
h.forEach(this.constructor._setterAttrs,function(c){if(!(c in a)){var e=this._get(c);e&&this.set(c,e)}},this);for(c in a)this.set(c,a[c])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(h.map(a,function(a){return a+"Rtl"})));p.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=
!0,h.forEach(this.getChildren(),function(a){a._started||a._destroyed||!C.isFunction(a.startup)||(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function c(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();h.forEach(this._connects,C.hitch(this,"disconnect"));h.forEach(this._supportingWidgets,c);this.domNode&&h.forEach(g.findWidgets(this.domNode,
this.containerNode),c);this.destroyRendering(a);g.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?n.remove(this.domNode,"widgetId"):k.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||k.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){h.forEach(this.getChildren(),function(c){c.destroyRecursive&&c.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var c=
this.domNode;C.isObject(a)?D.set(c,a):c.style.cssText=c.style.cssText?c.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,c,b){b=3<=arguments.length?b:this.attributeMap[a];h.forEach(C.isArray(b)?b:[b],function(b){var e=this[b.node||b||"domNode"];switch(b.type||"attribute"){case "attribute":C.isFunction(c)&&(c=C.hitch(this,c));b=b.attribute?b.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;e.tagName?n.set(e,b,c):e.set(b,c);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(c));
break;case "innerHTML":e.innerHTML=c;break;case "class":p.replace(e,c,this[a]);break;case "toggleClass":p.toggle(e,b.className||a,c)}},this)},get:function(a){var c=this._getAttrNames(a);return this[c.g]?this[c.g]():this._get(a)},set:function(a,c){if("object"===typeof a){for(var b in a)this.set(b,a[b]);return this}b=this._getAttrNames(a);var e=this[b.s];if(C.isFunction(e))var g=e.apply(this,Array.prototype.slice.call(arguments,1));else{var e=this.focusNode&&!C.isFunction(this.focusNode)?"focusNode":
"domNode",r=this[e]&&this[e].tagName,f;if((f=r)&&!(f=l[r])){f=this[e];var t={},d;for(d in f)t[d.toLowerCase()]=!0;f=l[r]=t}d=f;b=a in this.attributeMap?this.attributeMap[a]:b.s in this?this[b.s]:d&&b.l in d&&"function"!=typeof c||/^aria-|^data-|^role$/.test(a)?e:null;null!=b&&this._attrToDom(a,c,b);this._set(a,c)}return g||this},_attrPairNames:{},_getAttrNames:function(a){var c=this._attrPairNames;if(c[a])return c[a];var b=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});
return c[a]={n:a+"Node",s:"_set"+b+"Attr",g:"_get"+b+"Attr",l:b.toLowerCase()}},_set:function(a,c){var b=this[a];this[a]=c;!this._created||b===c||b!==b&&c!==c||(this._watchCallbacks&&this._watchCallbacks(a,b,c),this.emit("attrmodified-"+a,{detail:{prevValue:b,newValue:c}}))},_get:function(a){return this[a]},emit:function(a,c,b){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var e,g=this["on"+a];g&&(e=g.apply(this,b?
b:[c]));this._started&&!this._beingDestroyed&&B.emit(this.domNode,a.toLowerCase(),c);return e},on:function(a,c){var b=this._onMap(a);return b?m.after(this,b,c,!0):this.own(B(this.domNode,a,c))[0]},_onMap:function(a){var c=this.constructor,b=c._onMap;if(!b){var b=c._onMap={},e;for(e in c.prototype)/^on/.test(e)&&(b[e.replace(/^on/,"").toLowerCase()]=e)}return b["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?
g.findWidgets(this.containerNode):[]},getParent:function(){return g.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,c,b){return this.own(d.connect(a,c,this,b))[0]},disconnect:function(a){a.remove()},subscribe:function(a,c){return this.own(v.subscribe(a,C.hitch(this,c)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():y.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=D.get(this.domNode,"display")},
placeAt:function(a,c){var b=!a.tagName&&g.byId(a);!b||!b.addChild||c&&"number"!==typeof c?(b=b&&"domNode"in b?b.containerNode&&!/after|before|replace/.test(c||"")?b.containerNode:b.domNode:z.byId(a,this.ownerDocument),k.place(this.domNode,b,c),!this._started&&(this.getParent()||{})._started&&this.startup()):b.addChild(this,c);return this},defer:function(a,c){var b=setTimeout(C.hitch(this,function(){b&&(b=null,this._destroyed||C.hitch(this,a)())}),c||0);return{remove:function(){b&&(clearTimeout(b),
b=null);return null}}}});f("dojo-bidi")&&x.extend(u);return x})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(q,h,m){return m("dijit.Destroyable",null,{destroy:function(h){this._destroyed=!0},own:function(){var m=["destroyRecursive","destroy","remove"];q.forEach(arguments,function(d){function b(){n.remove();q.forEach(p,function(b){b.remove()})}var x,n=h.before(this,"destroy",function(b){d[x](b)}),p=[];d.then?(x="cancel",d.then(b,b)):q.forEach(m,
function(k){"function"===typeof d[k]&&(x||(x=k),p.push(h.after(d,k,b,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(q,h,m,x,d,b){q=x("dijit._OnDijitClickMixin",null,{connect:function(d,h,p){return this.inherited(arguments,[d,"ondijitclick"==h?b:h,p])}});q.a11yclick=b;return q})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],
function(q,h,m,x){x.extend(h,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return m("dijit._FocusMixin",null,{_focusManager:q})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(q,h,m,x){m(function(){h("highcontrast")&&q.add(x.body(),"dijit_a11y")});return h})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(q,h,m,x,d,b,z){d.add("highcontrast",function(){var b=z.doc.createElement("div");try{b.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(h.blankGif||q.toUrl("./resources/blank.gif"))+'");';z.body().appendChild(b);var p=x.getComputedStyle(b),k=p.backgroundImage;return p.borderTopColor==p.borderRightColor||k&&("none"==k||"url(invalid-url:)"==k)}catch(y){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
y.toString()),!1}finally{8>=d("ie")?b.outerHTML="":z.body().removeChild(b)}});b(function(){d("highcontrast")&&m.add(z.body(),"dj_a11y")});return d})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(q,h,m,x,d,b,z){b.extend(q,{waiRole:"",waiState:""});return d("dijit._Templated",[h,m],{constructor:function(){z.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(b,d){var h=this.inherited(arguments),p=d(b,"waiRole");p&&b.setAttribute("role",p);(p=d(b,"waiState"))&&x.forEach(p.split(/\s*,\s*/),function(d){-1!=d.indexOf("-")&&(d=d.split("-"),b.setAttribute("aria-"+d[0],d[1]))});return h}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(q,h,m,x,d,b,z,n){var p=h("dijit._TemplatedMixin",n,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var d=this.declaredClass,h=this;return z.substitute(b,this,function(b,k){"!"==k.charAt(0)&&(b=x.getObject(k.substr(1),!1,h));if("undefined"==typeof b)throw Error(d+" template:"+k);return null==b?"":"!"==k.charAt(0)?b:this._escapeValue(""+b)},this)},_escapeValue:function(b){return b.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=q(this.templatePath,{sanitize:!0}));var b=p.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),d;if(x.isString(b)){if(d=m.toDom(this._stringRepl(b),this.ownerDocument),1!=d.nodeType)throw Error("Invalid template: "+b);}else d=b.cloneNode(!0);this.domNode=d}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var d=this.containerNode;if(b&&d)for(;b.hasChildNodes();)d.appendChild(b.firstChild)}});
p._templateCache={};p.getCachedTemplate=function(b,d,h){var f=p._templateCache,k=b,n=f[k];if(n){try{if(!n.ownerDocument||n.ownerDocument==(h||document))return n}catch(B){}m.destroy(n)}b=z.trim(b);if(d||b.match(/\$\{([^\}]+)\}/g))return f[k]=b;d=m.toDom(b,h);if(1!=d.nodeType)throw Error("Invalid template: "+b);return f[k]=d};b("ie")&&d(window,"unload",function(){var b=p._templateCache,d;for(d in b){var h=b[d];"object"==typeof h&&m.destroy(h);delete b[d]}});return p})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(q){return q.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(q,h,m,x,d,b,z,n,p){var k=d.delegate(n,{mouseenter:b.enter,mouseleave:b.leave,keypress:m._keypress}),y;m=x("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var d=b;;)if(1==d.nodeType&&(this._processTemplateNode(d,function(b,d){return b.getAttribute(d)},this._attach)||this.searchContainerNode)&&d.firstChild)d=d.firstChild;else{if(d==b)break;for(;!d.nextSibling;)if(d=d.parentNode,d==b)return;d=d.nextSibling}},_processTemplateNode:function(b,f,h){var p=!0,k=this.attachScope||this,n=f(b,"dojoAttachPoint")||f(b,"data-dojo-attach-point");if(n)for(var a=n.split(/\s*,\s*/);n=
a.shift();)d.isArray(k[n])?k[n].push(b):k[n]=b,p="containerNode"!=n,this._attachPoints.push(n);if(f=f(b,"dojoAttachEvent")||f(b,"data-dojo-attach-event"))for(n=f.split(/\s*,\s*/),a=d.trim;f=n.shift();)if(f){var v=null;-1!=f.indexOf(":")?(v=f.split(":"),f=a(v[0]),v=a(v[1])):f=a(f);v||(v=f);this._attachEvents.push(h(b,f,d.hitch(k,v)))}return p},_attach:function(b,d,h){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?y||(y=q("./a11yclick")):k[d]||d;return z(b,d,h)},_detachTemplateNodes:function(){var b=
this.attachScope||this;h.forEach(this._attachPoints,function(d){delete b[d]});this._attachPoints=[];h.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});d.extend(p,{dojoAttachEvent:"",dojoAttachPoint:""});return m})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(q,h,m,x,d){return m("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var b=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);d.parse(b,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(x.hitch(this,function(b){this._startupWidgets=b;for(var d=0;d<b.length;d++)this._processTemplateNode(b[d],
function(b,d){return b[d]},function(b,d,h){return d in b?b.connect(b,d,h):b.on(d,h,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(b,d,h){return d(b,"dojoType")||d(b,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){q.forEach(this._startupWidgets,function(b){b&&!b._started&&b.startup&&b.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(q,h,m,x,d,b,z,n,p,k,y,D,f,A,C,B){function E(a){return eval("("+a+")")}function a(a){var b=
a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<w){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=w}return b}function v(a,b){b||(b=q);var c=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),d=a.join();if(!c[d]){for(var e=[],g=0,f=a.length;g<f;g++){var u=a[g];e[e.length]=c[u]=c[u]||m.getObject(u)||~u.indexOf("/")&&b(u)}g=e.shift();c[d]=e.length?g.createSubclass?g.createSubclass(e):g.extend.apply(g,e):g}return c[d]}new Date("X");var w=0;p.after(m,"extend",
function(){w++},!0);var c={_clearCache:function(){w++;_ctorMap={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),g=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);g&&g.length&&x.forEach(g.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var d=(c.scope||h._scopeName)+"Type",e="data-"+(c.scope||h._scopeName)+"-",g=e+"type",f=e+"mixins",t=[];x.forEach(a,function(a){var c=
d in b?b[d]:a.getAttribute(g)||a.getAttribute(d);if(c){var e=a.getAttribute(f),c=e?[c].concat(e.split(/\s*,\s*/)):[c];t.push({node:a,types:c})}});return this._instantiate(t,b,c)},_instantiate:function(a,b,c,d){function e(a){b._started||c.noStart||x.forEach(a,function(a){"function"!==typeof a.startup||a._started||a.startup()});return a}a=x.map(a,function(a){var e=a.ctor||v(a.types,c.contextRequire);if(!e)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(e,
a.node,b,c,a.scripts,a.inherited)},this);return d?k(a).then(e):e(a)},construct:function(b,c,d,l,e,r){function g(a){D&&m.setObject(D,a);for(q=0;q<H.length;q++)p[H[q].advice||"after"](a,H[q].method,m.hitch(a,H[q].func),!0);for(q=0;q<K.length;q++)K[q].call(a);for(q=0;q<L.length;q++)a.watch(L[q].prop,L[q].func);for(q=0;q<J.length;q++)C(a,J[q].event,J[q].func);return a}var t=b&&b.prototype;l=l||{};var v={};l.defaults&&m.mixin(v,l.defaults);r&&m.mixin(v,r);var w;f("dom-attributes-explicit")?w=c.attributes:
f("dom-attributes-specified-flag")?w=x.filter(c.attributes,function(a){return a.specified}):(r=(/^input$|^img$/i.test(c.nodeName)?c:c.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),w=x.map(r.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==c.nodeName&&"value"==a||"enctype"==b?c.getAttribute(b):c.getAttributeNode(b).value}}));var u=l.scope||h._scopeName;r="data-"+u+"-";var k={};"dojo"!==u&&(k[r+"props"]=
"data-dojo-props",k[r+"type"]="data-dojo-type",k[r+"mixins"]="data-dojo-mixins",k[u+"type"]="dojotype",k[r+"id"]="data-dojo-id");for(var q=0,z,u=[],D,I;z=w[q++];){var F=z.name,B=F.toLowerCase();z=z.value;switch(k[B]||B){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":I=z;break;case "data-dojo-id":case "jsid":D=z;break;case "data-dojo-attach-point":case "dojoattachpoint":v.dojoAttachPoint=z;break;case "data-dojo-attach-event":case "dojoattachevent":v.dojoAttachEvent=
z;break;case "class":v["class"]=c.className;break;case "style":v.style=c.style&&c.style.cssText;break;default:if(F in t||(F=a(b)[B]||F),F in t)switch(typeof t[F]){case "string":v[F]=z;break;case "number":v[F]=z.length?Number(z):NaN;break;case "boolean":v[F]="false"!=z.toLowerCase();break;case "function":""===z||-1!=z.search(/[^\w\.]+/i)?v[F]=new Function(z):v[F]=m.getObject(z,!1)||new Function(z);u.push(F);break;default:B=t[F],v[F]=B&&"length"in B?z?z.split(/\s*,\s*/):[]:B instanceof Date?""==z?new Date(""):
"now"==z?new Date:y.fromISOString(z):B instanceof n?h.baseUrl+z:E(z)}else v[F]=z}}for(w=0;w<u.length;w++)k=u[w].toLowerCase(),c.removeAttribute(k),c[k]=null;if(I)try{I=E.call(l.propsThis,"{"+I+"}"),m.mixin(v,I)}catch(M){throw Error(M.toString()+" in data-dojo-props\x3d'"+I+"'");}m.mixin(v,d);e||(e=b&&(b._noScript||t._noScript)?[]:A("\x3e script[type^\x3d'dojo/']",c));var H=[],K=[],L=[],J=[];if(e)for(q=0;q<e.length;q++)k=e[q],c.removeChild(k),d=k.getAttribute(r+"event")||k.getAttribute("event"),l=
k.getAttribute(r+"prop"),I=k.getAttribute(r+"method"),u=k.getAttribute(r+"advice"),w=k.getAttribute("type"),k=this._functionFromScript(k,r),d?"dojo/connect"==w?H.push({method:d,func:k}):"dojo/on"==w?J.push({event:d,func:k}):v[d]=k:"dojo/aspect"==w?H.push({method:I,advice:u,func:k}):"dojo/watch"==w?L.push({prop:l,func:k}):K.push(k);b=(e=b.markupFactory||t.markupFactory)?e(v,c,b):new b(v,c);return b.then?b.then(g):g(b)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,e=
c(a.parent),b={dir:b.getAttribute("dir")||e.dir,lang:b.getAttribute("lang")||e.lang,textDir:b.getAttribute(p)||e.textDir},d;for(d in b)b[d]&&(a.inherited[d]=b[d])}return a.inherited}var d=[],e=[],g={},w=(b.scope||h._scopeName)+"Type",u="data-"+(b.scope||h._scopeName)+"-",k=u+"type",p=u+"textdir",u=u+"mixins",n=a.firstChild,m=b.inherited;if(!m){var z=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&z(a.parentNode,b)},m={dir:z(a,"dir"),lang:z(a,"lang"),textDir:z(a,p)},y;for(y in m)m[y]||
delete m[y]}for(var m={inherited:m},A,B;;)if(n)if(1!=n.nodeType)n=n.nextSibling;else if(A&&"script"==n.nodeName.toLowerCase())(C=n.getAttribute("type"))&&/^dojo\/\w/i.test(C)&&A.push(n),n=n.nextSibling;else if(B)n=n.nextSibling;else{var C=n.getAttribute(k)||n.getAttribute(w);y=n.firstChild;if(C||y&&(3!=y.nodeType||y.nextSibling)){B=null;if(C){var E=n.getAttribute(u);A=E?[C].concat(E.split(/\s*,\s*/)):[C];try{B=v(A,b.contextRequire)}catch(K){}B||x.forEach(A,function(a){~a.indexOf("/")&&!g[a]&&(g[a]=
!0,e[e.length]=a)});E=B&&!B.prototype._noScript?[]:null;m={types:A,ctor:B,parent:m,node:n,scripts:E};m.inherited=c(m);d.push(m)}else m={node:n,scripts:A,parent:m};A=E;B=n.stopParser||B&&B.prototype.stopParser&&!b.template;n=y}else n=n.nextSibling}else{if(!m||!m.node)break;n=m.node.nextSibling;B=!1;m=m.parent;A=m.scripts}var H=new D;e.length?(f("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+e.join(", ")),(b.contextRequire||q)(e,function(){H.resolve(x.filter(d,function(a){if(!a.ctor)try{a.ctor=
v(a.types,b.contextRequire)}catch(M){}for(var c=a.parent;c&&!c.types;)c=c.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!c||c.instantiate&&c.instantiateChildren;return a.instantiate}))})):H.resolve(d);return H.promise},_require:function(a,b){var c=E("{"+a.innerHTML+"}"),d=[],e=[],g=new D,f=b&&b.contextRequire||q,v;for(v in c)d.push(v),e.push(c[v]);f(e,function(){for(var a=0;a<d.length;a++)m.setObject(d[a],arguments[a]);g.resolve(arguments)});
return g.promise},_scanAmd:function(a,b){var c=new D,d=c.promise;c.resolve(!0);var e=this;A("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,c){!a||"string"==typeof a||"nodeType"in a||(c=a,a=c.rootNode);var d=a?b.byId(a):z.body();c=c||{};var g=c.template?{template:!0}:{},e=[],f=this,v=this._scanAmd(d,c).then(function(){return f.scan(d,c)}).then(function(a){return f._instantiate(a,g,c,!0)}).then(function(a){return e=
e.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});m.mixin(e,v);return e}};h.parser=c;d.parseOnLoad&&B(100,c,"parse");return c})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(q,h){var m={};q.setObject("dojo.date.stamp",m);m.fromISOString=function(q,d){m._isoRegExp||(m._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var b=m._isoRegExp.exec(q),z=null;
if(b){b.shift();b[1]&&b[1]--;b[6]&&(b[6]*=1E3);d&&(d=new Date(d),h.forEach(h.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return d["get"+b]()}),function(d,h){b[h]=b[h]||d}));z=new Date(b[0]||1970,b[1]||0,b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0);100>b[0]&&z.setFullYear(b[0]||1970);var n=0,p=b[7]&&b[7].charAt(0);"Z"!=p&&(n=60*(b[8]||0)+(Number(b[9])||0),"-"!=p&&(n*=-1));p&&(n-=z.getTimezoneOffset());n&&z.setTime(z.getTime()+6E4*n)}return z};m.toISOString=function(h,
d){var b=function(b){return 10>b?"0"+b:b};d=d||{};var m=[],n=d.zulu?"getUTC":"get",p="";"time"!=d.selector&&(p=h[n+"FullYear"](),p=["0000".substr((p+"").length)+p,b(h[n+"Month"]()+1),b(h[n+"Date"]())].join("-"));m.push(p);if("date"!=d.selector){p=[b(h[n+"Hours"]()),b(h[n+"Minutes"]()),b(h[n+"Seconds"]())].join(":");n=h[n+"Milliseconds"]();d.milliseconds&&(p+="."+(100>n?"0":"")+b(n));if(d.zulu)p+="Z";else if("time"!=d.selector)var n=h.getTimezoneOffset(),k=Math.abs(n),p=p+((0<n?"-":"+")+b(Math.floor(k/
60))+":"+b(k%60));m.push(p)}return m.join("T")};return m})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(q,h,m,x,d,b){return q([b,d],{_onMap:function(b){var d=this.constructor._onMap,h;d&&d.FINAL||(delete this.constructor._onMap,d=this.registerConnectEvents(),d.FINAL=!0);b=b.toLowerCase();d[b]?h=this[d[b].method]:(b=this._onCamelCase(b),this[b]&&(h=b));return h},on:function(b,d){var h=this._onMap(b),
k=b.replace(/\-/g,""),n="on"+k in this.domNode;return h||!n?this.inherited(arguments):this.own(x(this.domNode,k,d))[0]},emit:function(b,d,p){var k,n,m,f=b.toLowerCase(),q=this.constructor._onMap||this.registerConnectEvents();n=this[this._onMap(f)];d=d||{};d.target||(d.target=this);n&&q&&q[f]&&(this._onObj2Arr(function(){k=Array.prototype.slice.call(arguments)},q[f].argKeys)(d),m=h.mixin({},arguments),m[2]=k,m[0]=q[f].name.replace(/^on/,""));return this.inherited(m||arguments)}})})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(q,h,m,x,d){q=q(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],queryable:!1,showPopup:!1,constructor:function(b){b&&(this.name=b.name,this.title=b.title,this.description=b.description,this.extent=b.extent,this.legendURL=b.legendURL,this.subLayers=b.subLayers?b.subLayers:[],this.allExtents=b.allExtents?b.allExtents:[],
this.spatialReferences=b.spatialReferences?b.spatialReferences:[],this.queryable=!!b.queryable,this.showPopup=!!b.showPopup)},clone:function(){var b={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},d;this.extent&&(b.extent=this.extent.getExtent());b.subLayers=[];m.forEach(this.subLayers,function(d){b.subLayers.push(d.clone())});b.allExtents=[];for(d in this.allExtents)d=parseInt(d,10),isNaN(d)||(b.allExtents[d]=this.allExtents[d].getExtent());b.spatialReferences=
[];m.forEach(this.spatialReferences,function(d){b.spatialReferences.push(d)});b.queryable=this.queryable;b.showPopup=this.showPopup;return b}});x("extend-esri")&&h.setObject("layers.WMSLayerInfo",q,d);return q})},"*noref":1}});
define("esri/layers/WMSLayer","require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/sniff ../config ../graphic ../kernel ../request ../urlUtils ../dijit/PopupTemplate ../SpatialReference ../geometry/Extent ../geometry/Point ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),function(q,h,m,x,d,b,z,n,p,k,y,D,f,A,C,B,E){m=m([B],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,
2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,
27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(a,b){var d=y.urlToObject(a);d.query&&(d.query.version||d.query.Version||d.query.VERSION)&&(this.version=d.query.version||d.query.Version||d.query.VERSION);this.url=a=this._stripParameters(a,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));
this._url=y.urlToObject(a);this._getCapabilitiesURL=a;this._initLayer=x.hitch(this,this._initLayer);this._parseCapabilities=x.hitch(this,this._parseCapabilities);this._getCapabilitiesError=x.hitch(this,this._getCapabilitiesError);b?(this.customParameters=b.customParameters,this.customLayerParameters=b.customLayerParameters,this.imageFormat=this._getImageFormat(b.format),this.imageTransparency=!1!==b.transparent,this.visibleLayers=b.visibleLayers?b.visibleLayers:[],this.version=b.version||this.version,
b.resourceInfo?this._readResourceInfo(b.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=q.toUrl("../images/pixel.png");this.extentProcessor=this._createExtentProcessor(0);this._createChildLayer()},setVisibleLayers:function(a){this.visibleLayers=(a=this._checkVisibleLayersList(a))?a:[];this.refresh(!0)},setImageFormat:function(a){this.imageFormat=this._getImageFormat(a);this.refresh(!0)},
setImageTransparency:function(a){this.imageTransparency=a;this.refresh(!0)},setCustomParameters:function(a,b){this.customParameters=a;this.customLayerParameters=b;this.refresh(!0)},refresh:function(){this.inherited(arguments);this._childLayer&&this._childLayer.refresh.apply(this._childLayer,arguments)},getImageUrl:function(a,b,d,c){if(this.visibleLayers&&0!==this.visibleLayers.length){a=this._getImageParams(a,b,d);a=this._mixinCustomLayerParameters(a);b=this.getMapURL;var f;b+=-1===b.indexOf("?")?
"?":"";for(f in a)a.hasOwnProperty(f)&&(b+="?"===b.substring(b.length-1,b.length)?"":"\x26",b+=f+"\x3d"+a[f]);c(y.addProxy(b))}else c(this._blankImageURL)},_setMap:function(a,b,d){var c=this.inherited(arguments);a.wrapAround180?this._childLayer&&(this.suspended&&this._childLayer.suspend(),this._childLayer._setMap(a,c)):this._childLayer=this.extentProcessor=null;return c},_unsetMap:function(a,b){this._childLayer&&this._childLayer._unsetMap(a,this._div);this.inherited(arguments)},onSuspend:function(){this.inherited(arguments);
this._childLayer&&this._childLayer.suspend()},onResume:function(){this.inherited(arguments);this._childLayer&&this._childLayer.resume()},_createChildLayer:function(){this._childLayer=new B(null,{extentProcessor:this._createExtentProcessor(1)});this._childLayer._isChildLayer=!0;this._childLayer.getImageUrl=x.hitch(this,this.getImageUrl);this._childLayer.loaded=!0},_createExtentProcessor:function(a){return x.hitch(this,this._extentProcessor,a)},_extentProcessor:function(a,b){var d=b.extent,c=b.width,
f=0;if(d){var g=d.getWidth()/c,h=d.bisect(),d=h.extents,l=d[a];l&&(c=h.marginLeft/g,f=0===a?c:c+d[0].getWidth()/g,c=Math.ceil(l.getWidth()/g),f=Math.ceil(f));d=l}return{extent:d,width:c,marginLeft:f}},_getImageParams:function(a,b,f){var c=a.spatialReference.wkid;-1===d.indexOf(this.spatialReferences,c)&&a.spatialReference.latestWkid&&(c=a.spatialReference.latestWkid);if(d.some(this._WEB_MERCATOR,function(a){return a==c})){var h=d.filter(this.spatialReferences,function(a){return d.some(this._WEB_MERCATOR,
function(b){return b==a})},this);0===h.length&&(h=d.filter(this.spatialReferences,function(a){return d.some(this._WORLD_MERCATOR,function(b){return b==a})},this));c=0<h.length?h[0]:this._WEB_MERCATOR[0]}this.spatialReferences=d.filter(this.spatialReferences,function(a){return a!==c});this.spatialReferences.unshift(c);var h=a.xmin,g=a.xmax,t=a.ymin;a=a.ymax;var l={SERVICE:"WMS",REQUEST:"GetMap"};l.FORMAT=this.imageFormat;l.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";l.STYLES="";l.VERSION=this.version;
l.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;l.WIDTH=b;l.HEIGHT=f;this.maxWidth<b&&(l.WIDTH=this.maxWidth);this.maxHeight<f&&(l.HEIGHT=this.maxHeight);b=c?c:NaN;isNaN(b)||("1.3.0"==this.version?l.CRS="EPSG:"+b:l.SRS="EPSG:"+b);"1.3.0"==this.version&&this._useLatLong(b)?l.BBOX=t+","+h+","+a+","+g:l.BBOX=h+","+t+","+g+","+a;return l},_initLayer:function(a,d){this.spatialReference=new f(this.extent.spatialReference);this.initialExtent=new A(this.extent);this.fullExtent=new A(this.extent);
this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);var h=x.hitch(this,function(){this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))});if(b("chrome")){var c=z.defaults.io,v="with-credentials"===c.useCors?y.canUseXhr(this.getMapURL,!0):-1;(c=-1<v?c.corsEnabledServers[v]:null)&&c.withCredentials?k({url:this.getMapURL,handleAs:"text",content:{SERVICE:"WMS",REQUEST:"GetMap"}}).addBoth(function(){h()}):h()}else h()},_readResourceInfo:function(a){a.extent?
a.layerInfos?(this.extent=a.extent,this.allExtents[0]=a.extent,this.layerInfos=a.layerInfos,this.description=a.description?a.description:"",this.copyright=a.copyright?a.copyright:"",this.title=a.title?a.title:"",this.getMapURL=a.getMapURL?a.getMapURL:this._getCapabilitiesURL,this.getFeatureInfoURL=a.getFeatureInfoURL,this.featureInfoFormat=a.featureInfoFormat,this.version=a.version?a.version:"1.3.0",this.maxWidth=a.maxWidth?a.maxWidth:5E3,this.maxHeight=a.maxHeight?a.maxHeight:5E3,this.spatialReferences=
a.spatialReferences?a.spatialReferences:[],this.imageFormat=this._getImageFormat(a.format),this.setScaleRange(a.minScale,a.maxScale),this.customLayerParameters=a.customLayerParameters||this.customLayerParameters,this.customParameters=a.customParameters||this.customParameters,this._initLayer()):this._errorHandler(Error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo")):this._errorHandler(Error("esri.layers.WMSLayer: Unable to find the 'extent' property in resourceInfo."))},
_getCapabilities:function(){var a=this._url.query?this._url.query:{};a.SERVICE="WMS";a.REQUEST="GetCapabilities";this.version&&(a.VERSION=this.version);var a=this._mixinCustomParameters(a),b=this._url.path+"?",d;for(d in a)a.hasOwnProperty(d)&&(b+="?"==b.substring(b.length-1,b.length)?"":"\x26",b+=d+"\x3d"+a[d]);k({url:b,handleAs:"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(a){if(a){var b=this;this.version=
this._getAttributeValue("WMS_Capabilities","version",a,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",a,"1.3.0"));var f=this._getTag("Service",a);this.title=this._getTagValue("Title",f,"");this.title||(this.title=this._getTagValue("Name",f,""));this.copyright=this._getTagValue("AccessConstraints",f,"");this.description=this._getTagValue("Abstract",f,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",f,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",
f,5E3),10);if(f=this._getTag("Layer",a)){var c=this._getLayerInfo(f),k=0,g=null,f=this._getTag("Capability",a);d.forEach(f.childNodes,function(a){"Layer"==a.nodeName&&(0===k?g=a:(1===k&&c.name&&(c.name="",c.subLayers=[],c.subLayers.push(this._getLayerInfo(g))),c.subLayers.push(this._getLayerInfo(a))),k++)},this);if(c&&(this.layerInfos=c.subLayers,this.layerInfos&&0!==this.layerInfos.length||(this.layerInfos=[c]),this.extent=c.extent,this.extent||(c.extent=new A(this.layerInfos[0].extent.toJson()),
this.extent=c.extent),this.allExtents=c.allExtents,this.allExtents&&this.allExtents.length||(c.allExtents=[],d.forEach(this.layerInfos[0].allExtents,function(a,b){a&&(c.allExtents[b]=new A(a.toJson()))}),this.allExtents=c.allExtents),this.spatialReferences=c.spatialReferences,!this.spatialReferences.length&&0<this.layerInfos.length))for(var t=function(a){var b;for(b=0;b<a.subLayers.length;b++){var c=a.subLayers[b],d=c.spatialReferences;!d.length&&c.subLayers&&0<c.subLayers.length&&(d=t(c));if(d.length)return d}return[]},
f=0;f<this.layerInfos.length;f++){var l=this.layerInfos[f];this.spatialReferences=this.layerInfos[0].spatialReferences;!this.spatialReferences.length&&l.subLayers&&0<l.subLayers.length&&(this.spatialReferences=t(l));if(this.spatialReferences.length)break}f=function(c){return(c=h.query("DCPType",b._getTag(c,a)))&&0<c.length&&(c=h.query("HTTP",c[0]))&&0<c.length&&(c=h.query("Get",c[0]))&&0<c.length&&(c=b._getAttributeValue("OnlineResource","xlink:href",c[0],null))?(c.indexOf("\x26")===c.length-1&&(c=
c.substring(0,c.length-1)),b._stripParameters(c,["service","request"])):null};l=function(c){var e=[];0===h.query("Operation",a).length?d.forEach(h.query("Format",b._getTag(c,a)),function(a){e.push(a.text?a.text:a.textContent)}):d.forEach(h.query("Operation",a),function(a){a.getAttribute("name")===c&&d.forEach(h.query("Format",a),function(a){e.push(a.text?a.text:a.textContent)})});return e};this.getMapURL=f("GetMap")||this._getCapabilitiesURL;this.getMapFormats=l("GetMap");d.some(this.getMapFormats,
function(a){return-1<a.indexOf(this.imageFormat)},this)||(this.imageFormat=this.getMapFormats[0]);if(this.getFeatureInfoURL=f("GetFeatureInfo"))this.getFeatureInfoFormats=l("GetFeatureInfo"),-1<d.indexOf(this.getFeatureInfoFormats,"text/html")?this.featureInfoFormat="text/html":-1<d.indexOf(this.getFeatureInfoFormats,"text/plain")&&(this.featureInfoFormat="text/plain");if(!this.featureInfoFormat){var e=function(a){if(a&&(a.queryable=!1,a.subLayers))for(var b=0;b<a.subLayers.length;b++)e(a.subLayers[b])};
e(c)}this._initLayer()}else this._errorHandler(Error("esri.layers.WMSLayer: Response does not contain any layers."))}else this._errorHandler(Error("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)"))},_getCapabilitiesError:function(a){a&&a.message&&(a.message="GetCapabilities request for "+this._getCapabilitiesURL+" failed. ("+a.message+")");this._errorHandler(a)},_getLayerInfo:function(a){if(!a)return null;var b=new E;b.name="";b.title="";b.description="";b.allExtents=
[];b.spatialReferences=[];b.queryable="1"===a.getAttribute("queryable");b.subLayers=[];var h=this._getTag("LatLonBoundingBox",a);h&&(b.allExtents[0]=this._getExtent(h,4326));var c=this._getTag("EX_GeographicBoundingBox",a),k;c&&(k=new A(0,0,0,0,new f({wkid:4326})),k.xmin=parseFloat(this._getTagValue("westBoundLongitude",c,0)),k.ymin=parseFloat(this._getTagValue("southBoundLatitude",c,0)),k.xmax=parseFloat(this._getTagValue("eastBoundLongitude",c,0)),k.ymax=parseFloat(this._getTagValue("northBoundLatitude",
c,0)),b.allExtents[0]=k);h||c||(k=new A(-180,-90,180,90,new f({wkid:4326})),b.allExtents[0]=k);b.extent=b.allExtents[0];var g=-1<d.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";d.forEach(a.childNodes,function(a){if("Name"==a.nodeName)b.name=(a.text?a.text:a.textContent)||"";else if("Title"==a.nodeName)b.title=(a.text?a.text:a.textContent)||"";else if("Abstract"==a.nodeName)b.description=(a.text?a.text:a.textContent)||"";else if("BoundingBox"==a.nodeName){var c=a.getAttribute(g);c&&0===
c.indexOf("EPSG:")?(c=parseInt(c.substring(5),10),0===c||isNaN(c)||(a="1.3.0"==this.version?this._getExtent(a,c,this._useLatLong(c)):this._getExtent(a,c),b.allExtents[c]=a,b.extent||(b.extent=a))):c&&0===c.indexOf("CRS:")?(c=parseInt(c.substring(4),10),0===c||isNaN(c)||(this._CRS_TO_EPSG[c]&&(c=this._CRS_TO_EPSG[c]),b.allExtents[c]=this._getExtent(a,c))):(c=parseInt(c,10),0===c||isNaN(c)||(b.allExtents[c]=this._getExtent(a,c)))}else if(a.nodeName==g)a=(a.text?a.text:a.textContent).split(" "),d.forEach(a,
function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0===a||isNaN(a)||(this._CRS_TO_EPSG[a]&&(a=this._CRS_TO_EPSG[a]),-1==d.indexOf(b.spatialReferences,a)&&b.spatialReferences.push(a))},this);else if("Style"!=a.nodeName||b.legendURL)"Layer"===a.nodeName&&b.subLayers.push(this._getLayerInfo(a));else if(a=this._getTag("LegendURL",a))if(a=this._getTag("OnlineResource",a))b.legendURL=a.getAttribute("xlink:href")},this);b.title=b.title||b.name;return b},_getImageFormat:function(a){switch(a?
a.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";case "gif":return"image/gif";case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(a,b,d){var c;if(a){c=new A;var h=parseFloat(a.getAttribute("minx")),g=parseFloat(a.getAttribute("miny")),
k=parseFloat(a.getAttribute("maxx"));a=parseFloat(a.getAttribute("maxy"));d?(c.xmin=isNaN(g)?-1*Number.MAX_VALUE:g,c.ymin=isNaN(h)?-1*Number.MAX_VALUE:h,c.xmax=isNaN(a)?Number.MAX_VALUE:a,c.ymax=isNaN(k)?Number.MAX_VALUE:k):(c.xmin=isNaN(h)?-1*Number.MAX_VALUE:h,c.ymin=isNaN(g)?-1*Number.MAX_VALUE:g,c.xmax=isNaN(k)?Number.MAX_VALUE:k,c.ymax=isNaN(a)?Number.MAX_VALUE:a);c.spatialReference=new f({wkid:b})}return c},_useLatLong:function(a){var b,d;for(d=0;d<this._REVERSED_LAT_LONG_RANGES.length;d++){var c=
this._REVERSED_LAT_LONG_RANGES[d];if(a>=c[0]&&a<=c[1]){b=!0;break}}return b},_getTag:function(a,b){var d=h.query(a,b);return d&&0<d.length?d[0]:null},_getTagValue:function(a,b,d){return(a=h.query(a,b))&&0<a.length?a[0].text?a[0].text:a[0].textContent:d},_getAttributeValue:function(a,b,d,c){return(a=h.query(a,d))&&0<a.length?a[0].getAttribute(b):c},_checkVisibleLayersList:function(a){if(a&&0<a.length&&this.layerInfos&&0<this.layerInfos.length&&"number"==typeof a[0]){var b=[];d.forEach(a,function(a){a<
this.layerInfos.length&&b.push(this.layerInfos[a].name)},this);a=b}return a},_stripParameters:function(a,b){var f=y.urlToObject(a),c,h=[];for(c in f.query)f.query.hasOwnProperty(c)&&-1===d.indexOf(b,c.toLowerCase())&&h.push(c+"\x3d"+f.query[c]);return f.path+(h.length?"?"+h.join("\x26"):"")},_getPopupGraphic:function(a,b){var f=this.visibleLayers;if(!f||0===f.length)return null;var c=this._popupGraphic;c||(c=new D({title:this.title||"",description:'\x3cdiv style\x3d"position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;"\x3e\x3ciframe src\x3d"{QUERY_URL}" width\x3d"250" height\x3d"147" frameborder\x3d"0" marginwidth\x3d"0" marginheight\x3d"0" style\x3d"position:absolute;top:0;left:0;width:100%;height:100%;border:0;background:url(\''+
q.toUrl("../dijit/images/loading-throb.gif")+"') transparent center no-repeat;\" onload\x3d\"(event.target || event.srcElement).style.background \x3d 'none';\"\x3e\x3c/iframe\x3e\x3c/div\x3e"}),c=this._popupGraphic=new n(null,null,{},c),c._layer=this);var h=function(a){var b=[];if(a&&(a.queryable&&a.showPopup&&a.name&&b.push(a.name),a.subLayers))for(var c=0;c<a.subLayers.length;c++){var d=h(a.subLayers[c]);d.length&&(b=b.concat(d))}return b},g=h({subLayers:this.layerInfos}),g=d.filter(g,function(a){return-1<
d.indexOf(f,a)});if(g.length){var k=this.getFeatureInfoURL,l=this._getImageParams(a.extent,a.width,a.height),l=this._mixinCustomLayerParameters(l);l.REQUEST="GetFeatureInfo";l.INFO_FORMAT=this.featureInfoFormat;l.QUERY_LAYERS=g.join();l.FEATURE_COUNT=25;"1.3.0"===this.version?(l.I=Math.round(b.x),l.J=Math.round(b.y)):(l.X=Math.round(b.x),l.Y=Math.round(b.y));var k=k+(-1===k.indexOf("?")?"?":""),e;for(e in l)l.hasOwnProperty(e)&&(k+="?"===k.substring(k.length-1,k.length)?"":"\x26",k+=e+"\x3d"+l[e]);
c.attributes.QUERY_URL=k;return c}return null},_mixinCustomParameters:function(a){if(this.customParameters)for(var b in this.customParameters)a[b]=encodeURIComponent(this.customParameters[b]);return a},_mixinCustomLayerParameters:function(a){if(this.customLayerParameters||this.customParameters){var b=x.clone(this.customParameters||{});x.mixin(b,this.customLayerParameters||{});for(var d in b)"styles"===d.toLowerCase()&&delete a.STYLES,a[d]=encodeURIComponent(b[d])}return a}});b("extend-esri")&&x.setObject("layers.WMSLayer",
m,p);return m});