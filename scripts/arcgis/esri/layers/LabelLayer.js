// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.22/esri/copyright.txt for details.
//>>built
require({cache:{"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all dojox/html/entities ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/RelationshipQuery ./tasks/StatisticDefinition ./renderers/arcadeUtils ./layers/support/attributeUtils dojo/i18n!dojo/cldr/nls/number".split(" "),function(t,p,n,A,B,q,m,b,a,f,g,e,d,c,k,h,u,v,l,w){t=t(null,{declaredClass:"esri.PopupInfo",
_reExprField:/^\s*expression\//i,_exprPrefix:"expression/",_relatedFieldPrefix:"relationships/",initialize:function(a,c){if(a){p.mixin(this,c);this.info=a;this.title=this.getTitle;this.content=this.getContent;this._exprCache=this._compileExpressions(this.info.expressionInfos);var b=this._fieldLabels={},r=this._fieldsMap={};this.info.fieldInfos&&n.forEach(this.info.fieldInfos,function(a){var c=a.fieldName.toLowerCase(),f=this._isExpressionField(c)?this.getExpressionInfo(c):null;b[c]=f?f.title:a.label;
r[c]=a},this);this.titleHasRelatedFields=!(!this.info.title||-1===this.info.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return A.fromJson(A.toJson(this.info))},getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var c;n.some(this.info&&this.info.fieldInfos,function(b){b.fieldName===a&&(c=b);return!!c});return c},getExpressionInfo:function(a){if(this._isExpressionField(a)){a=a.replace(this._reExprField,"");a=a.toLowerCase();var c;n.some(this.info.expressionInfos,
function(b){b.name.toLowerCase()===a&&(c=b);return!!c});return c}},getComponents:function(a){var c=this.info,b=new m,f,r;c.fieldInfos&&(r=n.filter(c.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));r&&0<r.length&&(f=this._getRelatedRecords({graphic:a,fieldsInfo:r}));f?f.always(p.hitch(this,function(){b.resolve(this._getPopupValues(a))})):b.resolve(this._getPopupValues(a));return b.promise},getAttachments:function(a){var c=a.getSourceLayer();a=a.attributes;if(this.info.showAttachments&&
c&&c.hasAttachments&&c.objectIdField&&(a=a&&a[c.objectIdField]))return c.queryAttachmentInfos(a)},_isExpressionField:function(a){return this._reExprField.test(a)},_compileExpressions:function(a){var c={};n.forEach(a,function(a){var b=a.returnType&&a.returnType.toLowerCase();c[a.name]=l.createAttributeCache({valueExpression:a.expression},"number"!==b)});return c},_fetchAttributes:function(a){var c=p.clone(a.attributes)||{},b=this._exprPrefix,d=this._exprCache;n.forEach(this.info.expressionInfos,function(e){var r=
b+e.name;e=(e=d[e.name])?a._getDataValue(e.attributeInfo,e,v):null;"string"===typeof e&&(e=f.encode(e));c[r]=e});return c},_getPopupValues:function(a,c){var b=this.info,f=a.getSourceLayer(),e=this._fetchAttributes(a),d=p.clone(e),r=b.fieldInfos,x="",k="",y,h,l,v,u,m=f&&f._getDateOpts&&f._getDateOpts().properties,m=m&&m.slice(0),w={dateFormat:{properties:m,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(v in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(v)){var q=
this._relatedInfo[v],B=this._relatedLayersInfo[v];q&&(n.forEach(q.relatedFeatures,function(a){for(u in a.attributes)if(a.attributes.hasOwnProperty(u)&&"esriRelCardinalityOneToOne"===B.relation.cardinality){var c=this._toRelatedFieldName([B.relation.id,u]);e[c]=d[c]=a.attributes[u]}},this),n.forEach(q.relatedStatsFeatures,function(a){for(u in a.attributes)if(a.attributes.hasOwnProperty(u)){var c=this._toRelatedFieldName([B.relation.id,u]);e[c]=d[c]=a.attributes[u]}},this))}r&&n.forEach(r,function(a){h=
a.fieldName;var c=this._getLayerFieldInfo(f,h);c&&(h=a.fieldName=c.name);d[h]=this._formatValue(d[h],h,w);m&&a.format&&a.format.dateFormat&&(a=n.indexOf(m,h),-1<a&&m.splice(a,1))},this);if(f){v=f.types;var t=(q=f.typeIdField)&&e[q];for(h in e)if(e.hasOwnProperty(h)&&-1===h.indexOf(this._relatedFieldPrefix)&&(l=e[h],g.isDefined(l))){var A=this._getDomainName(f,a,v,t,h,l);g.isDefined(A)?d[h]=A:h===q&&(A=this._getTypeName(f,a,l),g.isDefined(A)&&(d[h]=A))}}b.title&&(x=this._processFieldsInLinks(this._fixTokens(b.title,
f),e),x=p.trim(g.substitute(d,x,w)||""));if(c)return{title:x};b.description&&(k=this._processFieldsInLinks(this._fixTokens(b.description,f),e),k=p.trim(g.substitute(d,k,w)||""));r&&(y=[],n.forEach(r,function(a){(h=a.fieldName)&&a.visible&&y.push([this._fieldLabels[h.toLowerCase()]||h,g.substitute(d,"${"+h+"}",w)||""])},this));var H,L;b.mediaInfos&&(H=[],n.forEach(b.mediaInfos,function(a){L=0;l=a.value;switch(a.type){case "image":var c=l.sourceURL,c=c&&p.trim(g.substitute(e,this._fixTokens(c,f)));
L=!!c;break;case "piechart":case "linechart":case "columnchart":case "barchart":var b,c=l.normalizeField;l.fields=n.map(l.fields,function(a){return(b=this._getLayerFieldInfo(f,a))?b.name:a},this);c&&(b=this._getLayerFieldInfo(f,c),l.normalizeField=b?b.name:c);L=n.some(l.fields,function(a){return g.isDefined(e[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(L){a=p.clone(a);l=a.value;var c=a.title?this._processFieldsInLinks(this._fixTokens(a.title,f),
e):"",x=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,f),e):"";a.title=c?p.trim(g.substitute(d,c,w)||""):"";a.caption=x?p.trim(g.substitute(d,x,w)||""):"";if("image"===a.type)l.sourceURL=g.substitute(e,this._fixTokens(l.sourceURL,f)),l.linkURL&&(l.linkURL=p.trim(g.substitute(e,this._fixTokens(l.linkURL,f))||""));else{var r,k;n.forEach(l.fields,function(a,c){if(-1!==a.indexOf(this._relatedFieldPrefix))k=this._getRelatedChartInfos(a,l,e,w),k instanceof Array?l.fields=k:l.fields[c]=
k;else{var b=e[a],b=void 0===b?null:b;r=e[l.normalizeField]||0;b&&r&&(b/=r);l.fields[c]={y:b,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(b,a,w,!!r)}}},this)}H.push(a)}},this));return{title:x,description:k,hasDescription:!!b.description,fields:y&&y.length?y:null,mediaInfos:H&&H.length?H:null,formatted:d,editSummary:f&&f.getEditSummary?f.getEditSummary(a):""}},_getRelatedChartInfos:function(a,c,b,f){var e,d,r,x,k,h;e=[];h=this._fromRelatedFieldName(a);k=h[0];d=this._relatedInfo[k];
k=this._relatedLayersInfo[k];d&&n.forEach(d.relatedFeatures,function(d){d=d.attributes;var k,y;for(y in d)if(d.hasOwnProperty(y)&&y===h[1]){k={};x=d[y];c.normalizeField&&(r=-1!==c.normalizeField.indexOf(this._relatedFieldPrefix)?d[this._fromRelatedFieldName(c.normalizeField)[1]]:b[c.normalizeField]);x&&r&&(x/=r);if(c.tooltipField)if(-1!==c.tooltipField.indexOf(this._relatedFieldPrefix)){var l=this._fromRelatedFieldName(c.tooltipField)[1],v=g.isDefined(d[l])?d[l]:l;k.tooltip=v+":\x3cbr/\x3e"+this._formatValue(x,
l,f,!!r)}else k.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(x,c.tooltipField,f,!!r);else k.tooltip=x;k.y=x;e.push(k)}},this);return"esriRelCardinalityOneToMany"===k.relation.cardinality||"esriRelCardinalityManyToMany"===k.relation.cardinality?e:e[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",
longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",
shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,
_reEmptyHref:/^href\s*=\s*"\s*"$/i,_reEmptyHrefApos:/^href\s*=\s*'\s*'$/i,_fixTokens:function(a,c){var b=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,f,e){a=b._getLayerFieldInfo(c,e);return"$"+(a?"{"+a.name+"}":f)})},_encodeAttributes:function(a){a=p.clone(a)||{};var c,b;for(c in a)(b=a[c])&&"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),a[c]=b);return a},_processFieldsInLinks:function(a,c){var b=this._encodeAttributes(c),b=p.hitch(this,this._addValuesToHref,c,
b);a&&(a=a.replace(this._reHref,b).replace(this._reHrefApos,b));return a},_addValuesToHref:function(a,c,b,f){f=f&&p.trim(f);b=g.substitute(f&&0===f.indexOf("${")?a:c,b);this._reEmptyHref.test(b)?b='href\x3d"about:blank"':this._reEmptyHrefApos.test(b)&&(b="href\x3d'about:blank'");return b},_getLayerFieldInfo:function(a,c){return a&&a.getField?a.getField(c):null},_formatValue:function(a,c,b,f){var e=this._fieldsMap[c.toLowerCase()],d=e&&e.format;c=-1!==n.indexOf(b.dateFormat.properties,c);var k="number"===
typeof a&&!c&&(!d||!d.dateFormat);if(!g.isDefined(a)||!e||!g.isDefined(d))return k?this._forceLTR(a):a;var x="",e=[],h=d.hasOwnProperty("places")||d.hasOwnProperty("digitSeparator"),r=d.hasOwnProperty("digitSeparator")?d.digitSeparator:!0;if(h&&!c)x="NumberFormat",e.push("places: "+(g.isDefined(d.places)&&(!f||0<d.places)?Number(d.places):"Infinity")),e.length&&(x+="("+e.join(",")+")");else if(d.dateFormat)x="DateFormat"+this._insertOffset(this._dateFormats[d.dateFormat]||this._dateFormats.shortDateShortTime);
else return k?this._forceLTR(a):a;var l=this._applyFormatting(a,x,b);h&&-1<a.constructor.toString().indexOf("Array")&&(l="",n.forEach(a,p.hitch(this,function(a,c){c&&(l+=" ");l+=this._applyFormatting(a,x,b)})));h&&!r&&w.group&&(l=l.replace(new RegExp("\\"+w.group,"g"),""));c&&(l='\x3cspan class\x3d"esriDateValue"\x3e'+l+"\x3c/span\x3e");return k?this._forceLTR(l):l},_applyFormatting:function(a,c,b){return g.substitute({myKey:a},"${myKey:"+c+"}",b)||""},_forceLTR:function(a){var c=b("ie");return c&&
10>=c?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=g.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,c,b,f,e,d){return(a=a.getDomain&&a.getDomain(e,{feature:c}))&&a.codedValues?a.getName(d):null},_getTypeName:function(a,c,b){return(a=a.getType&&a.getType(c))&&a.name},_getRelatedRecords:function(a){var c=a.graphic,b=new m,f;this._relatedLayersInfo?this._queryRelatedLayers(c).then(p.hitch(this,
function(a){this._setRelatedRecords(c,a);b.resolve(a)}),p.hitch(this,this._handlerErrorResponse,b)):this._getRelatedLayersInfo(a).then(p.hitch(this,function(a){for(f in a)a.hasOwnProperty(f)&&a[f]&&(this._relatedLayersInfo[f].relatedLayerInfo=a[f]);this._queryRelatedLayers(c).then(p.hitch(this,function(a){this._setRelatedRecords(c,a);b.resolve(a)}),p.hitch(this,this._handlerErrorResponse,b))}),p.hitch(this,this._handlerErrorResponse,b));return b.promise},_getRelatedLayersInfo:function(c){var b=c.fieldsInfo,
f,e,k={};f=c.graphic.getSourceLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});n.forEach(b,function(a){var c,b,e,d;c=this._fromRelatedFieldName(a.fieldName);b=c[0];c=c[1];b&&(this._relatedLayersInfo[b]||(n.some(f.relationships,function(a){if(a.id==b)return d=a,!0}),d&&(this._relatedLayersInfo[b]={relation:d,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[b]&&(this._relatedLayersInfo[b].relatedFields.push(c),a.statisticType&&(e=new u,e.statisticType=a.statisticType,e.onStatisticField=
c,e.outStatisticFieldName=c,this._relatedLayersInfo[b].outStatistics.push(e))))},this);for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&this._relatedLayersInfo[e]&&(c=this._relatedLayersInfo[e].relation,c=f.url.replace(/[0-9]+$/,c.relatedTableId),this._relatedLayersInfo[e].relatedLayerUrl=c,k[e]=d({url:c,content:{f:"json"},callbackParamName:"callback"}));return a(k)},_queryRelatedLayers:function(c){var b={},e;for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&
(b[e]=this._queryRelatedLayer({graphic:c,relatedInfo:this._relatedLayersInfo[e]}));return a(b)},_queryRelatedLayer:function(b){var e,f,d,h,l,g,x,v,r,u,w,F,q;e=b.graphic;f=e.getSourceLayer();d=f.url.match(/[0-9]+$/g)[0];w=b.relatedInfo;u=w.relatedLayerInfo;F=w.relatedLayerUrl;b=w.relation;n.some(u.relationships,function(a){if(a.relatedTableId===parseInt(d,10))return h=a,!0},this);h&&(l=new c,n.some(u.fields,function(a){if(a.name===h.keyField)return v=-1!==n.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger",
"esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),h.relationshipTableId&&h.keyFieldInRelationshipTable?(q=new m,this._queryRelatedRecords(e,h).then(p.hitch(this,function(a){var b;b=a[e.attributes[f.objectIdField]];a=n.map(b.features,function(a){return a.attributes[u.objectIdField]},this);w.outStatistics&&0<w.outStatistics.length&&u.supportsStatistics&&(r=new c,r.objectIds=a,r.outFields=l.outFields,r.outStatistics=w.outStatistics);r&&(g=new k(F),g.execute(r).then(p.hitch(this,
function(a){var c=[];c.push(b);c.push(a);q.resolve(c)})))}))):(x="string"===v?h.keyField+"\x3d'"+e.attributes[b.keyField]+"'":h.keyField+"\x3d"+e.attributes[b.keyField],l.where=x,l.outFields=w.relatedFields,w.outStatistics&&0<w.outStatistics.length&&u.supportsStatistics&&(r=new c,r.where=l.where,r.outFields=l.outFields,r.outStatistics=w.outStatistics),g=new k(F),x=[],x.push(g.execute(l)),r&&x.push(g.execute(r))));return x?a(x):q?q.promise:void 0},_setRelatedRecords:function(a,c){this._relatedInfo=
[];for(var b in c)if(c.hasOwnProperty(b)&&c[b]){var e=c[b];this._relatedInfo[b]={};this._relatedInfo[b].relatedFeatures=e[0].features;g.isDefined(e[1])&&(this._relatedInfo[b].relatedStatsFeatures=e[1].features)}},_handlerErrorResponse:function(a,c){a.reject(c)},_fromRelatedFieldName:function(a){var c=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),c=a.slice(1));return c},_toRelatedFieldName:function(a){var c="";a&&0<a.length&&(c=this._relatedFieldPrefix+a[0]+"/"+a[1]);return c},_queryRelatedRecords:function(a,
c){var b=a.getSourceLayer(),e=new h;e.outFields=["*"];e.relationshipId=c.id;e.objectIds=[a.attributes[b.objectIdField]];return b.queryRelatedFeatures(e)}});q("extend-esri")&&(e.PopupInfo=e.PopupInfoTemplate=t);return t})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(t){var p=t.getObject("dojox.html.entities",!0),n=function(p,q){var m,b;if(q._encCache&&q._encCache.regexp&&q._encCache.mapper&&q.length==q._encCache.length)m=q._encCache.mapper,b=q._encCache.regexp;else{m={};b=
["["];var a;for(a=0;a<q.length;a++)m[q[a][0]]="\x26"+q[a][1]+";",b.push(q[a][0]);b.push("]");b=new RegExp(b.join(""),"g");q._encCache={mapper:m,regexp:b,length:q.length}}return p=p.replace(b,function(a){return m[a]})},A=function(p,q){var m,b;if(q._decCache&&q._decCache.regexp&&q._decCache.mapper&&q.length==q._decCache.length)m=q._decCache.mapper,b=q._decCache.regexp;else{m={};b=["("];var a;for(a=0;a<q.length;a++){var f="\x26"+q[a][1]+";";a&&b.push("|");m[f]=q[a][0];b.push(f)}b.push(")");b=new RegExp(b.join(""),
"g");q._decCache={mapper:m,regexp:b,length:q.length}}return p=p.replace(b,function(a){return m[a]})};p.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];p.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1",
"plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],
["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],
["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],
["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3",
"gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],
["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],
["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297",
"otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f",
"rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];p.encode=function(t,q){t&&(q?t=n(t,q):(t=n(t,p.html),t=n(t,p.latin)));return t};p.decode=function(n,q){n&&(q?n=A(n,q):(n=A(n,p.html),n=A(n,p.latin)));return n};return p})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(t,p,n,A,B,q,m,b,a,f,g,e,d){t=t(e,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(a,b){this._handler=p.hitch(this,this._handler);this._relationshipQueryHandler=p.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=p.hitch(this,this._executeForIdsHandler);this._countHandler=p.hitch(this,this._countHandler);
this._extentHandler=p.hitch(this,this._extentHandler);this.source=b&&b.source;this.gdbVersion=b&&b.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},
onExecuteForExtentComplete:function(){},execute:function(a,e,f,d,g){d=g.assembly;a=this._encode(p.mixin({},this._url.query,{f:"json"},a.toJson(d&&d[0])));var c=this._handler,k=this._errorHandler;this.source&&(d={source:this.source.toJson()},a.layer=B.toJson(d));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,b){c(a,b,e,f,g.dfd)},error:function(a){k(a,f,g.dfd)}},this.requestOptions)},executeRelationshipQuery:function(c,
e,f){c=this._encode(p.mixin({},this._url.query,{f:"json"},c.toJson()));var d=this._relationshipQueryHandler,k=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var h=new A(a._dfdCanceller);h._pendingDfd=b({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(a,c){d(a,c,e,f,h)},error:function(a){k(a,f,h)}},this.requestOptions);return h},executeForIds:function(a,e,f,d){var c=d.assembly;a=this._encode(p.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
a.toJson(c&&c[0])));var k=this._executeForIdsHandler,h=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=B.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){k(a,c,e,f,d.dfd)},error:function(a){h(a,f,d.dfd)}},this.requestOptions)},executeForCount:function(a,e,f,d){var c=d.assembly;a=this._encode(p.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},a.toJson(c&&
c[0])));var k=this._countHandler,h=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=B.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){k(a,c,e,f,d.dfd)},error:function(a){h(a,f,d.dfd)}},this.requestOptions)},executeForExtent:function(a,e,f,d){var c=d.assembly;a=this._encode(p.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},a.toJson(c&&c[0])));
var k=this._extentHandler,h=this._errorHandler;this.source&&(c={source:this.source.toJson()},a.layer=B.toJson(c));this.gdbVersion&&(a.gdbVersion=this.gdbVersion);return b({url:this._url.path+"/query",content:a,callbackParamName:"callback",load:function(a,c){k(a,c,e,f,d.dfd)},error:function(a){h(a,f,d.dfd)}},this.requestOptions)},_handler:function(a,b,e,f,g){try{var c=new d(a);this._successHandler([c],"onComplete",e,g)}catch(w){this._errorHandler(w,f,g)}},_relationshipQueryHandler:function(a,b,e,f,
g){try{var c=a.geometryType,k=a.spatialReference,h={};n.forEach(a.relatedRecordGroups,function(a){var b={};b.geometryType=c;b.spatialReference=k;b.features=a.relatedRecords;b=new d(b);if(null!=a.objectId)h[a.objectId]=b;else for(var e in a)a.hasOwnProperty(e)&&"relatedRecords"!==e&&(h[a[e]]=b)});this._successHandler([h],"onExecuteRelationshipQueryComplete",e,g)}catch(y){this._errorHandler(y,f,g)}},_executeForIdsHandler:function(a,b,e,f,d){try{this._successHandler([a.objectIds],"onExecuteForIdsComplete",
e,d)}catch(l){this._errorHandler(l,f,d)}},_countHandler:function(a,b,e,f,d){try{var c,k=a.features,h=a.objectIds;if(h)c=h.length;else{if(k)throw Error("Unable to perform query. Please check your parameters.");c=a.count}this._successHandler([c],"onExecuteForCountComplete",e,d)}catch(y){this._errorHandler(y,f,d)}},_extentHandler:function(a,b,e,d,g){try{a.extent&&(a.extent=new f(a.extent)),this._successHandler([a],"onExecuteForExtentComplete",e,g)}catch(l){this._errorHandler(l,d,g)}}});g._createWrappers(t);
q("extend-esri")&&p.setObject("tasks.QueryTask",t,m);return t})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(t,p,n,A,B,q,m,b){t=t(b,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(a,b){a&&p.isString(a)&&(this._url=m.urlToObject(this.url=a));b&&b.requestOptions&&(this.requestOptions=b.requestOptions);this.normalization=!0;
this._errorHandler=p.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},_encode:function(a,b,g){var e,d,c={},f,h;for(f in a)if("declaredClass"!==f&&(e=a[f],d=typeof e,null!==e&&void 0!==e&&"function"!==d))if(p.isArray(e))for(c[f]=[],h=e.length,d=0;d<h;d++)c[f][d]=this._encode(e[d]);else"object"===d?e.toJson&&(d=e.toJson(g&&g[f]),"esri.tasks.FeatureSet"===
e.declaredClass&&d.spatialReference&&(d.sr=d.spatialReference,delete d.spatialReference),c[f]=b?d:n.toJson(d)):c[f]=e;return c},_successHandler:function(a,b,g,e){b&&this[b].apply(this,a);g&&g.apply(null,a);e&&q._resDfd(e,a)},_errorHandler:function(a,b,g){this.onError(a);b&&b(a);g&&g.errback(a)},setNormalization:function(a){this.normalization=a},onError:function(){}});A("extend-esri")&&(B.Task=t);return t})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(t,p,n,A,B,q,m,b,a,f,g){t=t(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(a){if(a){p.mixin(this,a);var e=this.features,c=a.spatialReference,k=f.getGeometryType(a.geometryType),c=this.spatialReference=new b(c);this.geometryType=a.geometryType;a.fields&&(this.fields=a.fields);n.forEach(e,function(a,b){var f=a.geometry&&a.geometry.spatialReference;e[b]=new m(k&&a.geometry?new k(a.geometry):null,a.symbol&&g.fromJson(a.symbol),a.attributes);e[b].geometry&&!f&&e[b].geometry.setSpatialReference(c)});
this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(b){var e={};this.displayFieldName&&(e.displayFieldName=this.displayFieldName);this.fields&&(e.fields=this.fields);this.spatialReference?e.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(e.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(e.geometryType=
f.getJsonType(this.features[0].geometry)),e.features=a._encodeGraphics(this.features,b));e.geometryType=e.geometryType||this.geometryType;e.exceededTransferLimit=this.exceededTransferLimit;e.transform=this.transform;return q.fixJson(e)},_hydrate:function(){var a=this.transform,b=this.geometryType;if(a&&b)for(var c=this.features,f=a.translate[0],g=a.translate[1],m=a.scale[0],v=a.scale[1],l=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y)};if("esriGeometryPolyline"===
a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var e,f,d,k,x,g,h,l;e=0;for(f=a.length;e<f;e++)for(x=a[e],d=0,k=x.length;d<k;d++)g=x[d],0<d?(h+=g[0],l+=g[1]):(h=g[0],l=g[1]),g[0]=b(h),g[1]=c(l)};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var e,f,d,g,x;e=0;for(f=a.length;e<f;e++)d=a[e],0<e?(g+=d[0],x+=d[1]):(g=d[0],x=d[1]),d[0]=b(g),d[1]=c(x)}}(b,
function(a){return a*m+f},function(a){return g-a*v}),a=0,b=c.length;a<b;a++)c[a].geometry&&l(c[a].geometry);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],c=a.translate[1],e=a.scale[0],f=a.scale[1],g=this.features,m=function(a,b,c){var e,f,d,x,g,k,h=[];e=0;for(f=a.length;e<f;e++)if(d=a[e],0<e){if(k=b(d[0]),d=c(d[1]),k!==x||d!==g)h.push([k-x,d-g]),x=k,g=d}else x=b(d[0]),g=c(d[1]),h.push([x,g]);return 0<h.length?h:null},l=function(a,
b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var e,f,d,g,k;d=a.rings||a.paths;k=[];e=0;for(f=d.length;e<f;e++)g=d[e],(g=m(g,b,c))&&k.push(g);return 0<k.length?(a.rings?a.rings=k:a.paths=k,a):null};if("esriGeometryMultipoint"===a)return function(a){var e;e=m(a.points,b,c);return 0<e.length?(a.points=e,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,
function(a){return Math.round((a-b)/e)},function(a){return Math.round((c-a)/f)}),w,r;w=0;for(r=g.length;w<r;w++)g[w].geometry&&(l(g[w].geometry)||g[w].setGeometry(null));this.transform=a;return this}});A("extend-esri")&&p.setObject("tasks.FeatureSet",t,B);return t})},"esri/tasks/RelationshipQuery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(t,p,n,A,B){t=t(null,{declaredClass:"esri.tasks.RelationshipQuery",definitionExpression:"",relationshipId:null,
returnGeometry:!1,objectIds:null,outSpatialReference:null,outFields:null,toJson:function(){var q={definitionExpression:this.definitionExpression,relationshipId:this.relationshipId,returnGeometry:this.returnGeometry,maxAllowableOffset:this.maxAllowableOffset,geometryPrecision:this.geometryPrecision},m=this.objectIds,b=this.outFields,a=this.outSpatialReference;m&&(q.objectIds=m.join(","));b&&(q.outFields=b.join(","));a&&(q.outSR=a.wkid||n.toJson(a.toJson()));q._ts=this._ts;return q}});A("extend-esri")&&
p.setObject("tasks.RelationshipQuery",t,B);return t})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(t,p,n,A){t=t(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});n("extend-esri")&&
p.setObject("tasks.StatisticDefinition",t,A);return t})},"esri/core/timerUtils":function(){define([],function(){function t(q){var m,b=q.length;for(m=0;m<b;m++)q[m]()}var p={LOW:1,HIGH:2},n,A={};A[p.LOW]=[];A[p.HIGH]=[];var B=function(){clearTimeout(n);n=null;var q=A[p.HIGH];A[p.HIGH]=[];t(q);q=A[p.LOW];A[p.LOW]=[];t(q)};return{priority:p,callbackQueue:A,setTimeout:function(q,m){var b=[m,A[m].push(q)-1];n||(n=setTimeout(B,0));return b},clearTimeout:function(q){q&&A[q[0]].splice(q[1],1)}}})},"esri/layers/labelLayerUtils/DynamicLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Polygon".split(" "),
function(t,p,n,A,B,q){t=t(null,{declaredClass:"esri.layers.labelLayerUtils.DynamicLabelClass",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._y1=this._x1=this._y0=this._x0=this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1},setMap:function(m,b){this._labelLayer=b;this._xmin=m.extent.xmin;this._xmax=m.extent.xmax;this._ymin=m.extent.ymin;this._ymax=m.extent.ymax;this._scale=(this._xmax-this._xmin)/m.width},_process:function(m){this._preparedLabels=
m;this._placedLabels=[];var b;for(m=this._preparedLabels.length-1;0<=m;m--){var a=this._preparedLabels[m],f=Math.min(a.labelWidth,a.labelHeight),g=a.labelWidth+0*f,f=a.labelHeight+0*f,e=(b=a.options)&&void 0!==b.lineLabelPlacement?b.lineLabelPlacement:"PlaceAtCenter",d=b&&void 0!==b.lineLabelPosition?b.lineLabelPosition:"Above",c=b&&void 0!==b.pointPriorities?b.pointPriorities:"AboveRight",k=[2,2,1,3,0,2,3,3,2];"AboveLeft"==c?k=[1,2,2,2,0,3,2,3,3]:"AboveCenter"==c?k=[2,1,2,2,0,2,3,3,3]:"AboveRight"==
c?k=[2,2,1,3,0,2,3,3,2]:"CenterLeft"==c?k=[2,2,3,1,0,3,2,2,3]:"CenterCenter"==c?k=[0,0,0,0,1,0,0,0,0]:"CenterRight"==c?k=[3,2,2,3,0,1,3,2,2]:"BelowLeft"==c?k=[2,3,3,2,0,3,1,2,2]:"BelowCenter"==c?k=[3,3,3,2,0,2,2,1,2]:"BelowRight"==c&&(k=[3,3,2,3,0,2,2,2,1]);var h=b&&void 0!==b.labelRotation?b.labelRotation:!0,c=Math.PI/180*a.angle;b=b&&void 0!==b.howManyLabels?b.howManyLabels:"OneLabel";if("point"==a.geometry.type)this._generatePointPositions(a,a.geometry.x,a.geometry.y,a.text,c,g,f,a.symbolWidth,
a.symbolHeight,k);else if("multipoint"==a.geometry.type)for(e=a.geometry,d=0;d<e.points.length;d++)this._generatePointPositions(a,e.points[d][0],e.points[d][1],a.text,c,g,f,a.symbolWidth,a.symbolHeight,k);else"polyline"==a.geometry.type?this._generateLinePositions(a,a.geometry,a.text,g,f,2*a.symbolHeight+f,e,d,h):"polygon"==a.geometry.type&&this._generatePolygonPositions(a,b,a.geometry,a.text,c,g,f)}return this._placedLabels},_generatePointPositions:function(m,b,a,f,g,e,d,c,k,h){c=(c+e)*this._scale;
k=(k+d)*this._scale;var u,v;for(u=1;3>=u;u++)for(v=1;9>=v;v++)if(h[v-1]==u)switch(v){case 1:if(this._findPlace(m,f,b-c,a+k,g,e,d))return;break;case 2:if(this._findPlace(m,f,b,a+k,g,e,d))return;break;case 3:if(this._findPlace(m,f,b+c,a+k,g,e,d))return;break;case 4:if(this._findPlace(m,f,b-c,a,g,e,d))return;break;case 5:if(this._findPlace(m,f,b,a,g,e,d))return;break;case 6:if(this._findPlace(m,f,b+c,a,g,e,d))return;break;case 7:if(this._findPlace(m,f,b-c,a-k,g,e,d))return;break;case 8:if(this._findPlace(m,
f,b,a-k,g,e,d))return;break;case 9:if(this._findPlace(m,f,b+c,a-k,g,e,d))return}},_generateLinePositions:function(m,b,a,f,g,e,d,c,k){var h=f*this._scale*f*this._scale,u,v,l;for(u=0;u<b.paths.length;u++){var w=b.paths[u],r=w.length,y=Math.floor((r-1)/2),q=0!==(r-1)%2?1:-1;"PlaceAtStart"==d&&(y=0,q=1);"PlaceAtEnd"==d&&(y=r-2,q=-1);for(;0<=y&&y<r-1;){for(v=y;v<r;v++){var p=w[y][0],D=w[y][1],n=w[v][0]-p,t=w[v][1]-D;if(n*n+t*t>h){for(var x=Math.atan2(t,n);x>Math.PI/2;)x-=Math.PI;for(;x<-(Math.PI/2);)x+=
Math.PI;var C=Math.sin(x),G=Math.cos(x),J=0,K=0;"Above"==c&&(J=e*C*this._scale,K=e*G*this._scale);"Below"==c&&(J=-e*C*this._scale,K=-e*G*this._scale);if(1==v-y){if(this._clipLine(p,D,w[v][0],w[v][1])&&(p=this._x1-this._x0,l=this._y1-this._y0,p*p+l*l>h&&(v=Math.atan2(l,p),n=f/2+2*g,D=n*this._scale*Math.cos(v),n=n*this._scale*Math.sin(v),"PlaceAtStart"==d?(p=this._x0+D,l=this._y0+n):"PlaceAtEnd"==d?(p=this._x1-D,l=this._y1-n):(p=this._x0+p/2,l=this._y0+l/2),this._findPlace(m,a,p-J,l+K,k?-v:0,f,g))))return}else{var F=
0;for(l=y;l<=v;l++)F=Math.max(F,Math.abs((w[l][1]-D)*G-(w[l][0]-p)*C));if(F<g&&this._findPlace(m,a,p+n/2-J,D+t/2+K,k?-x:0,f,g))return}break}}y+=q}}},_generatePolygonPositions:function(m,b,a,f,g,e,d){var c;if("ManyLabels"==b)for(b=0;b<a.rings.length;b++)c=a.rings[b],q.prototype.isClockwise(c)&&(c=this._findCentroid(c,this._xmin,this._ymin,this._xmax,this._ymax),this._findPlace(m,f,c[0],c[1],g,e,d));else{c=this._findCentroidForFeature(a,this._xmin,this._ymin,this._xmax,this._ymax);var k=c[1],h=0;for(b=
0;10>b;b++){h+=d/4;c=this._findCentroidForFeature(a,this._xmin,k+(h-d/4),this._xmax,k+(h+d/4));if(this._findPlace(m,f,c[0],c[1],g,e,d))break;c=this._findCentroidForFeature(a,this._xmin,k-(h+d/4),this._xmax,k-(h-d/4));if(this._findPlace(m,f,c[0],c[1],g,e,d))break}}},_findCentroid:function(m,b,a,f,g){var e=m.length,d=[0,0],c=0,k=m[0][0],h=m[0][1];k>f&&(k=f);k<b&&(k=b);h>g&&(h=g);h<a&&(h=a);for(var u=1;u<e-1;u++){var v=m[u][0],l=m[u][1],w=m[u+1][0],r=m[u+1][1];v>f&&(v=f);v<b&&(v=b);l>g&&(l=g);l<a&&(l=
a);w>f&&(w=f);w<b&&(w=b);r>g&&(r=g);r<a&&(r=a);var y=(v-k)*(r-h)-(w-k)*(l-h);d[0]+=y*(k+v+w);d[1]+=y*(h+l+r);c+=y}d[0]/=3*c;d[1]/=3*c;if(isNaN(d[0])||isNaN(d[1]))return d;a=[];this._fillBuffer(m,a,d);d[0]=this._sortBuffer(a,d[0],b,f);return d},_findCentroidForFeature:function(m,b,a,f,g){for(var e,d=0,c=[0,0],k=0;k<m.rings.length;k++){var h=m.rings[k],u=h.length,v=h[0][0],l=h[0][1];v>f&&(v=f);v<b&&(v=b);l>g&&(l=g);l<a&&(l=a);for(e=1;e<u-1;e++){var w=h[e][0],r=h[e][1],y=h[e+1][0],p=h[e+1][1];w>f&&(w=
f);w<b&&(w=b);r>g&&(r=g);r<a&&(r=a);y>f&&(y=f);y<b&&(y=b);p>g&&(p=g);p<a&&(p=a);var q=(w-v)*(p-l)-(y-v)*(r-l);c[0]+=q*(v+w+y);c[1]+=q*(l+r+p);d+=q}}c[0]/=3*d;c[1]/=3*d;if(isNaN(c[0])||isNaN(c[1]))return c;a=[];for(e=0;e<m.rings.length;e++)this._fillBuffer(m.rings[e],a,c);c[0]=this._sortBuffer(a,c[0],b,f);return c},_fillBuffer:function(m,b,a){for(var f=m.length-1,g=m[0][1]>=m[f][1]?1:-1,e=0;e<=f;e++){var d=e,c=e+1;e==f&&(c=0);var k=m[d][0],d=m[d][1],h=m[c][0],c=m[c][1],u=c>=d?1:-1;if(d<=a[1]&&a[1]<=
c||c<=a[1]&&a[1]<=d)a[1]!=d&&a[1]!=c?(b.push((a[1]-d)*(h-k)/(c-d)+k),g=u):a[1]==d&&a[1]!=c?(g!=u&&b.push(k),g=u):a[1]!=d&&a[1]==c?(b.push(h),g=u):a[1]==d&&a[1]==c&&(1==g&&b.push(k),b.push(h),g=u)}},_sortBuffer:function(m,b,a,f){var g=m.length;m.sort();if(0<g){for(var e=0,d=b=0;d<g-1;d+=2){var c=Math.abs(m[d+1]-m[d]);!(m[d]<=a&&m[d+1]<=a||m[d]>=f&&m[d+1]>=f)&&c>e&&(e=c,b=d)}g=m[b];m=m[b+1];g>f&&(g=f);g<a&&(g=a);m>f&&(m=f);m<a&&(m=a);b=(g+m)/2}return b},_findPlace:function(m,b,a,f,g,e,d){if(isNaN(a)||
isNaN(f))return!1;for(var c=0;c<this._placedLabels.length;c++){var k=this._placedLabels[c].angle,h=this._placedLabels[c].width*this._scale,u=this._placedLabels[c].height*this._scale,v=this._placedLabels[c].x-a,l=this._placedLabels[c].y-f;if(0===g&&0===k){if(this._findPlace2(-e*this._scale,-d*this._scale,e*this._scale,d*this._scale,v-h,l-u,v+h,l+u))return!1}else{var w=new B(-e*this._scale,-d*this._scale,e*this._scale,d*this._scale,null),r=0,y=1;0!==g&&(r=Math.sin(g),y=Math.cos(g));var p=v*y-l*r,v=
v*r+l*y,k=k-g,r=Math.sin(k),y=Math.cos(k),n=-h*y- -u*r,l=-h*r+-u*y,k=+h*y- -u*r,D=+h*r+-u*y,h=p+n,u=v-l,r=p+k,y=v-D,n=p-n,l=v+l,p=p-k,v=v+D,k=new q;k.addRing([[h,u],[r,y],[n,l],[p,v],[h,u]]);if(w.intersects(k))return!1}}for(;g>Math.PI/2;)g-=Math.PI;for(;g<-(Math.PI/2);)g+=Math.PI;c={};c.layer=m;c.text=b;c.angle=g;c.x=a;c.y=f;c.width=e;c.height=d;this._placedLabels.push(c);return!0},_findPlace2:function(m,b,a,f,g,e,d,c){return(m>=g&&m<=d||a>=g&&a<=d||m<=g&&a>=d)&&(b>=e&&b<=c||f>=e&&f<=c||b<=e&&f>=
c)?!0:!1},_clipLine:function(m,b,a,f){for(var g=this._code(m,b),e=this._code(a,f);0!==g||0!==e;){if(0!==(g&e))return!1;var d=a-m,c=f-b;0!==g?(m<this._xmin?(b+=c*(this._xmin-m)/d,m=this._xmin):m>this._xmax?(b+=c*(this._xmax-m)/d,m=this._xmax):b<this._ymin?(m+=d*(this._ymin-b)/c,b=this._ymin):b>this._ymax&&(m+=d*(this._ymax-b)/c,b=this._ymax),g=this._code(m,b)):(a<this._xmin?(f+=c*(this._xmin-a)/d,a=this._xmin):a>this._xmax?(f+=c*(this._xmax-a)/d,a=this._xmax):f<this._ymin?(a+=d*(this._ymin-f)/c,f=
this._ymin):f>this._ymax&&(a+=d*(this._ymax-f)/c,f=this._ymax),e=this._code(a,f))}this._x0=m;this._y0=b;this._x1=a;this._y1=f;return!0},_code:function(m,b){var a=0;m<this._xmin&&(a+=8);m>this._xmax&&(a+=4);b<this._ymin&&(a+=2);b>this._ymax&&(a+=1);return a}});n("extend-esri")&&p.setObject("layers.labelLayerUtils.DynamicLabelClass",t,A);return t})},"esri/layers/labelLayerUtils/StaticLabelClass":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../geometry/Extent ../../geometry/Point ../../geometry/Polygon".split(" "),
function(t,p,n,A,B,q,m){return t(null,{declaredClass:"esri.layers.labelLayerUtils.StaticLabel",constructor:function(){this._preparedLabels=[];this._placedLabels=[];this._extent=null;this._ymax=this._ymin=this._xmax=this._xmin=0;this._scale=1;this._LINE_STEP_CONST=1.5;this._POLYGON_X_STEP_CONST=1;this._POLYGON_Y_STEP_CONST=.75;this._OVERRUN=2},setMap:function(b,a){this._labelLayer=a;this._map=b;this._xmin=b.extent.xmin;this._xmax=b.extent.xmax;this._ymin=b.extent.ymin;this._ymax=b.extent.ymax;this._scale=
(this._xmax-this._xmin)/b.width},_process:function(b){var a,f,g,e,d,c,k,h,u;this._preparedLabels=b;this._placedLabels=[];for(b=this._preparedLabels.length-1;0<=b;b--){a=this._preparedLabels[b];d=a.labelWidth;c=a.labelHeight;h=(k=a.options)&&k.lineLabelPlacement?k.lineLabelPlacement:"PlaceAtCenter";u=k&&k.lineLabelPosition?k.lineLabelPosition:"Above";f=k&&k.labelRotation?k.labelRotation:!0;g=Math.PI/180*a.angle;e=k&&k.howManyLabels?k.howManyLabels:"OneLabel";var v=[];if("point"===a.geometry.type)this._generatePointPositions(a.geometry.x,
a.geometry.y,a.text,g,d,c,a.symbolWidth,a.symbolHeight,k,v);else if("multipoint"===a.geometry.type)for(f=0;f<a.geometry.points.length;f++)this._generatePointPositions(a.geometry.points[f][0],a.geometry.points[f][1],a.text,g,d,c,a.symbolWidth,a.symbolHeight,k,v);else if("polyline"===a.geometry.type)if("PlaceAtStart"===h)this._generateLinePositionsPlaceAtStart(a.geometry,!0,a.text,d,c,2*a.symbolHeight+c,h,u,f,v);else if("PlaceAtEnd"===h)this._generateLinePositionsPlaceAtEnd(a.geometry,!0,a.text,d,c,
2*a.symbolHeight+c,h,u,f,v);else{k=[];var l=a.geometry.getExtent(),w=this._map.extent;if(l.getWidth()<d*this._scale/this._OVERRUN&&l.getHeight()<d*this._scale/this._OVERRUN)continue;else.5*l.getWidth()<w.getWidth()&&.5*l.getHeight()<w.getHeight()?this._generateLinePositionsPlaceAtCenter(a.geometry,!1,.1*Math.min(this._map.width,this._map.height)*this._scale,a.text,d,c,2*a.symbolHeight+c,h,u,f,k):this._generateLinePositionsPlaceAtCenter(a.geometry,!0,.2*Math.min(this._map.width,this._map.height)*this._scale,
a.text,d,c,2*a.symbolHeight+c,h,u,f,k);this._postSorting(w,k,v)}else if("polygon"===a.geometry.type){h=[];for(f=0;f<a.geometry.rings.length;f++)u=a.geometry.rings[f],1<a.geometry.rings.length&&!m.prototype.isClockwise(u)||(k=this._calcRingExtent(u),k.xmax-k.xmin<4*d*this._scale/this._OVERRUN&&k.ymax-k.ymin<4*c*this._scale/this._OVERRUN||h.push(u));h.sort(function(a,b){return b.length-a.length});for(f=0;f<h.length;f++)this._generatePolygonPositionsForManyLabels(h[f],a.geometry.spatialReference,a.text,
g,d,c,v)}for(f=0;f<v.length&&(h=v[f].x,u=v[f].y,void 0!==v[f].angle&&(g=v[f].angle),k=this._findPlace(a,a.text,h,u,g,d,c),"OneLabel"!==e||!k||!this._labelLayer._isWithinScreenArea(new q(h,u,a.geometry.spatialReference)));f++);}return this._placedLabels},_generatePointPositions:function(b,a,f,g,e,d,c,k,h,m){f=h&&h.pointPriorities?h.pointPriorities:"AboveRight";e=(c+e)*this._scale;d=(k+d)*this._scale;switch(f.toLowerCase()){case "aboveleft":b-=e;a+=d;break;case "abovecenter":a+=d;break;case "aboveright":b+=
e;a+=d;break;case "centerleft":b-=e;break;case "centercenter":break;case "centerright":b+=e;break;case "belowleft":b-=e;a-=d;break;case "belowcenter":a-=d;break;case "belowright":b+=e;a-=d;break;default:return}m.push({x:b,y:a})},_generateLinePositionsPlaceAtStart:function(b,a,f,g,e,d,c,k,h,m){c=g*this._scale;var v=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,w,r,u,p,q,n,t;for(l=0;l<b.paths.length;l++){var z=b.paths[l],x=c,C=0;for(w=0;w<z.length-1;w++)r=z[w][0],u=
z[w][1],p=z[w+1][0],q=z[w+1][1],n=p-r,t=q-u,n=Math.sqrt(n*n+t*t),C+n>x?(C=this._generatePositionsOnLine(b.spatialReference,a,x,v,C,r,u,p,q,f,g,e,d,k,h,m),x=v):C+=n}},_generateLinePositionsPlaceAtEnd:function(b,a,f,g,e,d,c,k,h,m){c=g*this._scale;var v=this._LINE_STEP_CONST*Math.min(this._map.width,this._map.height)*this._scale,l,w,r,u,p,n,q,t;for(l=0;l<b.paths.length;l++){var z=b.paths[l],x=c,C=0;for(w=z.length-2;0<=w;w--)r=z[w+1][0],u=z[w+1][1],p=z[w][0],n=z[w][1],q=p-r,t=n-u,q=Math.sqrt(q*q+t*t),
C+q>x?(C=this._generatePositionsOnLine(b.spatialReference,a,x,v,C,r,u,p,n,f,g,e,d,k,h,m),x=v):C+=q}},_generateLinePositionsPlaceAtCenter:function(b,a,f,g,e,d,c,k,h,m,v){var l,w,r,u,p,q,n,t;for(k=0;k<b.paths.length;k++){var z=b.paths[k];if(!(2>z.length)){if(2==z.length){u=z[0];l=z[1];r=u[0];u=u[1];z=l[0];q=l[1];p=(z-r)*(z-r)+(q-u)*(q-u);n=Math.atan2(q-u,z-r);q=Math.cos(n);n=Math.sin(n);z=[];t=r;for(var x=u;(t-r)*(t-r)+(x-u)*(x-u)<p;)z.push([t,x]),t+=f/2*q,x+=f/2*n;z.push(l)}var C=0;for(l=0;l<z.length-
1;l++)r=z[l][0],u=z[l][1],p=z[l+1][0],q=z[l+1][1],n=p-r,t=q-u,C+=Math.sqrt(n*n+t*t);for(l=x=0;l<z.length-1;l++){r=z[l][0];u=z[l][1];p=z[l+1][0];q=z[l+1][1];n=p-r;t=q-u;n=Math.sqrt(n*n+t*t);if(x+n>C/2)break;x+=n}l==z.length-1&&l--;r=z[l][0];u=z[l][1];p=z[l+1][0];q=z[l+1][1];n=p-r;t=q-u;x=C/2-x;n=Math.atan2(t,n);t=r+x*Math.cos(n);n=u+x*Math.sin(n);r=this._angleAndShifts(r,u,p,q,c,h,m);v.push({x:t+r.shiftX,y:n+r.shiftY,angle:r.angle});var C=t,G=n,x=0;for(w=l;w<z.length-1;w++)w==l?(r=C,u=G):(r=z[w][0],
u=z[w][1]),p=z[w+1][0],q=z[w+1][1],n=p-r,t=q-u,n=Math.sqrt(n*n+t*t),x=x+n>f?this._generatePositionsOnLine(b.spatialReference,a,f,f,x,r,u,p,q,g,e,d,c,h,m,v):x+n;x=0;for(w=l;0<=w;w--)w==l?(r=C,u=G):(r=z[w+1][0],u=z[w+1][1]),p=z[w][0],q=z[w][1],n=p-r,t=q-u,n=Math.sqrt(n*n+t*t),x=x+n>f?this._generatePositionsOnLine(b.spatialReference,a,f,f,x,r,u,p,q,g,e,d,c,h,m,v):x+n}}},_generatePositionsOnLine:function(b,a,f,g,e,d,c,k,h,m,n,l,p,r,q,t){m=Math.atan2(h-c,k-d);n=d;l=c;var u=n,v=l;do if(e=f-e,n+=e*Math.cos(m),
l+=e*Math.sin(m),this._belongs(n,l,d,c,k,h))e=this._angleAndShifts(d,c,k,h,p,r,q),f=n+e.shiftX,v=l+e.shiftY,a?this._labelLayer._isWithinScreenArea(new B(f,v,f,v,b))&&t.push({x:f,y:v,angle:e.angle}):t.push({x:f,y:v,angle:e.angle}),u=n,v=l,e=0,f=g;else return b=k-u,h-=v,Math.sqrt(b*b+h*h);while(1)},_postSorting:function(b,a,f){if(b&&0<a.length){var g=.5*(b.xmin+b.xmax);b=.5*(b.ymin+b.ymax);for(var e=a[0].x,d=a[0].y,c=Math.sqrt((e-g)*(e-g)+(d-b)*(d-b)),k=a[0].angle,h=0;h<a.length;h++){var m=a[h].x,n=
a[h].y,l=Math.sqrt((m-g)*(m-g)+(n-b)*(n-b));l<c&&(e=m,d=n,c=l,k=a[h].angle)}f.push({x:e,y:d,angle:k})}},_belongs:function(b,a,f,g,e,d){if(e==f&&d==g)return!1;if(e>f){if(b>e||b<f)return!1}else if(b<e||b>f)return!1;if(d>g){if(a>d||a<g)return!1}else if(a<d||a>g)return!1;return!0},_angleAndShifts:function(b,a,f,g,e,d,c){for(b=Math.atan2(g-a,f-b);b>Math.PI/2;)b-=Math.PI;for(;b<-(Math.PI/2);)b+=Math.PI;g=Math.sin(b);var k=Math.cos(b);f=a=0;"Above"==d&&(a=e*g*this._scale,f=e*k*this._scale);"Below"==d&&(a=
-e*g*this._scale,f=-e*k*this._scale);e=[];e.angle=c?-b:0;e.shiftX=-a;e.shiftY=f;return e},_generatePolygonPositionsForManyLabels:function(b,a,f,g,e,d,c){e=this._findCentroidForRing(b);g=e[0];var k=e[1],h=this._calcRingExtent(b);e=h.xmin;d=h.ymin;var m=h.xmax,h=h.ymax,n=(h-d)/(this._map.height*this._scale);if(!(10<(m-e)/(this._map.width*this._scale)&&10<n)){var l=!0;if(m-e>this._map.width*this._scale||h-d>this._map.height*this._scale)l=!1;var n=this._map.width*this._scale*(l?.1875:.5),l=this._map.height*
this._scale*(l?.1875:.5),p=!0,r=!0,q=0;do{k+=(q%2?-1:1)*q*l;if(this._scanRingByX(f,a,b,g,k,e,m,n,c))break;k<d&&(p=!1);k>h&&(r=!1);q++}while(p||r)}},_scanRingByX:function(b,a,f,g,e,d,c,k,h){var m=!0,n=!0,l=0,p=1E3;do{g+=(l%2?-1:1)*l*k;var r=this._movePointInsideRing(f,g,e),q=this._labelLayer._isWithinScreenArea(new B(r,e,r,e,a)),t=this._isPointWithinRing(b,f,r,e);if(q&&t)return h.push({x:r,y:e}),!0;g<d&&(m=!1);g>c&&(n=!1);l++;p--;if(0>=p)return!0}while(m||n);return!1},_movePointInsideRing:function(b,
a,f){for(var g=[],e=b.length-1,d=b[0][1]>=b[e][1]?1:-1,c=0;c<=e;c++){var k=c,h=c+1;c==e&&(h=0);var m=b[k][0],k=b[k][1],n=b[h][0],h=b[h][1],l=h>=k?1:-1;if(k<=f&&f<=h||h<=f&&f<=k)f!=k&&f!=h?(g.push((f-k)*(n-m)/(h-k)+m),d=l):f==k&&f!=h?(d!=l&&g.push(m),d=l):f!=k&&f==h?(g.push(n),d=l):f==k&&f==h&&(1==d&&g.push(m),g.push(n),d=l)}g.sort(function(a,b){return a-b});b=g.length;if(0<b){for(c=f=a=0;c<b-1;c+=2)e=Math.abs(g[c+1]-g[c]),e>a&&(a=e,f=c);a=(g[f]+g[f+1])/2}return a},_calcRingExtent:function(b){var a,
f;f=new B;for(a=0;a<b.length-1;a++){var g=b[a][0],e=b[a][1];if(void 0===f.xmin||g<f.xmin)f.xmin=g;if(void 0===f.ymin||e<f.ymin)f.ymin=e;if(void 0===f.xmax||g>f.xmax)f.xmax=g;if(void 0===f.ymax||e>f.ymax)f.ymax=e}return f},_isPointWithinPolygon:function(b,a,f,g){var e;for(e=0;e<a.rings.length;e++)if(this._isPointWithinRing(b,a.rings[e],f,g))return!0;return!1},_isPointWithinRing:function(b,a,f,g){var e,d,c,k,h=[],m=a.length;for(b=0;b<m-1;b++)if(e=a[b][0],d=a[b][1],c=a[b+1][0],k=a[b+1][1],e!=c||d!=k){if(d==
k)if(g==d)h.push(e);else continue;e==c?(d<k&&g>=d&&g<k&&h.push(e),d>k&&g<=d&&g>k&&h.push(e)):(d=(c-e)/(k-d)*(g-d)+e,e<c&&d>=e&&d<c&&h.push(d),e>c&&d<=e&&d>c&&h.push(d))}h.sort(function(a,b){return a-b});for(b=0;b<h.length-1;b++)if(e=h[b],c=h[b+1],f>=e&&f<c)if(b%2)break;else return!0;return!1},_findCentroidForRing:function(b){for(var a=b.length,f=[0,0],g=0,e=b[0][0],d=b[0][1],c=1;c<a-1;c++){var k=b[c][0],h=b[c][1],m=b[c+1][0],n=b[c+1][1],l=(k-e)*(n-d)-(m-e)*(h-d);f[0]+=l*(e+k+m);f[1]+=l*(d+h+n);g+=
l}f[0]/=3*g;f[1]/=3*g;return f},_findCentroidForFeature:function(b){for(var a=0,f=[0,0],g=0;g<b.rings.length;g++)for(var e=b.rings[g],d=e.length,c=e[0][0],k=e[0][1],h=1;h<d-1;h++){var m=e[h][0],n=e[h][1],l=e[h+1][0],p=e[h+1][1],r=(m-c)*(p-k)-(l-c)*(n-k);f[0]+=r*(c+m+l);f[1]+=r*(k+n+p);a+=r}f[0]/=3*a;f[1]/=3*a;return f},_findPlace:function(b,a,f,g,e,d,c){if(isNaN(f)||isNaN(g))return!1;for(var k=0;k<this._placedLabels.length;k++){var h=this._placedLabels[k].angle,n=this._placedLabels[k].width*this._scale,
p=this._placedLabels[k].height*this._scale,l=this._placedLabels[k].x-f,q=this._placedLabels[k].y-g;if(0===e&&0===h){if(this._findPlace2(-d*this._scale,-c*this._scale,d*this._scale,c*this._scale,l-n,q-p,l+n,q+p))return!1}else{var r=new B(-d*this._scale,-c*this._scale,d*this._scale,c*this._scale,null),t=0,A=1;0!==e&&(t=Math.sin(e),A=Math.cos(e));var E=l*A-q*t,l=l*t+q*A,h=h-e,t=Math.sin(h),A=Math.cos(h),D=-n*A- -p*t,q=-n*t+-p*A,h=+n*A- -p*t,I=+n*t+-p*A,n=E+D,p=l-q,t=E+h,A=l-I,D=E-D,q=l+q,E=E-h,l=l+I,
h=new m;h.addRing([[n,p],[t,A],[D,q],[E,l],[n,p]]);if(r.intersects(h))return!1}}for(;e>Math.PI/2;)e-=Math.PI;for(;e<-(Math.PI/2);)e+=Math.PI;k={};k.layer=b;k.text=a;k.angle=e;k.x=f;k.y=g;k.width=d;k.height=c;this._placedLabels.push(k);return!0},_findPlace2:function(b,a,f,g,e,d,c,k){return(b>=e&&b<=c||f>=e&&f<=c||b<=e&&f>=c)&&(a>=d&&a<=k||g>=d&&g<=k||a<=d&&g>=k)?!0:!1}})})},"*noref":1}});
define("esri/layers/LabelLayer","require dojo/_base/declare dojo/_base/lang dojo/number dojo/i18n!dojo/cldr/nls/number dojo/_base/array dojo/_base/connect dojo/has dojox/gfx/_base ../kernel ../lang ../graphic ../PopupInfo ../core/timerUtils ./labelLayerUtils/DynamicLabelClass ./labelLayerUtils/StaticLabelClass ./support/attributeUtils ../symbols/TextSymbol ../symbols/ShieldLabelSymbol ../geometry/Extent ../geometry/Point ../geometry/webMercatorUtils ./GraphicsLayer ./LabelClass ../renderers/SimpleRenderer ../renderers/arcadeUtils".split(" "),function(t,
p,n,A,B,q,m,b,a,f,g,e,d,c,k,h,u,v,l,w,r,y,M,E,D,I){function z(a){return"sizeInfo"===a.type}t=p(M,{declaredClass:"esri.layers.LabelLayer",constructor:function(a){this._refreshLabels=n.hitch(this,this._refreshLabels);this.id="labels";this.featureLayers=[];this._featureLayerInfos=[];this._preparedLabels=[];this._engineType="STATIC";this._mapEventHandlers=[];a&&(a.id&&(this.id=a.id),a.mode&&(this._engineType="DYNAMIC"===a.mode.toUpperCase()?"DYNAMIC":"STATIC"))},_setMap:function(a){this._mapEventHandlers.push(a.on("extent-change",
n.hitch(this,"_handleLevelChange")));var b=this.inherited(arguments);this.refresh();return b},_unsetMap:function(){var a;for(a=0;a<this._mapEventHandlers.length;a++)m.disconnect(this._mapEventHandlers[a]);this.refresh();c.clearTimeout(this._refreshHandle);this._refreshHandle=null;this.inherited(arguments)},setAlgorithmType:function(a){this._engineType=a&&"DYNAMIC"===a.toUpperCase()?"DYNAMIC":"STATIC";this.refresh()},addFeatureLayer:function(a,b,c,e){if(!this.getFeatureLayer(a.layerId)){var f=[];f.push(a.on("update-end",
n.hitch(this,"refresh")));f.push(a.on("suspend",n.hitch(this,"refresh")));f.push(a.on("resume",n.hitch(this,"refresh")));f.push(a.on("edits-complete",n.hitch(this,"refresh")));f.push(a.on("labeling-info-change",n.hitch(this,"refresh")));f.push(a.on("time-extent-change",n.hitch(this,"refresh")));f.push(a.on("show-labels-change",n.hitch(this,"refresh")));f.push(a.on("feature-reduction-change",n.hitch(this,"refresh")));this._featureLayerInfos.push({FeatureLayer:a,LabelExpressionInfo:c,LabelingOptions:e,
LabelRenderer:b,EventHandlers:f});this.featureLayers.push(a);this.refresh()}},getFeatureLayer:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return c;return null},removeFeatureLayer:function(a){var b;a=this.getFeatureLayer(a);if(void 0!==a&&(b=q.indexOf(this.featureLayers,a),-1<b)){this.featureLayers.splice(b,1);for(a=0;a<this._featureLayerInfos[b].EventHandlers.length;a++)m.disconnect(this._featureLayerInfos[b].EventHandlers[a]);this._featureLayerInfos.splice(b,
1);this.refresh()}},removeAllFeatureLayers:function(){var a;for(a=0;a<this.featureLayers.length;a++){for(var b=0;b<this._featureLayerInfos[a].EventHandlers.length;b++)m.disconnect(this._featureLayerInfos[a].EventHandlers[b]);this.featureLayers=[];this._featureLayerInfos=[]}this.refresh()},getFeatureLayers:function(){return this.featureLayers},getFeatureLayerInfo:function(a){var b,c;for(b=0;b<this.featureLayers.length;b++)if(c=this.featureLayers[b],void 0!==c&&c.id==a)return this._featureLayerInfos[b];
return null},refresh:function(){null==this._refreshHandle&&(this._refreshHandle=c.setTimeout(this._refreshLabels,c.priority.LOW))},_handleLevelChange:function(a){a.levelChange&&this.clear();this.refresh()},_refreshLabels:function(a){this._refreshHandle=null;var b,c,e,f,d,g=[],l,x="DYNAMIC"===this._engineType?new k:new h;if(this._map){x.setMap(this._map,this);this._preparedLabels=[];for(a=0;a<this.featureLayers.length;a++)if(c=this.featureLayers[a],c.visible&&c.showLabels&&c.visibleAtMapScale&&!c._suspended)if(b=
this._featureLayerInfos[a],d=this._convertOptions(null),b.LabelRenderer){if(g=c.labelingInfo)if(l=g[0])f=this._getLabelExpression(l),d=this._convertOptions(l);e=b.LabelRenderer;b.LabelExpressionInfo&&(f=b.LabelExpressionInfo);b.LabelingOptions&&(d=this._convertOptions(null),void 0!==b.LabelingOptions.pointPriorities&&(g=b.LabelingOptions.pointPriorities,d.pointPriorities="above-center"==g||"AboveCenter"==g||"esriServerPointLabelPlacementAboveCenter"==g?"AboveCenter":"above-left"==g||"AboveLeft"==
g||"esriServerPointLabelPlacementAboveLeft"==g?"AboveLeft":"above-right"==g||"AboveRight"==g||"esriServerPointLabelPlacementAboveRight"==g?"AboveRight":"below-center"==g||"BelowCenter"==g||"esriServerPointLabelPlacementBelowCenter"==g?"BelowCenter":"below-left"==g||"BelowLeft"==g||"esriServerPointLabelPlacementBelowLeft"==g?"BelowLeft":"below-right"==g||"BelowRight"==g||"esriServerPointLabelPlacementBelowRight"==g?"BelowRight":"center-center"==g||"CenterCenter"==g||"esriServerPointLabelPlacementCenterCenter"==
g?"CenterCenter":"center-left"==g||"CenterLeft"==g||"esriServerPointLabelPlacementCenterLeft"==g?"CenterLeft":"center-right"==g||"CenterRight"==g||"esriServerPointLabelPlacementCenterRight"==g?"CenterRight":"AboveRight"),void 0!==b.LabelingOptions.lineLabelPlacement&&(d.lineLabelPlacement=b.LabelingOptions.lineLabelPlacement),void 0!==b.LabelingOptions.lineLabelPosition&&(d.lineLabelPosition=b.LabelingOptions.lineLabelPosition),void 0!==b.LabelingOptions.labelRotation&&(d.labelRotation=b.LabelingOptions.labelRotation),
void 0!==b.LabelingOptions.howManyLabels&&(d.howManyLabels=b.LabelingOptions.howManyLabels));e instanceof E&&(f=this._getLabelExpression(e),e=new D(e.symbol),d=this._convertOptions(e));this._addLabels(c,e,f,d)}else if(g=c.labelingInfo)for(b=g.length-1;0<=b;b--)if(l=g[b])e=new E(l instanceof E?l.toJson():l),f=this._getLabelExpression(l),d=this._convertOptions(l),this._addLabels(c,e,f,d);f=x._process(this._preparedLabels);this.clear();this.drawLabels(this._map,f)}},drawLabels:function(a,b){this._scale=
(a.extent.xmax-a.extent.xmin)/a.width;var c;for(c=0;c<b.length;c++){var f=b[c],d=f.x,g=f.y,k=f.text,h=f.angle,l=f.layer.labelSymbol;"polyline"==f.layer.geometry.type&&f.layer.options.labelRotation&&l.setAngle(180/Math.PI*h);l.setText(k);f=d;l instanceof v&&(d=l.getHeight(),f-=.25*d*this._scale*Math.sin(h),g-=.33*d*this._scale);h=new e(new r(f,g,a.extent.spatialReference));h.setSymbol(l);this.add(h)}},_addLabels:function(a,b,c,e){var f,d,g,k;if(this._isWithinScaleRange(b.minScale,b.maxScale)&&c&&""!==
c){var h=this._map,l=!a.url&&!h.spatialReference.equals(a.spatialReference);for(f=0;f<a.graphics.length;f++)if(d=a.graphics[f],!1!==d.visible&&!d._suspended){g=d.geometry;if(l){if(!y.canProject(g,h))continue;g=y.project(g,h)}g&&this._isWhere(b.where,d.attributes)&&this._isWithinScreenArea(g)&&(k=this._buildLabelText(c,d,a.fields,e),this._addLabel(k,b,a.renderer,d,e,g,h))}}},_isWithinScreenArea:function(a){a="point"===a.type?new w(a.x,a.y,a.x,a.y,a.spatialReference):a.getExtent();if(void 0===a)return!1;
a=this._intersects(this._map,a);return null===a||0===a.length?!1:!0},_isWithinScaleRange:function(a,b){var c=this._map.getScale();return 0<a&&c>=a||0<b&&c<=b?!1:!0},_isWhere:function(a,b){try{if(!a)return!0;if(a){var c=a.split(" ");if(3===c.length)return this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2]));if(7===c.length){var e=this._sqlEquation(b[this._removeQuotes(c[0])],c[1],this._removeQuotes(c[2])),f=c[3],d=this._sqlEquation(b[this._removeQuotes(c[4])],c[5],this._removeQuotes(c[6]));
switch(f){case "AND":return e&&d;case "OR":return e||d}}}return!1}catch(N){console.log("Error.: can't parse \x3d "+a)}},_sqlEquation:function(a,b,c){switch(b){case "\x3d":return a==c?!0:!1;case "\x3c\x3e":return a!=c?!0:!1;case "\x3e":return a>c?!0:!1;case "\x3e\x3d":return a>=c?!0:!1;case "\x3c":return a<c?!0:!1;case "\x3c\x3d":return a<=c?!0:!1}return!1},_removeQuotes:function(a){var b=a.indexOf('"'),c=a.lastIndexOf('"');if(-1!=b&&-1!=c)return a.substr(1,a.length-2);b=a.indexOf("'");c=a.lastIndexOf("'");
return-1!=b&&-1!=c?a.substr(1,a.length-2):a},_getSizeInfo:function(a){return a?a.sizeInfo||q.filter(a.visualVariables,z)[0]:null},_addLabel:function(b,c,e,f,d,g,k){var h,m,p,q;if(b&&""!==n.trim(b)&&c){b=b.replace(/\s+/g," ");h=c.getSymbol(f);h instanceof v?(h=new v(h.toJson()),h.setVerticalAlignment("baseline"),h.setHorizontalAlignment("center")):h=h instanceof l?new l(h.toJson()):new v;h.setText(b);c.symbol=h;if(p=this._getProportionalSize(c.sizeInfo,f.attributes))h instanceof v?h.setSize(p):h instanceof
l&&(h.setWidth(p),h.setHeight(p));q=p=0;if(e){m=e.getSymbol(f);var x=this._getSizeInfo(e);if((e=x?e.getSize(f,{sizeInfo:x,resolution:k.getResolutionInMeters()}):f.size)&&null!==e)p=q=e;else if(m)if("simplemarkersymbol"==m.type)q=p=m.size;else if("picturemarkersymbol"==m.type)p=m.width,q=m.height;else if("simplelinesymbol"==m.type||"cartographiclinesymbol"==m.type)p=m.width}e={};e.graphic=f;e.options=d;e.geometry=g;e.labelRenderer=c;e.labelSymbol=h;e.labelWidth=h.getWidth()/2;e.labelHeight=h.getHeight()/
2;e.symbolWidth=a.normalizedLength(p)/2;e.symbolHeight=a.normalizedLength(q)/2;e.text=b;e.angle=h.angle;this._preparedLabels.push(e)}},_buildLabelText:function(a,b,c,e){if(e.hasExpression)return a=e.arcadeCache,b=b._getDataValue(a.attributeInfo,a,I),g.isDefined(b)?""+b:"";var f=b.attributes;return a.replace(/{[^}]*}/g,function(a){var b,h=a;for(b=0;b<c.length;b++)if("{"+c[b].name+"}"==a){var h=f[c[b].name],k=c[b].domain;if(k&&n.isObject(k)){if("codedValue"==k.type&&e.useCodedValues)for(b=h,a=0;a<k.codedValues.length;a++){if(k.codedValues[a].code==
b){h=k.codedValues[a].name;break}}else"range"==k.type&&k.minValue<=h&&h<=k.maxValue&&(h=k.name);break}k=c[b].type;if(e.fieldInfos){var l=e.fieldInfos;for(b=0;b<l.length;b++)if("{"+l[b].fieldName+"}"==a){a=l[b].format;"esriFieldTypeDate"==k?(a="DateFormat"+d.prototype._dateFormats[a.dateFormat?a.dateFormat:"shortDate"])&&(h=g.substitute({myKey:h},"${myKey:"+a+"}")):"esriFieldTypeInteger"!=k&&"esriFieldTypeSingle"!=k&&"esriFieldTypeSmallInteger"!=k&&"esriFieldTypeLong"!=k&&"esriFieldTypeDouble"!=k||
!a||(h=A.format(h,{places:a.places}),a.digitSeparator||B.group&&(h=h.replace(new RegExp("\\"+B.group,"g"),"")));break}}break}else h="";return null==h?"":h})},_getLabelExpression:function(a){var b="";a.labelExpressionInfo?b=a.labelExpressionInfo.value||a.labelExpressionInfo.expression:this._validSyntax(a.labelExpression)&&(b=this._convertLabelExpression(a.labelExpression));return b},_validSyntax:function(a){return/^(\s*\[[^\]]+\]\s*)+$/i.test(a)},_convertLabelExpression:function(a){return a.replace(RegExp("\\[",
"g"),"{").replace(RegExp("\\]","g"),"}")},_getProportionalSize:function(a,b){if(!a)return null;var c=g.substitute(b,"${"+a.field+"}",{first:!0});return!(a.minSize&&a.maxSize&&a.minDataValue&&a.maxDataValue&&c)||0>=a.maxDataValue-a.minDataValue?null:(a.maxSize-a.minSize)/(a.maxDataValue-a.minDataValue)*(c-a.minDataValue)+a.minSize},_convertOptions:function(a){var b=!0,c="shortDate",e=null,f=null,d="",g=!0,h,k;if(a&&(a.format&&(c=a.format.dateFormat,e={places:a.format.places,digitSeparator:a.format.digitSeparator}),
f=a.fieldInfos,d=a.labelPlacement,null!=a.useCodedValues&&(b=a.useCodedValues),a=a.labelExpressionInfo)){var l=a.expression;l&&!a.value&&(k=!0,h=u.createAttributeCache({valueExpression:l},!0))}if("always-horizontal"==d||"esriServerPolygonPlacementAlwaysHorizontal"==d)g=!1;return{useCodedValues:b,dateFormat:c,numberFormat:e,fieldInfos:f,pointPriorities:"above-center"==d||"esriServerPointLabelPlacementAboveCenter"==d?"AboveCenter":"above-left"==d||"esriServerPointLabelPlacementAboveLeft"==d?"AboveLeft":
"above-right"==d||"esriServerPointLabelPlacementAboveRight"==d?"AboveRight":"below-center"==d||"esriServerPointLabelPlacementBelowCenter"==d?"BelowCenter":"below-left"==d||"esriServerPointLabelPlacementBelowLeft"==d?"BelowLeft":"below-right"==d||"esriServerPointLabelPlacementBelowRight"==d?"BelowRight":"center-center"==d||"esriServerPointLabelPlacementCenterCenter"==d?"CenterCenter":"center-left"==d||"esriServerPointLabelPlacementCenterLeft"==d?"CenterLeft":"center-right"==d||"esriServerPointLabelPlacementCenterRight"==
d?"CenterRight":"AboveRight",lineLabelPlacement:"above-start"==d||"below-start"==d||"center-start"==d?"PlaceAtStart":"above-end"==d||"below-end"==d||"center-end"==d?"PlaceAtEnd":"PlaceAtCenter",lineLabelPosition:"above-after"==d||"esriServerLinePlacementAboveAfter"==d||"above-along"==d||"esriServerLinePlacementAboveAlong"==d||"above-before"==d||"esriServerLinePlacementAboveBefore"==d||"above-start"==d||"esriServerLinePlacementAboveStart"==d||"above-end"==d||"esriServerLinePlacementAboveEnd"==d?"Above":
"below-after"==d||"esriServerLinePlacementBelowAfter"==d||"below-along"==d||"esriServerLinePlacementBelowAlong"==d||"below-before"==d||"esriServerLinePlacementBelowBefore"==d||"below-start"==d||"esriServerLinePlacementBelowStart"==d||"below-end"==d||"esriServerLinePlacementBelowEnd"==d?"Below":"center-after"==d||"esriServerLinePlacementCenterAfter"==d||"center-along"==d||"esriServerLinePlacementCenterAlong"==d||"center-before"==d||"esriServerLinePlacementCenterBefore"==d||"center-start"==d||"esriServerLinePlacementCenterStart"==
d||"center-end"==d||"esriServerLinePlacementCenterEnd"==d?"OnLine":"Above",labelRotation:g,howManyLabels:"OneLabel",hasExpression:k,arcadeCache:h}}});b("extend-esri")&&n.setObject("layers.LabelLayer",t,f);return t});